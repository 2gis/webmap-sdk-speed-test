(function(){"use strict";const Ae=.7071067811865475,hc=4294967295,uc=1175494351e-47,pc=3402823466e29,cn="Noto_Sans",zo=1/2,Vo=2147483647,ko=4,Go=40,ps={subdomains:"0123",maxDetailLevel:17},Gt=[2048,2048],Je={baseSize:24,bomCharCode:65279},mc=1e3,hi={tileMultiplier:1.5,axisAngleToleranceDeg:45,axisCheckDistancePx:13,lineLabelsHidePitchDeg:40},ln={fov:60*Math.PI/180,near:1e3,far:2**34},ui={globeMaxZoom:8,globeInterStartZoom:7,globeInterEndZoom:16},gc=1e3,wc=16,Yo=["Commercial_poi_city"],$o=["Commercial_poi_premium"],yc=["Commercial_poi_default","Commercial_poi_custom","Commercial_poi_navi",...Yo,...$o],vc=["Commercial_model"],xc=["s_personal_poi"],Ic=["Landmark_poi","Landmark_point"];function N0(e){return e}const Yt=1e-6;let _t=typeof Float64Array<"u"?Float64Array:Array;function Te(){let e=new _t(2);return e[0]=0,e[1]=0,e}function jo(e,t){let n=new _t(2);return n[0]=e,n[1]=t,n}function ms(e,t){return e[0]=t[0],e[1]=t[1],e}function Le(e,t,n){return e[0]=t,e[1]=n,e}function mt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function gs(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Mc(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function Ac(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function ot(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Xo(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function pi(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function Pc(e){var t=e[0],n=e[1];return t*t+n*n}function mi(e,t){var n=t[0],i=t[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function $t(e,t){return e[0]*t[0]+e[1]*t[1]}function Ec(e,t,n,i){var s=t[0],o=t[1];return e[0]=s+i*(n[0]-s),e[1]=o+i*(n[1]-o),e}const Tc=pi,bn=gs,Bn=Xo;(function(){let e=Te();return function(t,n,i,s,o,r){let a,c;for(n||(n=2),i||(i=0),s?c=Math.min(s*n+i,t.length):c=t.length,a=i;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,r),t[a]=e[0],t[a+1]=e[1];return t}})();function rt(){let e=new _t(3);return e[0]=0,e[1]=0,e[2]=0,e}function gi(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function ws(e,t,n){let i=new _t(3);return i[0]=e,i[1]=t,i[2]=n,i}function Oc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Se(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function fn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Sc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function dn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function bc(e,t){let n=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(n*n+i*i+s*s)}function Bc(e){let t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function _c(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Lt(e,t){let n=t[0],i=t[1],s=t[2],o=n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function Wo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wi(e,t,n){let i=t[0],s=t[1],o=t[2],r=n[0],a=n[1],c=n[2];return e[0]=s*c-o*a,e[1]=o*r-i*c,e[2]=i*a-s*r,e}function Ho(e,t,n,i){let s=t[0],o=t[1],r=t[2];return e[0]=s+i*(n[0]-s),e[1]=o+i*(n[1]-o),e[2]=r+i*(n[2]-r),e}function yi(e,t,n){let i=t[0],s=t[1],o=t[2],r=n[3]*i+n[7]*s+n[11]*o+n[15];return r=r||1,e[0]=(n[0]*i+n[4]*s+n[8]*o+n[12])/r,e[1]=(n[1]*i+n[5]*s+n[9]*o+n[13])/r,e[2]=(n[2]*i+n[6]*s+n[10]*o+n[14])/r,e}function Lc(e,t,n,i){let s=[],o=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Dc(e,t){let n=e[0],i=e[1],s=e[2],o=t[0],r=t[1],a=t[2];return Math.abs(n-o)<=Yt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-r)<=Yt*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(s-a)<=Yt*Math.max(1,Math.abs(s),Math.abs(a))}const jt=Sc,Zo=bc,ys=gi;(function(){let e=rt();return function(t,n,i,s,o,r){let a,c;for(n||(n=3),i||(i=0),s?c=Math.min(s*n+i,t.length):c=t.length,a=i;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,r),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();function qo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fc(e,t){if(e===t){let n=t[1],i=t[2],s=t[3],o=t[6],r=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=s,e[13]=r,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function vi(e,t){let n=t[0],i=t[1],s=t[2],o=t[3],r=t[4],a=t[5],c=t[6],l=t[7],f=t[8],d=t[9],p=t[10],m=t[11],y=t[12],A=t[13],h=t[14],w=t[15],x=n*a-i*r,M=n*c-s*r,v=n*l-o*r,T=i*c-s*a,E=i*l-o*a,S=s*l-o*c,P=f*A-d*y,O=f*h-p*y,L=f*w-m*y,U=d*h-p*A,u=d*w-m*A,g=p*w-m*h,I=x*g-M*u+v*U+T*L-E*O+S*P;return I?(I=1/I,e[0]=(a*g-c*u+l*U)*I,e[1]=(s*u-i*g-o*U)*I,e[2]=(A*S-h*E+w*T)*I,e[3]=(p*E-d*S-m*T)*I,e[4]=(c*L-r*g-l*O)*I,e[5]=(n*g-s*L+o*O)*I,e[6]=(h*v-y*S-w*M)*I,e[7]=(f*S-p*v+m*M)*I,e[8]=(r*u-a*L+l*P)*I,e[9]=(i*L-n*u-o*P)*I,e[10]=(y*E-A*v+w*x)*I,e[11]=(d*v-f*E-m*x)*I,e[12]=(a*O-r*U-c*P)*I,e[13]=(n*U-i*O+s*P)*I,e[14]=(A*M-y*T-h*x)*I,e[15]=(f*T-d*M+p*x)*I,e):null}function Ko(e,t,n){let i=t[0],s=t[1],o=t[2],r=t[3],a=t[4],c=t[5],l=t[6],f=t[7],d=t[8],p=t[9],m=t[10],y=t[11],A=t[12],h=t[13],w=t[14],x=t[15],M=n[0],v=n[1],T=n[2],E=n[3];return e[0]=M*i+v*a+T*d+E*A,e[1]=M*s+v*c+T*p+E*h,e[2]=M*o+v*l+T*m+E*w,e[3]=M*r+v*f+T*y+E*x,M=n[4],v=n[5],T=n[6],E=n[7],e[4]=M*i+v*a+T*d+E*A,e[5]=M*s+v*c+T*p+E*h,e[6]=M*o+v*l+T*m+E*w,e[7]=M*r+v*f+T*y+E*x,M=n[8],v=n[9],T=n[10],E=n[11],e[8]=M*i+v*a+T*d+E*A,e[9]=M*s+v*c+T*p+E*h,e[10]=M*o+v*l+T*m+E*w,e[11]=M*r+v*f+T*y+E*x,M=n[12],v=n[13],T=n[14],E=n[15],e[12]=M*i+v*a+T*d+E*A,e[13]=M*s+v*c+T*p+E*h,e[14]=M*o+v*l+T*m+E*w,e[15]=M*r+v*f+T*y+E*x,e}function Nc(e,t,n){let i=n[0],s=n[1],o=n[2],r,a,c,l,f,d,p,m,y,A,h,w;return t===e?(e[12]=t[0]*i+t[4]*s+t[8]*o+t[12],e[13]=t[1]*i+t[5]*s+t[9]*o+t[13],e[14]=t[2]*i+t[6]*s+t[10]*o+t[14],e[15]=t[3]*i+t[7]*s+t[11]*o+t[15]):(r=t[0],a=t[1],c=t[2],l=t[3],f=t[4],d=t[5],p=t[6],m=t[7],y=t[8],A=t[9],h=t[10],w=t[11],e[0]=r,e[1]=a,e[2]=c,e[3]=l,e[4]=f,e[5]=d,e[6]=p,e[7]=m,e[8]=y,e[9]=A,e[10]=h,e[11]=w,e[12]=r*i+f*s+y*o+t[12],e[13]=a*i+d*s+A*o+t[13],e[14]=c*i+p*s+h*o+t[14],e[15]=l*i+m*s+w*o+t[15]),e}function vs(e,t,n){let i=n[0],s=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function xs(e,t,n){let i=Math.sin(n),s=Math.cos(n),o=t[4],r=t[5],a=t[6],c=t[7],l=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*s+l*i,e[5]=r*s+f*i,e[6]=a*s+d*i,e[7]=c*s+p*i,e[8]=l*s-o*i,e[9]=f*s-r*i,e[10]=d*s-a*i,e[11]=p*s-c*i,e}function Jo(e,t,n){let i=Math.sin(n),s=Math.cos(n),o=t[0],r=t[1],a=t[2],c=t[3],l=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s-l*i,e[1]=r*s-f*i,e[2]=a*s-d*i,e[3]=c*s-p*i,e[8]=o*i+l*s,e[9]=r*i+f*s,e[10]=a*i+d*s,e[11]=c*i+p*s,e}function Qo(e,t,n){let i=Math.sin(n),s=Math.cos(n),o=t[0],r=t[1],a=t[2],c=t[3],l=t[4],f=t[5],d=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s+l*i,e[1]=r*s+f*i,e[2]=a*s+d*i,e[3]=c*s+p*i,e[4]=l*s-o*i,e[5]=f*s-r*i,e[6]=d*s-a*i,e[7]=p*s-c*i,e}function er(e,t,n){let i=n[0],s=n[1],o=n[2],r=Math.sqrt(i*i+s*s+o*o),a,c,l;return Math.abs(r)<Yt?null:(r=1/r,i*=r,s*=r,o*=r,a=Math.sin(t),c=Math.cos(t),l=1-c,e[0]=i*i*l+c,e[1]=s*i*l+o*a,e[2]=o*i*l-s*a,e[3]=0,e[4]=i*s*l-o*a,e[5]=s*s*l+c,e[6]=o*s*l+i*a,e[7]=0,e[8]=i*o*l+s*a,e[9]=s*o*l-i*a,e[10]=o*o*l+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function tr(e,t,n,i){let s,o,r,a,c,l,f,d,p,m,y=t[0],A=t[1],h=t[2],w=i[0],x=i[1],M=i[2],v=n[0],T=n[1],E=n[2];return Math.abs(y-v)<Yt&&Math.abs(A-T)<Yt&&Math.abs(h-E)<Yt?mat4.identity(e):(f=y-v,d=A-T,p=h-E,m=1/Math.sqrt(f*f+d*d+p*p),f*=m,d*=m,p*=m,s=x*p-M*d,o=M*f-w*p,r=w*d-x*f,m=Math.sqrt(s*s+o*o+r*r),m?(m=1/m,s*=m,o*=m,r*=m):(s=0,o=0,r=0),a=d*r-p*o,c=p*s-f*r,l=f*o-d*s,m=Math.sqrt(a*a+c*c+l*l),m?(m=1/m,a*=m,c*=m,l*=m):(a=0,c=0,l=0),e[0]=s,e[1]=a,e[2]=f,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=r,e[9]=l,e[10]=p,e[11]=0,e[12]=-(s*y+o*A+r*h),e[13]=-(a*y+c*A+l*h),e[14]=-(f*y+d*A+p*h),e[15]=1,e)}const nr=Ko;function ir(e,t,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function _n(){let e=new _t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Rc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Cc(e,t){let n=t[0],i=t[1],s=t[2],o=t[3],r=n*n+i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r),e[0]=n*r,e[1]=i*r,e[2]=s*r,e[3]=o*r),e}function Is(e,t,n){let i=t[0],s=t[1],o=t[2],r=t[3];return e[0]=n[0]*i+n[4]*s+n[8]*o+n[12]*r,e[1]=n[1]*i+n[5]*s+n[9]*o+n[13]*r,e[2]=n[2]*i+n[6]*s+n[10]*o+n[14]*r,e[3]=n[3]*i+n[7]*s+n[11]*o+n[15]*r,e}(function(){let e=_n();return function(t,n,i,s,o,r){let a,c;for(n||(n=4),i||(i=0),s?c=Math.min(s*n+i,t.length):c=t.length,a=i;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,r),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();const Xt=_n();class xe{constructor(t,n){this.state=t,this.camera=n,this.position=[0,0,0]}static fromGeo(t,n=[0,0]){const s=Math.sin(ve(t[1])),o=t[0]*4294967296/360,r=Math.log((1+s)/(1-s))*4294967296/(4*Math.PI);let a=0;if(t.length>2){const c=xe.scaleFactor(t[1]);a=(t[2]??0)*Be*c}return n[0]=o,n[1]=Dt(r,-2147483648,2147483648),n[2]=a,n}static toGeo(t,n=[0,0]){n[0]=t[0]*360/4294967296;const i=-2*Math.PI/4294967296;if(n[1]=90-2*Dn(Math.atan(Math.exp(t[1]*i))),t[2]){const s=xe.scaleFactor(n[1]);n[2]=t[2]/Be/s}return n}static scaleFactor(t){return 1/Math.cos(ve(t))}update(){const{center:t,rotation:n,zoom:i,pitch:s,size:o}=this.state,r=xi(i,o),a=Math.max(r*Math.sin(s),1);this.position[0]=t[0]+Math.sin(n)*a,this.position[1]=t[1]-Math.cos(n)*a,this.position[2]=r*Math.cos(s)}project(t,n=!1,i=[NaN,NaN]){const{size:s,viewport:o}=this.state;Xt[0]=t[0],Xt[1]=t[1],Xt[2]=t[2],Xt[3]=1,Is(Xt,Xt,this.camera.viewProjectionMatrix);const[r,a,c,l]=Xt,f=l*2;if(n&&(c>f||c<-f||r>f||r<-f||a>f||a<-f))return i;const p=s[0]/2,m=s[1]/2;return i[0]=p+o.left+r*p/l,i[1]=m+o.top-a*m/l,i}unproject(t,n=[0,0,0]){const{size:i,viewport:s}=this.state;n[0]=(t[0]-s.left)/i[0]*2-1,n[1]=-((Math.max(this.camera.horizonPixelOffset,t[1])-s.top)/i[1])*2+1,n[2]=0,yi(n,n,this.camera.viewProjectionMatrixInverse),n[0]-=this.position[0],n[1]-=this.position[1],n[2]-=this.position[2],Lt(n,n);const o=-this.position[2]/n[2];return n[0]=this.position[0]+n[0]*o,n[1]=this.position[1]+n[1]*o,n[2]=this.position[2]+n[2]*o,n}setState(t){this.state=t}}const Wt=_n();function sr(e){return[e[2],e[0],e[1]]}class Xe{constructor(t,n){this.state=t,this.camera=n,this.position=[0,0,0],this.ivpMatrix=[],this.cachedVisibleArc=new hr(()=>{const i=xi(this.state.zoom,this.state.size)/Be;return Math.acos(hn/(hn+i))},()=>[this.state.zoom]),this.cachedPixelRadius=new hr(()=>{const i=xe.toGeo(this.state.center),s=$c(i,0,this.visibleArc),o=this.project(Xe.fromGeo(s));return o[0]-=this.state.viewport.left+this.state.size[0]/2+(this.state.padding.left-this.state.padding.right)/2,o[1]-=this.state.viewport.top+this.state.size[1]/2+(this.state.padding.top-this.state.padding.bottom)/2,Tc(o)},()=>[this.state.zoom,this.state.cameraConfig.fov,this.state.size[0],this.state.size[1],this.state.padding.bottom,this.state.padding.top,this.state.padding.left,this.state.padding.right,this.camera.globeMatrix[0]]),this.update()}get visibleArc(){return this.cachedVisibleArc.value}get pixelRadius(){return this.cachedPixelRadius.value}static fromGeo(t,n=[NaN,NaN,NaN]){const i=ve(t[0]),s=ve(t[1]),o=Math.cos(i),r=Math.sin(i),a=Math.cos(s),c=Math.sin(s),l=hn*Be;return n[0]=r*a*l,n[1]=c*l,n[2]=o*a*l,n}static toGeo(t,n=[NaN,NaN]){const i=t[0],s=t[1],o=t[2],r=Math.sqrt(i*i+s*s+o*o),a=Math.asin(o/r),c=Math.atan2(s,i);return n[0]=Dn(c),n[1]=Dn(a),n}update(){const{state:t}=this,n=xe.toGeo(t.center),i=xi(t.zoom,t.size)+hn*Be,s=ve(n[0]),o=ve(n[1]),r=Math.cos(s),a=Math.sin(s),c=Math.cos(o),l=Math.sin(o);this.position=[a*c*i,l*i,r*c*i];const f=[0,0,1];tr(this.ivpMatrix,sr(this.position),[0,0,0],f),nr(this.ivpMatrix,this.camera.projectionMatrix,this.ivpMatrix),vi(this.ivpMatrix,this.ivpMatrix)}project(t,n=!1,i=[NaN,NaN]){const{size:s,viewport:o}=this.state,r=_n();Wt[0]=t[0],Wt[1]=t[1],Wt[2]=t[2],Wt[3]=1,Is(Wt,Wt,this.camera.globeMatrix),Is(r,Wt,this.camera.viewProjectionMatrix);const[a,c,l,f]=r,d=f*2;if(n&&(l>d||l<-d||a>d||a<-d||c>d||c<-d))return i[0]=NaN,i[1]=NaN,i;const m=s[0]/2,y=s[1]/2;return i[0]=m+o.left+a*m/f,i[1]=y+o.top-c*y/f,i}unproject(t,n,i=[NaN,NaN,NaN]){const{size:s,viewport:o}=this.state,r=[(t[0]-o.left)/s[0]*2-1,-((Math.max(0,t[1])-o.top)/s[1])*2+1,0],a=sr(this.position),c=[0,0,0,1];yi(c,r,this.ivpMatrix);const l=Lt([],jt([],c,a)),f=_c([],a),d=Wo(f,l),p=Bc(f)-d**2,m=(hn*Be)**2;if(p>m){if(n)return Xe.fromGeo(xe.toGeo(this.state.center));const{left:x,bottom:M,top:v,right:T}=this.state.padding,E=t[0]-o.left-s[0]/2-(x-T)/2,S=t[1]-o.top-s[1]/2-(v-M)/2,P=ot([],mi([],[E,S]),this.pixelRadius-1);return P[0]=P[0]+o.left+s[0]/2+(x-T)/2,P[1]=P[1]+o.top+s[1]/2+(v-M)/2,this.unproject(P,!0,i)}const y=Math.sqrt(m-p),A=d-y,h=d+y,w=Math.min(A,h);return i[0]=a[0]+l[0]*w,i[1]=a[1]+l[1]*w,i[2]=a[2]+l[2]*w,i}setState(t){this.state=t}canSee(t){const n=xe.toGeo(this.state.center);return Yc(n,t)<this.visibleArc}}function Ln(e,t){return{min:e||jo(1/0,1/0),max:t||jo(-1/0,-1/0)}}function Uc(e,t){Mc(e.min,e.min,t),Ac(e.max,e.max,t)}function zc(e,t){return e[0]=t.min[0]+(t.max[0]-t.min[0])/2,e[1]=t.min[1]+(t.max[1]-t.min[1])/2,e}function Vc(e,t){return t[0]<=e.max[0]&&t[0]>=e.min[0]&&t[1]<=e.max[1]&&t[1]>=e.min[1]}const or=6378137,rr=2*Math.PI*or,Be=4294967296/rr;ir([],[-1,-1,0],[2,2,1]),ir([],[.5,.5,0],[.5,.5,1]);const hn=or*(Math.PI/2),Ve=2**15/4294967296;function Ms(e,t,n,i,s,o,r=0){s[0]=(n[0]+i[0])/2,s[1]=(n[1]+i[1])/2;const a=e.project(n),c=e.project(i),l=e.project(s),f=Bn(l,t),d=Bn(a,t),p=Bn(c,t);if(f<o)return s;if(d<o)return n;if(p<o)return i;if(r>=10)return s;const m=d+f,y=p+f;return m>y?Ms(e,t,i,s,s,o,r+1):Ms(e,t,n,s,s,o,r+1)}function ar(e){return Math.max(e,gc)}function xi(e,t){const n=ln,i=ar(t[1])/2,s=4294967296/2**e,o=i/256*s,r=Math.tan(n.fov/2);return o/r}function kc(e){const n=xe.toGeo(e)[1],i=1/(2*Math.cos(ve(n)));return Math.log(i)/Math.log(2)}function cr(e,t){const n=kc(t)*Hc(9,10,e);return e+Dt(n,-1,0)}function lr(e,t){return t*Be*xe.scaleFactor(e[1])}Ln([-2147483648,-2147483648],[4294967296/2,4294967296/2]),Ln([-214748364800,-2147483648],[4294967296*100/2,4294967296/2]);function Qe(e,t){return e*Math.pow(2,-t)*4294967296/256}function fr(e,t){return e===0?-1/0:-Math.log(t*256/(e*4294967296))/Math.LN2}const As=Te(),dr=Te();function Gc(e,t,n){gs(As,n,e),gs(dr,t,e);const i=$t(As,dr)/pi(As);return Math.atan2(i,e[2])}function Yc(e,t){const n=Math.cos(ve(t[0]-e[0])),i=Math.sin(ve(t[1])),s=Math.sin(ve(e[1])),o=Math.cos(ve(t[1])),r=Math.cos(ve(e[1]));return Math.acos(i*s+o*r*n)}function $c(e,t,n){const i=ve(e[0]),s=ve(e[1]),o=[0,0];return o[1]=Math.asin(Math.sin(s)*Math.cos(n)+Math.cos(s)*Math.sin(n)*Math.cos(t)),o[0]=i+Math.atan2(Math.sin(t)*Math.sin(n)*Math.cos(s),Math.cos(n)-Math.sin(s)*Math.sin(o[1])),[Dn(o[0]),Dn(o[1])]}const jc=[0,0,1],Xc=rt(),et=[0,0,0];class Wc{constructor(t){this.state=t,this.position=[0,0,0],this.projectionMatrix=[],this.viewMatrix=[],this.viewMatrixTranspose=[],this.projectionMatrixInverse=[],this.viewProjectionMatrix=[],this.viewProjectionMatrixInverse=[],this.globeMatrix=[],this.ecefMvpMatrix=new Float32Array(16),this.flat2ecef=0,this.fogDistance=0,this.correctedPitch=0,this.correctedRotation=0,this.horizonPixelOffset=0,this.prevZoom=0,this.horizonPixelOffset=0,this.flat=new xe(t,this),this.ecef=new Xe(t,this),this.update()}get globeRatio(){return this.flat2ecef}setState(t){this.state=t,this.flat.setState(t),this.ecef.setState(t),this.update()}update(){const{globeMaxZoom:t}=ui;this.flat2ecef=this.state.globeMode?Dt(t-this.state.zoom,0,1):0,this.limitPitchRotation(),this.updatePosition(),this.updateViewMatrix(),this.updateProjectionMatrices(),this.state.pitch=this.correctedPitch,this.state.rotation=this.correctedRotation,this.flat.update(),this.ecef.update(),Ko(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),vi(this.viewProjectionMatrixInverse,this.viewProjectionMatrix),vi(this.projectionMatrixInverse,this.projectionMatrix),Fc(this.viewMatrixTranspose,this.viewMatrix),this.state.globeMode&&this.updateGlobeMatrix(),nr(this.ecefMvpMatrix,this.viewProjectionMatrix,this.globeMatrix),this.updateHorizonPixelOffset(),this.updateFogDistance()}project(t,n=!1,i=[NaN,NaN]){if(this.flat2ecef<Number.EPSILON)return this.flat.project(xe.fromGeo(t),n,i);if(this.flat2ecef>1-Number.EPSILON)return this.ecef.project(Xe.fromGeo(t),n,i);{const s=this.flat.project(xe.fromGeo(t),n),o=this.ecef.project(Xe.fromGeo(t),n);return Array.from(Ho(i,s,o,this.flat2ecef))}}unproject(t,n=[0,0],i=!1){if(this.flat2ecef<Number.EPSILON){const s=[0,0,0];return this.flat.unproject(t,s),xe.toGeo(s,n),n}else if(this.flat2ecef>1-Number.EPSILON){const s=[0,0,0];return this.ecef.unproject(t,!1,s),Xe.toGeo(s,n),n}else{const s=[0,0,0],o=[0,0,0];return this.flat.unproject(t,s),xe.toGeo(s,s),this.ecef.unproject(t,!1,o),Xe.toGeo(o,o),i?(Ms(this,t,o,s,n,2),n[2]=0,n):(Ho(n,s,o,this.flat2ecef),n[2]=0,n)}}getViewportVertices(t){const{size:n,viewport:i}=this.state;let s={top:0,right:0,bottom:0,left:0};if(t!==void 0){const r=n[0]*t,a=n[1]*t;s={top:r,right:a,bottom:r,left:a}}return[this.flat.unproject([i.left+s.left,n[1]+i.top-s.bottom,0]),this.flat.unproject([n[0]+i.left-s.right,n[1]+i.top-s.bottom,0]),this.flat.unproject([n[0]+i.left-s.right,i.top+s.top,0]),this.flat.unproject([i.left+s.left,i.top+s.top,0])]}getHorizonPixelOffset(){return this.horizonPixelOffset}updatePosition(){const{center:t,zoom:n,size:i}=this.state,s=xi(n,i);this.prevZoom=n;const o=Math.max(s*Math.sin(this.correctedPitch),1);this.position[0]=t[0]+Math.sin(this.correctedRotation)*o,this.position[1]=t[1]-Math.cos(this.correctedRotation)*o,this.position[2]=s*Math.cos(this.correctedPitch)}limitPitchRotation(){const t=this.state,{zoom:n,pitch:i,rotation:s,cameraConfig:o,styleState:r,lowZoomMaxPitch:a,maxPitch:c}=t,{pitchInterStartZoom:l,pitchInterEndZoom:f}=o,{globeInterEndZoom:d,globeMaxZoom:p}=ui;if(this.correctedPitch=i,this.correctedRotation=s,n<f){const m=Math.max(0,n-l)/(f-l);this.correctedPitch=Math.min(i,Fn(a??90,c??90,m))}if(r.globeEnabled&&n<d){const m=Math.max(0,n-p)/(d-p);if(this.correctedPitch=Math.min(this.correctedPitch,Fn(0,c??90,m)),n<=p)this.correctedRotation=0;else if(n!==this.prevZoom){const y=0-s,A=(this.prevZoom-n)/(n-p);A>0&&(this.correctedRotation+=y*A%360)}}}updateProjectionMatrices(){const t=this.state.cameraConfig,n=t.fov;t.useDynamicNearFar||this.state.globeMode?this.updateNearFarState():this.restoreFixedNearFar();const{near:i,far:s}=t,{size:o,view:r}=this.correctViewAndSize(),a=o[0]/o[1];let c=i*Math.tan(n/2),l=2*c,f=a*l,d=-f/2;d+=r.x*f/o[0],c-=r.y*l/o[1],f*=r.width/o[0],l*=r.height/o[1];const p=d+f,m=c-l,y=this.projectionMatrix;y[0]=2*i/(p-d),y[5]=2*i/(c-m),y[8]=(p+d)/(p-d),y[9]=(c+m)/(c-m),y[10]=-(s+i)/(s-i),y[11]=-1,y[14]=-2*s*i/(s-i),y[1]=y[2]=y[3]=y[4]=y[6]=y[7]=y[12]=y[13]=y[15]=0,vi(this.projectionMatrixInverse,this.projectionMatrix)}updateNearFarState(){const{zoom:t,cameraConfig:n}=this.state,i=this.position;if(t>wc)n.near=ln.near;else{const r=.25*i[2],a=Math.min(16-t,1);n.near=r*a+ln.near*(1-a)}const s=(1-Math.min(t,20.5)/21)**2;n.far=ln.far*s}restoreFixedNearFar(){const{cameraConfig:t}=this.state;t.near=ln.near,t.far=ln.far}correctViewAndSize(){const{size:t,padding:n}=this.state,i=Math.max(0,n.top-n.bottom)*Math.tan(this.correctedPitch),s=ar(t[1])+i,o={x:(n.right-n.left)/2,y:(n.bottom-n.top)/2,width:t[0],height:t[1]};o.y+=(s-t[1])/2;const r=[t[0],s];return{view:o,size:r}}updateFogDistance(){const{center:t}=this.state,n=this.state.cameraConfig,i=Zo(this.position,t);this.fogDistance=Math.max(n.minFogDistance,i)}updateViewMatrix(){tr(this.viewMatrix,this.position,this.state.center,jc)}updateGlobeMatrix(){const t=this.globeMatrix,n=[0,0,0];qo(t);const i=xe.toGeo(this.state.center);Se(n,this.state.center[0],this.state.center[1],-this.state.center[2]-hn*Be),Nc(this.globeMatrix,t,n),xs(t,t,ve(i[1])),Jo(t,t,-ve(i[0]))}updateHorizonPixelOffset(){const{viewport:t,size:n,zoom:i}=this.state,s=this.flat.unproject([t.left,n[1]+t.top,0]),o=this.flat.unproject([t.left+n[0]/2,n[1]+t.top,0]),r=this.flat.unproject([n[0]+t.left,n[1]+t.top,0]);jt(et,r,s),Lc(et,et,Xc,ve(90)),Lt(et,et);const a=Qe(n[1]*this.state.cameraConfig.perspectiveDistanceLimitRatio,i);dn(et,et,a),fn(et,o,et),this.flat.project(et,!1,et),this.horizonPixelOffset=Math.max(0,Math.ceil(et[1]))}}function Dt(e,t,n){return e=Math.max(e,t),e=Math.min(e,n),e}function Ps(e){return e===0||Number.isNaN(e)?e:e>0?1:-1}function ve(e){return e*Math.PI/180}function Dn(e){return e/Math.PI*180}function Hc(e,t,n){return Dt((n-e)/(t-e),0,1)}function Fn(e,t,n){return e+(t-e)*n}function Es(e,t){const n=t;typeof e=="number"?n.fill(e):Array.isArray(e)&&typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&(n[0]=e[0],n[1]=e[1],n[2]=e[2])}class hr{constructor(t,n){this.getNewValidFor=n,this.getNewValue=t,this.currentValue=NaN,this.currentValidFor=new Array(n().length).fill(NaN)}get value(){const t=this.getNewValidFor();return this.currentValidFor.some((i,s)=>i!==t[s])&&(this.currentValidFor=t,this.currentValue=this.getNewValue()),this.currentValue}}function ur(){let e=new _t(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Zc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Ts(){let e=new _t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function qc(e,t,n){n=n*.5;let i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Os(e,t,n,i){let s=t[0],o=t[1],r=t[2],a=t[3],c=n[0],l=n[1],f=n[2],d=n[3],p,m,y,A,h;return m=s*c+o*l+r*f+a*d,m<0&&(m=-m,c=-c,l=-l,f=-f,d=-d),1-m>1e-6?(p=Math.acos(m),y=Math.sin(p),A=Math.sin((1-i)*p)/y,h=Math.sin(i*p)/y):(A=1-i,h=i),e[0]=A*s+h*c,e[1]=A*o+h*l,e[2]=A*r+h*f,e[3]=A*a+h*d,e}function Kc(e,t){let n=t[0]+t[4]+t[8],i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let o=(s+1)%3,r=(s+2)%3;i=Math.sqrt(t[s*3+s]-t[o*3+o]-t[r*3+r]+1),e[s]=.5*i,i=.5/i,e[3]=(t[o*3+r]-t[r*3+o])*i,e[o]=(t[o*3+s]+t[s*3+o])*i,e[r]=(t[r*3+s]+t[s*3+r])*i}return e}const pr=Cc;(function(){let e=rt(),t=ws(1,0,0),n=ws(0,1,0);return function(i,s,o){let r=Wo(s,o);return r<-.999999?(wi(e,t,s),ys(e)<1e-6&&wi(e,n,s),Lt(e,e),qc(i,e,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(wi(e,s,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+r,pr(i,i))}})(),function(){let e=Ts(),t=Ts();return function(n,i,s,o,r,a){return Os(e,i,r,a),Os(t,s,o,a),Os(n,e,t,2*a*(1-a)),n}}(),function(){let e=ur();return function(t,n,i,s){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],pr(t,Kc(t,e))}}();const mr=[0,0,0],gr=[0,0,0],Ss=rt();ur();function at(e,t,n,i,s){if(t!==i||n!==s){const o=s-n,r=t-i,a=1/Math.sqrt(o*o+r*r);e[0]=o*a,e[1]=r*a}else e[0]=0,e[1]=0}function wr(e,t,n,i){return jt(mr,n,t),jt(gr,n,i),wi(e,gr,mr),Lt(e,e),e}function gt(e,t,n,i,s){if(t!==i||n!==s){const o=i-t,r=s-n,a=1/Math.sqrt(o*o+r*r);e[0]=o*a,e[1]=r*a}else e[0]=0,e[1]=0}function yr(e,t,n,i,s){const o=t+i,r=n+s,a=t*o+n*r,c=5;if(a!==0){const l=1/a;e[0]=o*l,e[1]=r*l,pi(e)>c&&mi(e,e)}else e[0]=0,e[1]=0}function _e(e){return Dt(e*127,-127,127)}function bs(e,t=e){return e[0]=_e(t[0]),e[1]=_e(t[1]),e}function Jc(e,t,n,i,s){e[0]=t*i+n*s,e[1]=n*i-t*s}function un(e,t){const n=t[0];e[0]=-t[1],e[1]=n}function Qc(e,t){const n=t[0];e[0]=t[1],e[1]=-n}function el(e,t,n){t[0]=gi(Se(Ss,e[0],e[1],e[2])),t[1]=gi(Se(Ss,e[3],e[4],e[5])),t[2]=gi(Se(Ss,e[6],e[7],e[8]))}var Ht=(e=>(e[e.Striped=1]="Striped",e[e.Entrance=2]="Entrance",e[e.Patterned=3]="Patterned",e))(Ht||{}),Nn=(e=>(e[e.Line=0]="Line",e[e.Arrow=1]="Arrow",e[e.StartBorder=2]="StartBorder",e[e.LineEnding=3]="LineEnding",e))(Nn||{}),ge=(e=>(e[e.TileCut=0]="TileCut",e[e.Butt=1]="Butt",e[e.Round=2]="Round",e))(ge||{});const De=Te(),Ii=Te(),pn=Te(),Ft=Te(),Rn=Te(),It=Te(),Bs=Te(),tt=Te();let mn=0,Nt=0;function vr(e,t,n,i,s,o,r,a,c,l){if(!(s<2)){if(gt(De,t[0],n[0],t[1],n[1]),mn=0,o===ge.Round){const f=c!==void 0?c[0]:0,d=l!==void 0?l[0]:0;_s(e,t[0],n[0],(i==null?void 0:i[0])??0,-De[0],-De[1],f,d,a)}for(let f=1;f<s;f++)tl(e,t,n,i,f,s,a,c,l);if(r===ge.Round){const f=c!==void 0?c[s-1]:0,d=l!==void 0?l[s-1]:0;_s(e,t[s-1],n[s-1],(i==null?void 0:i[s-1])??0,De[0],De[1],f,d,a)}}}function tl(e,t,n,i,s,o,r,a,c){const l=s===o-1;if(Le(Rn,t[s-1],n[s-1]),Le(It,t[s],n[s]),a!==void 0&&c!==void 0?(Le(pn,a[s-1],c[s-1]),Le(Ft,a[s],c[s])):(Le(pn,0,0),Le(Ft,0,0)),un(tt,De),l)Nt=0;else{Le(Bs,t[s+1],n[s+1]),gt(Ii,It[0],It[1],Bs[0],Bs[1]);const p=Dt($t(De,Ii),-1,1);if(p<=0)Nt=0,_s(e,It[0],It[1],(i==null?void 0:i[s])??0,De[0],De[1],Ft[0],Ft[1],r);else{const y=Math.sqrt((1-p)/(1+p)),A=Ps($t(tt,Ii));Nt=y*A}}nl(e,0,1,3,3,1,2);const f=tt[0]*Ae,d=tt[1]*Ae;Zt(e,Rn[0],Rn[1],(i==null?void 0:i[s-1])??0,(tt[0]+De[0]*mn)*Ae,(tt[1]+De[1]*mn)*Ae,f,d,pn[0],pn[1],r),Zt(e,Rn[0],Rn[1],(i==null?void 0:i[s-1])??0,(-tt[0]-De[0]*mn)*Ae,(-tt[1]-De[1]*mn)*Ae,-f,-d,pn[0],pn[1],r),Zt(e,It[0],It[1],(i==null?void 0:i[s])??0,(-tt[0]+De[0]*Nt)*Ae,(-tt[1]+De[1]*Nt)*Ae,-f,-d,Ft[0],Ft[1],r),Zt(e,It[0],It[1],(i==null?void 0:i[s])??0,(tt[0]-De[0]*Nt)*Ae,(tt[1]-De[1]*Nt)*Ae,f,d,Ft[0],Ft[1],r),l||(ms(De,Ii),mn=Nt)}function _s(e,t,n,i,s,o,r,a,c){il(e,0,1,2);const l=-s*.01,f=-o*.01;Zt(e,t,n,i,s+l,o+f,s,o,r,a,c),Zt(e,t,n,i,-o+l,s+f,-o,s,r,a,c),Zt(e,t,n,i,o+l,-s+f,o,-s,r,a,c)}function Zt(e,t,n,i,s,o,r,a,c,l,f){const d=e.elements.offset*e.elements.stride,p=d>>1,m=d>>2;e.views.position[p]=16383+t,e.views.position[p+1]=16383+n,e.views.extender[d]=s*127,e.views.extender[d+1]=o*127,e.views.normal[d]=r*127,e.views.normal[d+1]=a*127,"height"in e.views&&(e.views.height[m]=i),"shift"in e.views&&(e.views.shift[m]=c,e.views.shift[m+1]=l),"localID"in e.views&&(e.views.localID[m]=f),e.elements.offset++}function nl(e,t,n,i,s,o,r){const a=e.indices.buffer,c=e.indices.offset,l=e.elements.offset;a[c]=l+t,a[c+1]=l+n,a[c+2]=l+i,a[c+3]=l+s,a[c+4]=l+o,a[c+5]=l+r,e.indices.offset=c+6}function il(e,t,n,i){const s=e.indices.buffer,o=e.indices.offset,r=e.elements.offset;s[o]=r+t,s[o+1]=r+n,s[o+2]=r+i,e.indices.offset=o+3}function Pe(e,t,n){return t.precomputes.forEach((i,s)=>{e.push(n.tileData[s])}),e}function Cn(e,t){for(let n=0,i=t.length;n<i;n++)e.push(t[n]);return e}const sl={x:0,y:1};function ol(e){const t={};for(const n in e)e[n]&&(t[n]=Array.from(e[n]));return t}function Un(e,t){for(const n in e){const i=sl[n];i!==void 0?e[n].push(t[i]):e[n].push(NaN)}}function rl(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mi={},xr;function al(){return xr||(xr=1,function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;Mi.encode=function(i){var s=new Uint8Array(i),o,r=s.length,a="";for(o=0;o<r;o+=3)a+=e[s[o]>>2],a+=e[(s[o]&3)<<4|s[o+1]>>4],a+=e[(s[o+1]&15)<<2|s[o+2]>>6],a+=e[s[o+2]&63];return r%3===2?a=a.substring(0,a.length-1)+"=":r%3===1&&(a=a.substring(0,a.length-2)+"=="),a},Mi.decode=function(i){var s=i.length*.75,o=i.length,r,a=0,c,l,f,d;i[i.length-1]==="="&&(s--,i[i.length-2]==="="&&s--);var p=new ArrayBuffer(s),m=new Uint8Array(p);for(r=0;r<o;r+=4)c=t[i.charCodeAt(r)],l=t[i.charCodeAt(r+1)],f=t[i.charCodeAt(r+2)],d=t[i.charCodeAt(r+3)],m[a++]=c<<2|l>>4,m[a++]=(l&15)<<4|f>>2,m[a++]=(f&3)<<6|d&63;return p}}()),Mi}al();var Ai={},Ir;function cl(){return Ir||(Ir=1,Ai.read=function(e,t,n,i,s){var o,r,a=s*8-i-1,c=(1<<a)-1,l=c>>1,f=-7,d=n?s-1:0,p=n?-1:1,m=e[t+d];for(d+=p,o=m&(1<<-f)-1,m>>=-f,f+=a;f>0;o=o*256+e[t+d],d+=p,f-=8);for(r=o&(1<<-f)-1,o>>=-f,f+=i;f>0;r=r*256+e[t+d],d+=p,f-=8);if(o===0)o=1-l;else{if(o===c)return r?NaN:(m?-1:1)*(1/0);r=r+Math.pow(2,i),o=o-l}return(m?-1:1)*r*Math.pow(2,o-i)},Ai.write=function(e,t,n,i,s,o){var r,a,c,l=o*8-s-1,f=(1<<l)-1,d=f>>1,p=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=i?0:o-1,y=i?1:-1,A=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=f):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),r+d>=1?t+=p/c:t+=p*Math.pow(2,1-d),t*c>=2&&(r++,c/=2),r+d>=f?(a=0,r=f):r+d>=1?(a=(t*c-1)*Math.pow(2,s),r=r+d):(a=t*Math.pow(2,d-1)*Math.pow(2,s),r=0));s>=8;e[n+m]=a&255,m+=y,a/=256,s-=8);for(r=r<<s|a,l+=s;l>0;e[n+m]=r&255,m+=y,r/=256,l-=8);e[n+m-y]|=A*128}),Ai}var Ls,Mr;function ll(){if(Mr)return Ls;Mr=1,Ls=t;var e=cl();function t(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=65536*65536,i=1/n,s=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf8");t.prototype={destroy:function(){this.buf=null},readFields:function(u,g,I){for(I=I||this.length;this.pos<I;){var b=this.readVarint(),B=b>>3,_=this.pos;this.type=b&7,u(B,g,this),this.pos===_&&this.skip(b)}return g},readMessage:function(u,g){return this.readFields(u,g,this.readVarint()+this.pos)},readFixed32:function(){var u=E(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=P(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=E(this.buf,this.pos)+E(this.buf,this.pos+4)*n;return this.pos+=8,u},readSFixed64:function(){var u=E(this.buf,this.pos)+P(this.buf,this.pos+4)*n;return this.pos+=8,u},readFloat:function(){var u=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var g=this.buf,I,b;return b=g[this.pos++],I=b&127,b<128||(b=g[this.pos++],I|=(b&127)<<7,b<128)||(b=g[this.pos++],I|=(b&127)<<14,b<128)||(b=g[this.pos++],I|=(b&127)<<21,b<128)?I:(b=g[this.pos],I|=(b&15)<<28,r(I,u,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2===1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,g=this.pos;return this.pos=u,u-g>=s&&o?L(this.buf,g,u):O(this.buf,g,u)},readBytes:function(){var u=this.readVarint()+this.pos,g=this.buf.subarray(this.pos,u);return this.pos=u,g},readPackedVarint:function(u,g){if(this.type!==t.Bytes)return u.push(this.readVarint(g));var I=a(this);for(u=u||[];this.pos<I;)u.push(this.readVarint(g));return u},readPackedSVarint:function(u){if(this.type!==t.Bytes)return u.push(this.readSVarint());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==t.Bytes)return u.push(this.readBoolean());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==t.Bytes)return u.push(this.readFloat());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==t.Bytes)return u.push(this.readDouble());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==t.Bytes)return u.push(this.readFixed32());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==t.Bytes)return u.push(this.readSFixed32());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==t.Bytes)return u.push(this.readFixed64());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==t.Bytes)return u.push(this.readSFixed64());var g=a(this);for(u=u||[];this.pos<g;)u.push(this.readSFixed64());return u},skip:function(u){var g=u&7;if(g===t.Varint)for(;this.buf[this.pos++]>127;);else if(g===t.Bytes)this.pos=this.readVarint()+this.pos;else if(g===t.Fixed32)this.pos+=4;else if(g===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+g)},writeTag:function(u,g){this.writeVarint(u<<3|g)},realloc:function(u){for(var g=this.length||16;g<this.pos+u;)g*=2;if(g!==this.length){var I=new Uint8Array(g);I.set(this.buf),this.buf=I,this.length=g}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),S(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),S(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),S(this.buf,u&-1,this.pos),S(this.buf,Math.floor(u*i),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),S(this.buf,u&-1,this.pos),S(this.buf,Math.floor(u*i),this.pos+4),this.pos+=8},writeVarint:function(u){if(u=+u||0,u>268435455||u<0){l(u,this);return}this.realloc(4),this.buf[this.pos++]=u&127|(u>127?128:0),!(u<=127)&&(this.buf[this.pos++]=(u>>>=7)&127|(u>127?128:0),!(u<=127)&&(this.buf[this.pos++]=(u>>>=7)&127|(u>127?128:0),!(u<=127)&&(this.buf[this.pos++]=u>>>7&127)))},writeSVarint:function(u){this.writeVarint(u<0?-u*2-1:u*2)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(u.length*4),this.pos++;var g=this.pos;this.pos=U(this.buf,u,this.pos);var I=this.pos-g;I>=128&&p(g,I,this),this.pos=g-1,this.writeVarint(I),this.pos+=I},writeFloat:function(u){this.realloc(4),e.write(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),e.write(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var g=u.length;this.writeVarint(g),this.realloc(g);for(var I=0;I<g;I++)this.buf[this.pos++]=u[I]},writeRawMessage:function(u,g){this.pos++;var I=this.pos;u(g,this);var b=this.pos-I;b>=128&&p(I,b,this),this.pos=I-1,this.writeVarint(b),this.pos+=b},writeMessage:function(u,g,I){this.writeTag(u,t.Bytes),this.writeRawMessage(g,I)},writePackedVarint:function(u,g){g.length&&this.writeMessage(u,m,g)},writePackedSVarint:function(u,g){g.length&&this.writeMessage(u,y,g)},writePackedBoolean:function(u,g){g.length&&this.writeMessage(u,w,g)},writePackedFloat:function(u,g){g.length&&this.writeMessage(u,A,g)},writePackedDouble:function(u,g){g.length&&this.writeMessage(u,h,g)},writePackedFixed32:function(u,g){g.length&&this.writeMessage(u,x,g)},writePackedSFixed32:function(u,g){g.length&&this.writeMessage(u,M,g)},writePackedFixed64:function(u,g){g.length&&this.writeMessage(u,v,g)},writePackedSFixed64:function(u,g){g.length&&this.writeMessage(u,T,g)},writeBytesField:function(u,g){this.writeTag(u,t.Bytes),this.writeBytes(g)},writeFixed32Field:function(u,g){this.writeTag(u,t.Fixed32),this.writeFixed32(g)},writeSFixed32Field:function(u,g){this.writeTag(u,t.Fixed32),this.writeSFixed32(g)},writeFixed64Field:function(u,g){this.writeTag(u,t.Fixed64),this.writeFixed64(g)},writeSFixed64Field:function(u,g){this.writeTag(u,t.Fixed64),this.writeSFixed64(g)},writeVarintField:function(u,g){this.writeTag(u,t.Varint),this.writeVarint(g)},writeSVarintField:function(u,g){this.writeTag(u,t.Varint),this.writeSVarint(g)},writeStringField:function(u,g){this.writeTag(u,t.Bytes),this.writeString(g)},writeFloatField:function(u,g){this.writeTag(u,t.Fixed32),this.writeFloat(g)},writeDoubleField:function(u,g){this.writeTag(u,t.Fixed64),this.writeDouble(g)},writeBooleanField:function(u,g){this.writeVarintField(u,!!g)}};function r(u,g,I){var b=I.buf,B,_;if(_=b[I.pos++],B=(_&112)>>4,_<128||(_=b[I.pos++],B|=(_&127)<<3,_<128)||(_=b[I.pos++],B|=(_&127)<<10,_<128)||(_=b[I.pos++],B|=(_&127)<<17,_<128)||(_=b[I.pos++],B|=(_&127)<<24,_<128)||(_=b[I.pos++],B|=(_&1)<<31,_<128))return c(u,B,g);throw new Error("Expected varint not more than 10 bytes")}function a(u){return u.type===t.Bytes?u.readVarint()+u.pos:u.pos+1}function c(u,g,I){return I?g*4294967296+(u>>>0):(g>>>0)*4294967296+(u>>>0)}function l(u,g){var I,b;if(u>=0?(I=u%4294967296|0,b=u/4294967296|0):(I=~(-u%4294967296),b=~(-u/4294967296),I^4294967295?I=I+1|0:(I=0,b=b+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),f(I,b,g),d(b,g)}function f(u,g,I){I.buf[I.pos++]=u&127|128,u>>>=7,I.buf[I.pos++]=u&127|128,u>>>=7,I.buf[I.pos++]=u&127|128,u>>>=7,I.buf[I.pos++]=u&127|128,u>>>=7,I.buf[I.pos]=u&127}function d(u,g){var I=(u&7)<<4;g.buf[g.pos++]|=I|((u>>>=3)?128:0),u&&(g.buf[g.pos++]=u&127|((u>>>=7)?128:0),u&&(g.buf[g.pos++]=u&127|((u>>>=7)?128:0),u&&(g.buf[g.pos++]=u&127|((u>>>=7)?128:0),u&&(g.buf[g.pos++]=u&127|((u>>>=7)?128:0),u&&(g.buf[g.pos++]=u&127)))))}function p(u,g,I){var b=g<=16383?1:g<=2097151?2:g<=268435455?3:Math.floor(Math.log(g)/(Math.LN2*7));I.realloc(b);for(var B=I.pos-1;B>=u;B--)I.buf[B+b]=I.buf[B]}function m(u,g){for(var I=0;I<u.length;I++)g.writeVarint(u[I])}function y(u,g){for(var I=0;I<u.length;I++)g.writeSVarint(u[I])}function A(u,g){for(var I=0;I<u.length;I++)g.writeFloat(u[I])}function h(u,g){for(var I=0;I<u.length;I++)g.writeDouble(u[I])}function w(u,g){for(var I=0;I<u.length;I++)g.writeBoolean(u[I])}function x(u,g){for(var I=0;I<u.length;I++)g.writeFixed32(u[I])}function M(u,g){for(var I=0;I<u.length;I++)g.writeSFixed32(u[I])}function v(u,g){for(var I=0;I<u.length;I++)g.writeFixed64(u[I])}function T(u,g){for(var I=0;I<u.length;I++)g.writeSFixed64(u[I])}function E(u,g){return(u[g]|u[g+1]<<8|u[g+2]<<16)+u[g+3]*16777216}function S(u,g,I){u[I]=g,u[I+1]=g>>>8,u[I+2]=g>>>16,u[I+3]=g>>>24}function P(u,g){return(u[g]|u[g+1]<<8|u[g+2]<<16)+(u[g+3]<<24)}function O(u,g,I){for(var b="",B=g;B<I;){var _=u[B],D=null,ye=_>239?4:_>223?3:_>191?2:1;if(B+ye>I)break;var $,oe,me;ye===1?_<128&&(D=_):ye===2?($=u[B+1],($&192)===128&&(D=(_&31)<<6|$&63,D<=127&&(D=null))):ye===3?($=u[B+1],oe=u[B+2],($&192)===128&&(oe&192)===128&&(D=(_&15)<<12|($&63)<<6|oe&63,(D<=2047||D>=55296&&D<=57343)&&(D=null))):ye===4&&($=u[B+1],oe=u[B+2],me=u[B+3],($&192)===128&&(oe&192)===128&&(me&192)===128&&(D=(_&15)<<18|($&63)<<12|(oe&63)<<6|me&63,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,ye=1):D>65535&&(D-=65536,b+=String.fromCharCode(D>>>10&1023|55296),D=56320|D&1023),b+=String.fromCharCode(D),B+=ye}return b}function L(u,g,I){return o.decode(u.subarray(g,I))}function U(u,g,I){for(var b=0,B,_;b<g.length;b++){if(B=g.charCodeAt(b),B>55295&&B<57344)if(_)if(B<56320){u[I++]=239,u[I++]=191,u[I++]=189,_=B;continue}else B=_-55296<<10|B-56320|65536,_=null;else{B>56319||b+1===g.length?(u[I++]=239,u[I++]=191,u[I++]=189):_=B;continue}else _&&(u[I++]=239,u[I++]=191,u[I++]=189,_=null);B<128?u[I++]=B:(B<2048?u[I++]=B>>6|192:(B<65536?u[I++]=B>>12|224:(u[I++]=B>>18|240,u[I++]=B>>12&63|128),u[I++]=B>>6&63|128),u[I++]=B&63|128)}return I}return Ls}ll();const fl=/\{(\w+)\}/g;function dl(e,t){return e.replace(fl,(n,i)=>t[i])}Array(16),Ln(),Ln();function hl(e){const t=e[0][0],n=e[0][1],i=e[1][0],s=e[1][1],o=e[2][0],r=e[2][1],a=e[3][0],c=e[3][1];return{min:[Math.min(t,i,o,a),Math.min(n,s,r,c)],max:[Math.max(t,i,o,a),Math.max(n,s,r,c)]}}var ct={};ct.read=function(e,t){return e.readFields(ct._readField,{tiles:[]},t)},ct._readField=function(e,t,n){e===1&&t.tiles.push(ct.Tile.read(n,n.readVarint()+n.pos))},ct.write=function(e,t){if(e.tiles)for(var n=0;n<e.tiles.length;n++)t.writeMessage(1,ct.Tile.write,e.tiles[n])},ct.Tile={},ct.Tile.read=function(e,t){return e.readFields(ct.Tile._readField,{x:0,y:0,zoom:0},t)},ct.Tile._readField=function(e,t,n){e===1?t.x=n.readVarint():e===2?t.y=n.readVarint():e===3&&(t.zoom=n.readVarint())},ct.Tile.write=function(e,t){e.x&&t.writeVarintField(1,e.x),e.y&&t.writeVarintField(2,e.y),e.zoom&&t.writeVarintField(3,e.zoom)};var Fe={};Fe.read=function(e,t){return e.readFields(Fe._readField,{tileGroups:[]},t)},Fe._readField=function(e,t,n){e===1&&t.tileGroups.push(Fe.TileGroup.read(n,n.readVarint()+n.pos))},Fe.write=function(e,t){if(e.tileGroups)for(var n=0;n<e.tileGroups.length;n++)t.writeMessage(1,Fe.TileGroup.write,e.tileGroups[n])},Fe.TileGroup={},Fe.TileGroup.read=function(e,t){return e.readFields(Fe.TileGroup._readField,{x:0,y:0,zoom:0,tiles:[]},t)},Fe.TileGroup._readField=function(e,t,n){e===1?t.x=n.readVarint():e===2?t.y=n.readVarint():e===3?t.zoom=n.readVarint():e===4&&t.tiles.push(Fe.TileGroup.Tile.read(n,n.readVarint()+n.pos))},Fe.TileGroup.write=function(e,t){if(e.x&&t.writeVarintField(1,e.x),e.y&&t.writeVarintField(2,e.y),e.zoom&&t.writeVarintField(3,e.zoom),e.tiles)for(var n=0;n<e.tiles.length;n++)t.writeMessage(4,Fe.TileGroup.Tile.write,e.tiles[n])},Fe.TileGroup.Tile={},Fe.TileGroup.Tile.read=function(e,t){return e.readFields(Fe.TileGroup.Tile._readField,{regionId:0,hash:null,data:null},t)},Fe.TileGroup.Tile._readField=function(e,t,n){e===1?t.regionId=n.readVarint():e===2?t.hash=n.readBytes():e===3&&(t.data=n.readBytes())},Fe.TileGroup.Tile.write=function(e,t){e.regionId&&t.writeVarintField(1,e.regionId),e.hash&&t.writeBytesField(2,e.hash),e.data&&t.writeBytesField(3,e.data)};const Ar=[0,0,0];function Pi(e){return{coords:e,size:Ti(e[2]),offset:gl(e)}}function ul(e){return ps.subdomains[Math.abs(e[0]+e[1])%ps.subdomains.length]}function Rt(e,t,n){e[0]=t[0]*n.size/32768+n.offset[0],e[1]=t[1]*n.size/32768+n.offset[1],e[2]=t[2]}const Ei=rt();function pl(e,t,n,i){Ei[0]=t[0][n],Ei[1]=t[1][n],Ei[2]=(t[2]??[])[n],Rt(e,Ei,i)}function qt(e,t,n){e[0]=(t[0]-n.offset[0])*32768/n.size,e[1]=(t[1]-n.offset[1])*32768/n.size,e[2]=t[2]}function Ti(e){return 2**(32-e)}function Ds(e){return e[0]>=0&&e[0]<=32768&&e[1]>=0&&e[1]<=32768}function gn(e,t){return e*4294967296/(32768*Math.pow(2,t))}function Ye(e){return Dt(e/1048576*32768,0,65535)}function ml(e){return e/32768*1048576}function gl(e){const t=Ti(e[2]),n=2147483648;return ws(e[0]*t-n,e[1]*t-n,0)}const Mt=(e,t)=>{Rt(Ar,t,e);const n=xe.toGeo(Ar);return xe.scaleFactor(n[1])};function Pr(e,t,n){const i=[0,0,0];return Rt(i,[e,t],n),xe.toGeo(i)}function Fs(e,t){return Xe.fromGeo(Pr(t[0],t[1],e))}function wl(e,t,n,i=0){return""}function yl(e,t,n,i){if(isNaN(e.step)||isNaN(e.width))return n;const{tileProps:s,tileAttrs:o}=i,r=Mt(t,[0,0]),a=32768/Ti(t.coords[2])*Be*r;let c=e.step*a;if(isNaN(c)&&(c=0),c===0)return n;const l=e.width*a,f={},d=n.x,p=n.y,m=d.length;for(const P in n)f[P]=[];let y=0;const A=[y];for(let P=1;P<m;P++)y+=Bn([d[P-1],p[P-1]],[d[P],p[P]]),A.push(y);const h=Te(),w=Te(),x=[0,0],M=Math.abs(y/Math.trunc(y/c)),v=[d[0],p[0]];let T=(e.stopLines?1:-1)*Math.sign(e.width),E=0,S=0;for(Un(f,v),e.stopLines&&!o[s.beginningIsCut]&&(gt(h,d[S],p[S],d[S+1],p[S+1]),un(w,h),ot(x,w,T*l),mt(v,v,x),Un(f,v),E+=M/2,T=-T);E<=y;){for(;E>A[S+1];)S++;if(gt(h,d[S],p[S],d[S+1],p[S+1]),un(w,h),T>0)ot(x,w,T*l),mt(v,v,x),ot(x,h,M/2),mt(v,v,x),Un(f,v);else{const P=Math.min(1,(E-A[S])/(A[S+1]-A[S]));Ec(v,[d[S],p[S]],[d[S+1],p[S+1]],P),Un(f,v)}T=-T,E+=M/2}return e.stopLines&&!o[s.endingIsCut]&&(ot(x,w,T*l),mt(v,v,x),Un(f,v)),f}function Ns(e,t,n,i){if(!vl(e)||e.length===0)return n;let s=ol(n);for(const o of e){if(typeof o!="object"||!o)return console.warn(`Wrong value ${o} in modifiers list.`),null;if(!("type"in o))return console.warn(`Wrong value ${o} in modifiers list.`),null;switch(o.type){case"zigzag-modifier":s=yl(o,t,s,i);break;default:return console.warn(`Expression with type ${o.type} cannot be used as geometry modifier.`),null}if(s===null)return null}return s}function vl(e){return!!e&&Array.isArray(e)}const xl=new Set(["bottomCenter","bottomRight","bottomLeft","topCenter","topRight","topLeft","rightBottom","rightCenter","rightTop","leftBottom","leftCenter","leftTop","centerCenter"]);function Il(e){return xl.has(e)}function At(e){return!Array.isArray(e)&&typeof e=="object"&&e!==null&&e.type!==void 0&&e.type!=="color"}function Ml(e){return!Array.isArray(e)&&typeof e=="object"&&e!==null&&e.type==="color"}function Er(e,t){return Array.isArray(e)?e.length>0&&e.every(n=>typeof n===t):!1}function Al(e){return Er(e,"string")}function zn(e){return Er(e,"number")}function Tr(e){return!Array.isArray(e)&&typeof e=="object"&&e!==null&&e.type==="object"}function Pl(e){const t=typeof e;return e===null||t==="string"||t==="number"||t==="boolean"||Al(e)||zn(e)}function Or(e){return Pl(e)||Ml(e)||Tr(e)}function Rs(e){return At(e)&&e.type==="get"}function Kt(e){return{type:"color",value:e}}function El(e,t,n){return`${e}_${t}_${n}`}function Sr(e){return`texture-${e}`}function Tl(e,t){return e+"-"+t}function nt(e){if(typeof e=="number"||zn(e))return e;if(e.type==="literalArray"&&zn(e.array))return e.array;throw new Error("Unsupported simple literal expression. Can't resolve.")}const br=Kt([0,0,0,0]);function Ol(e){return typeof e!="string"?!1:/(#(?:[0-9a-f]{2}){2,4}|#[0-9a-f]{3}|(?:rgba?|hsla?)\((?:\d+%?(?:,|\s)+){2,3}[\s\/]*[\d\.]+%?\))/i.test(e)}function Oi(e){return!!e&&typeof e=="object"&&e.type==="color"}function Sl(e){return!!e&&typeof e=="object"&&e.type==="gradient-color"}function bl(e){const t=e.toLowerCase();let n=br;switch(t[0]){case"#":n=_l(t);break;case"h":n=Ll(t);break;case"r":n=Dl(t);break}return n}function Bl(e){return e.length<7?e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(e.length===5?e[4]+e[4]:"ff"):e.length===7?e+"ff":e}function _l(e){if(!new RegExp(`^#[a-f0-9]{${e.length-1}}$`).test(e)||![4,5,7,9].includes(e.length))return br;const n=Bl(e),i=parseInt(n[1]+n[2],16),s=parseInt(n[3]+n[4],16),o=parseInt(n[5]+n[6],16),r=parseInt(n[7]+n[8],16);return Kt([i,s,o,r])}function Ll(e){const t=Br(e);t[0]/=360,t[1]/=100,t[2]/=100;const[n,i,s]=Fl(t[0],t[1],t[2]),o=t[3]!==void 0?t[3]*255:255;return Kt([Math.round(n),Math.round(i),Math.round(s),Math.round(o)])}function Dl(e){const[t,n,i,s]=Br(e),o=s!==void 0?s*255:255;return Kt([Math.round(t),Math.round(n),Math.round(i),Math.round(o)])}function Br(e){return e.split("(")[1].split(")")[0].split(",").map(n=>parseFloat(n))}function Cs(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Fl(e,t,n){if(t===0)return[n*255,n*255,n*255];const i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;return[Cs(s,i,e+1/3)*255,Cs(s,i,e)*255,Cs(s,i,e-1/3)*255]}function Us(e,t){if(e.length<=t||e.indexOf(`
`)!==-1)return e;const n=[];return e.split(" ").forEach(i=>{const s=n.length-1;n.length===0||n[s].length+i.length>=t?n.push(i):n[s]+=" "+i}),n.join(`
`)}function _r(e){return Math.floor(e/256)}function Nl(e){const t=new Set;return e.forEach(n=>{if(n!==void 0)for(let i=0;i<n.length;i++){const s=n.charCodeAt(i);s!==Je.bomCharCode&&t.add(_r(s))}}),Array.from(t)}function Rl(e,t){Oe(`No glyph for character ${e} (code = ${t}, range = ${_r(t)})`)}const Lr=new Set;function Oe(e){Lr.has(e)||(console.log(e),Lr.add(e))}const Cl=2166136261,Ul=16777619;function zl(e,t){let n=Cl;for(const i of t)n=n^i,n=n*Ul;e.randomSeed=Math.abs(n)}function Dr(e,t,n){let i=.5;return e.randomSeed?(e.randomSeed=e.randomSeed*16807%2147483647,i=(e.randomSeed-1)/2147483646):Oe("Resolve 'random': random seed is absent, the mean value between start and end will be used."),i*(n-t)+t}var Fr=(e=>(e[e.Uniform=1]="Uniform",e[e.Labeling=2]="Labeling",e[e.Generator=3]="Generator",e))(Fr||{}),Nr=(e=>(e[e.Pixels=0]="Pixels",e[e.Meters=1]="Meters",e))(Nr||{});const Vl="bottomCenter",Vn="__overlapped",kl="default",Jt=null;function k(e,t){if(!At(e))return e;if(t.allowedExpressions&&!t.allowedExpressions.has(e.type))return Oe(`Expression of type ${e.type} is not allowed here`),Jt;switch(e.type){case"time":return $l(e,t);case"objectAttr":return Wl(e,t);case"coalesce":return jl(e,t);case"all":return Gl(e,t);case"any":return Yl(e,t);case"featureState":return Zl(e,t);case"get":return Cr(e,t);case"global":return ql(e,t);case"sourceAttr":return Xl(e,t);case"in":return cf(e,t);case"interpolate":return Kl(e,t);case"match":return Jl(e,t);case"step":return Ql(e,t);case"to-boolean":return sf(e,t);case"to-color":return ef(e,t);case"mappoints-to-meters":return tf(e,t);case"meters-to-pixels":return nf(e,t);case"!":return of(e,t);case"==":case"!=":return rf(e,t);case">":case"<":case">=":case"<=":return af(e,t);case"zoom":return t.type==="binder"||t.type==="labeling"?t.styleZoom:t.type==="generator"&&t.tileInfo?t.tileInfo.coords[3]:(Oe(`Zoom expression cannot be used in ${t.type} context`),Jt);case"distance":if(t.type==="binder"){const i=xe.toGeo(t.objectCenter),s=xe.scaleFactor(i[1])*Be;return Zo(t.objectCenter,t.cameraCenter)/s}else return Oe(`Distance expression can't be resolved in the ${t.type} context`),Jt;case"height":return 1;case"+":return lf(e,t);case"*":return ff(e,t);case"^":return df(e,t);case"log10":return hf(e,t);case"random":return uf(e,t);case"literalArray":return pf(e,t);case"literalObject":return{type:"object",value:e.object};case"isBehindObjects":return t.type==="binder"?t.isBehind:(Oe(`isBehindObjects expression cannot be used in ${t.type} context`),Jt);case"geometry-modifier":return e.modifiers;case"line-pattern":return[e.patternType,...e.parameters.map(i=>k(i,t))];case"precompute":return t.tileData[e.precomputeIndex]??null;case"gltf-animation":return Hl(e,t);case"local-time":return Rr(e,t);case"utc-time":return Rr(e,t);default:return Oe(`Not supported expression type <<${e.type}>> in ${JSON.stringify(e)}`),Jt}}function Gl(e,t){return e.array.every(n=>k(n,t)===!0)}function Yl(e,t){return e.array.some(n=>k(n,t)===!0)}function Rr(e,t){const n=Date.now()+ +(t.styleState._customUserTimeOffset||0);if(e.type==="local-time"){const i=e.offset?+(k(e.offset,t)||0)*6e4:0;return n+i}if(e.type==="utc-time"){const i=e.offset?+(k(e.offset,t)||0)*6e4:0;return n+new Date().getTimezoneOffset()*6e4+i}return n}function $l(e,t){const n=i=>{const s=k(e.timeSource,t),o=new Date(+(s||0));return i==="day-minutes-720"?(o.getHours()%12||0)*60+o.getMinutes():o.getTime()};return t.type==="binder"?(t.callBackFn&&t.callBackFn(),Array.isArray(e.format)?e.format.map(i=>n(i)):n(e.format)):n("timestamp")}function jl(e,t){for(const n of e.array){const i=k(n,t);if(i!==null)return i}return null}function Xl(e,t){return t.type==="generator"?t.sourceAttrs[e.property]??null:null}function Wl(e,t){return t.type==="binder"&&t.dynamicObject&&t.dynamicObject[e.property]||null}function Hl(e,t){const n={type:"animation-options"};return e.options?e.options.forEach((i,s)=>n[s]=k(i,t)):At(e)||(n[0]=e),n}function Zl(e,t){if(t.type==="generator"){const n=t.featureAttrs[t.tileProps[e.property]]??null;return Number.isNaN(n)?null:n}else throw new Error("Feature state expression can be resolved only in generator context")}function Cr(e,t){if(t.type==="generator"){let n=t.tileAttrs[t.tileProps[e.property]]??null;return typeof n=="object"&&n!==null&&!Array.isArray(n)&&(n={type:"object",value:n}),Number.isNaN(n)?null:n}else throw new Error("Get expression can be resolved only in generator context")}function ql(e,t){const n=t.styleState[e.property];return n==null?null:typeof n=="object"&&!Array.isArray(n)?{type:"object",value:n}:n}function Kl(e,t){if(e.steps.length===0)return Oe("Interpolate expression contains 0 steps, cannot interpolate"),Jt;const n=k(e.steps[0].value,t),i=k(e.argument,t);if(typeof i!="number")return Oe(`Interpolate value resolved to non-number value: ${i} ${e.argument}`),0;if(Oi(n)){if(At(e.argument)&&e.argument.type==="height"){const s={type:"gradient-color",values:[],steps:[]};return e.steps.forEach(o=>{const r=se(o.key,t),a=k(o.value,t);Oi(a)&&!Number.isNaN(r)&&(s.values.push({type:"color",value:a.value}),s.steps.push(r))}),s.steps.length!==2?(Oe("Gradient expression must resolve 2 steps"),Jt):s}return gf(e,i,t)}return mf(e,i,t)}function Jl(e,t){const n=k(e.input,t),i=e.cases.find(s=>s.values.has(n));return k((i==null?void 0:i.output)??e.defaultOutput,t)}function Ql(e,t){const n=Number(k(e.value,t)),i=zs(e,n,t)-1;return k(e.steps[i].value,t)}function ef(e,t){const n=k(e.value,t);return Ol(n)?bl(n):Oi(n)?n:(console.warn(`Can't resolve expression. Must be color, but got ${n}`),Kt([0,0,0,0]))}function tf(e,t){if(t.type!=="generator"||!t.tileInfo)throw new Error("Выражение `mappoints-to-meters` можно резолвить только в контексте генератора");return k(e.value,t)/(Be*Mt(t.tileInfo,[0,0]))}function nf(e,t){const n=se(e.value,t);let i,s=n*256/rr;if(t.type==="generator"){if(!t.tileInfo)return null;i=t.tileInfo.coords[3],s*=Mt(t.tileInfo,[0,0])}else i=t.styleZoom;return s*2**(i+1)}function sf(e,t){return!!k(e.value,t)}function of(e,t){return!k(e.value,t)}function rf(e,t){const n=k(e.leftValue,t),i=k(e.rightValue,t);switch(e.type){case"==":return n===i;case"!=":return n!==i}}function af(e,t){const n=k(e.leftValue,t);if(n===null)return null;const i=k(e.rightValue,t);if(i===null)return null;switch(e.type){case"<":return n<i;case">":return n>i;case"<=":return n<=i;case">=":return n>=i}}function cf(e,t){const n=k(e.item,t),i=k(e.collection,t);return i===null?!1:typeof i!="object"?(Oe(`InExpression second argument resolved to non-object/non-array value: ${i}`),null):Array.isArray(i)?i.some(s=>s===n):Tr(i)?i.value.hasOwnProperty(n):(Oe(`InExpression second argument resolved incorrectly: ${i}`),null)}function lf(e,t){const n=e.array.map(i=>k(i,t));return zn(n)?n.reduce((i,s)=>i+s,0):(Oe(`Resolve AdditionExpression: arguments are not resolved as an array of numbers: ${n}`),null)}function ff(e,t){const n=e.array.map(i=>k(i,t));return zn(n)?n.reduce((i,s)=>i*s,1):(Oe(`Resolve MultiplicationExpression: arguments are not resolved as an array of numbers: ${n}`),null)}function df(e,t){const n=k(e.base,t);if(typeof n!="number")return Oe(`Resolve PowExpression: base resolved as non-number value: ${n}`),null;const i=k(e.exponent,t);return typeof i!="number"?(Oe(`Resolve PowExpression: exponent resolved as non-number value: ${i}`),null):Math.pow(n,i)}function hf(e,t){const n=k(e.value,t);return typeof n!="number"?(Oe(`Resolve Log10Expression: value resolved as non-number value: ${n}`),null):Math.log10(n)}function uf(e,t){const n=k(e.start,t);if(typeof n!="number")return Oe(`Resolve RandomizationExpression: start resolved as non-number value: ${n}`),null;const i=k(e.end,t);return typeof i!="number"?(Oe(`Resolve RandomizationExpression: end resolved as non-number value: ${i}`),null):i<n?(Oe("Resolve RandomizationExpression: end cannot be less than start."),null):Dr(t,n,i)}function pf(e,t){return e.array.map(n=>k(n,t))}function mf(e,t,n){const i=zs(e,t,n);if(i===0)return Number(k(e.steps[0].value,n));if(i===e.steps.length)return wf(e,n,t);const s=Number(k(e.steps[i-1].value,n));if(n.type==="labeling"&&n.interpolateExpressionAsStep)return s;const o=Ur(e,t,i,n),r=Number(k(e.steps[i].value,n));return(1-o)*s+o*r}function Si(e,t){const n=k(e,t);return Oi(n)?n:Sl(n)?n.values[1]:(console.warn(`Can't resolve expression. Must be color, but got ${n}`),Kt([0,0,0,0]))}function se(e,t,n=NaN){const i=k(e,t);return typeof i=="number"?i:n}function We(e,t,n=""){const i=k(e,t);return typeof i=="string"?i:n}function bi(e,t,n=Vl){const i=k(e,t);return Il(i)?i:n}function gf(e,t,n){const i=zs(e,t,n);if(i===0)return Si(e.steps[0].value,n);if(i===e.steps.length)return Si(e.steps[e.steps.length-1].value,n);const s=Ur(e,t,i,n),o=Si(e.steps[i-1].value,n).value,r=Si(e.steps[i].value,n).value;return Kt([o[0]*(1-s)+r[0]*s,o[1]*(1-s)+r[1]*s,o[2]*(1-s)+r[2]*s,o[3]*(1-s)+r[3]*s])}function wf(e,t,n){const i=e.steps[e.steps.length-1],s=e.base;return s===1?se(i.value,t):se(i.value,t)*Math.pow(s,n-se(i.key,t))}function Ue(e,t,n,i){return{type:"labeling",styleZoom:e,styleState:t,interpolateExpressionAsStep:n,randomSeed:0,tileData:i}}function zs(e,t,n){let i=0;for(;i<e.steps.length&&!(t<se(e.steps[i].key,n));)i++;return i}function Ur(e,t,n,i){const s=e.base,o=se(e.steps[n].key,i)-se(e.steps[n-1].key,i),r=t-se(e.steps[n-1].key,i);return s===1?r/o:(Math.pow(s,r)-1)/(Math.pow(s,o)-1)}function wn(e,t,n,i=!1){const s=[];return Qt(s,e,t,n),i?s:Array.from(new Set(s))}Ts();function Qt(e,t,n,i){if(!At(t)){e.push(t);return}switch(t.type){case"all":return yf(e,t,n,i);case"match":return vf(e,t,n,i);case"step":return xf(e,t,n,i);case"interpolate":return If(e,t,n,i);case"precompute":if(i){const s=i.precomputes[t.precomputeIndex].expr;Qt(e,s,n,i);return}break;case"get":{if(!n){console.error("There is no context to resolve the expression. The value from data will not be added to the result.");return}const s=Cr(t,n);e.push(s);return}}}function yf(e,t,n,i){t.array.forEach(s=>Qt(e,s,n,i))}function vf(e,t,n,i){Qt(e,t.defaultOutput),t.cases.forEach(s=>Qt(e,s.output,n,i))}function xf(e,t,n,i){t.steps.forEach(s=>Qt(e,s.value,n,i))}function If(e,t,n,i){t.steps.forEach(s=>Qt(e,s.value,n,i))}const lt=1,ft=-1,dt=[.5,.5],it=[.5,.5],ue=[.5,.5],yn=[.5,.5],Vs=[0,0];let He,le,he,pe=0,Ze=0,Ne=0,ze=0;const Mf={x:0,y:0,z:0,xn2:0,yn2:0,xn1:0,yn1:0,patternedLine:!1,noTurn:!0,leftTurn:!1,sharpTurn:!1,reverseTurn:!1,extender:[.5,.5],faExtender:[.5,.5],saExtender:[.5,.5]},Af=1-1e-4,Pf=0,zr=-.9;function Ef(e,t,n,i,s,o,r,a){const c=Mf;c.x=e,c.y=t,c.z=n,c.xn2=i,c.yn2=s,c.xn1=o,c.yn1=r,c.patternedLine=a;const l=i*o+s*r;return c.noTurn=l>Af,c.leftTurn=i*-r+s*o<0,c.sharpTurn=l<Pf&&l>zr,c.reverseTurn=l<zr,c}function ks(e,t,n,i,s,o,r,a,c,l,f,d,p=!1){let m,y,A,h,w,x,M,v,T,E,S,P,O;if(i!==0)if(he=f,le=d,He=le.indices,Ze=le.elements.offset,pe=0,Ne=0,ze=0,e[0],t[0],i===1)m=e[0],y=t[0],A=(n==null?void 0:n[0])??0,O=0,Pt(He,Ze,0,2,1,1,2,3),we(le,he,0,m,y,A,1,-1,1,-1,O,!1,ft),we(le,he,0,m,y,A,-1,-1,-1,-1,O,!1,lt),we(le,he,0,m,y,A,1,1,1,1,O,!1,ft),we(le,he,0,m,y,A,-1,1,-1,1,O,!1,lt),pe=pe+4;else{switch(h=e[0],w=t[0],x=(n==null?void 0:n[0])??0,M=e[1],v=t[1],T=(n==null?void 0:n[1])??0,O=p?he.cDist:0,s){case ge.TileCut:at(dt,h,w,r,a),at(ue,M,v,h,w),P=Gs(M,v,T,dt[0],dt[1],ue[0],ue[1],p),P.noTurn?Vr(h,w,x,ue[0],ue[1],O):Bi(0,h,w,x,dt[0],dt[1],ue[0],ue[1],O,p);break;case ge.Butt:case ge.Round:at(ue,M,v,h,w),Vr(h,w,x,ue[0],ue[1],O),s===ge.Round&&Bi(0,h,w,x,ue[0],ue[1],ue[0],ue[1],O,p);break;default:throw new Error("LoftedLine: unknown Ending Type")}const L=i-1;for(let g=1;g<L;g++){h=e[g-1],w=t[g-1],x=(n==null?void 0:n[g-1])??0,M=e[g],v=t[g],T=(n==null?void 0:n[g])??0,E=e[g+1],S=t[g+1];const I=M-h,b=v-w;O+=Math.sqrt(I*I+b*b)/32768,at(dt,M,v,h,w),at(ue,E,S,M,v),Bi(g,M,v,T,dt[0],dt[1],ue[0],ue[1],O,p)}h=e[i-2],w=t[i-2],x=(n==null?void 0:n[i-2])??0,M=e[L],v=t[L],T=(n==null?void 0:n[L])??0;const U=M-h,u=v-w;switch(O+=Math.sqrt(U*U+u*u)/32768,o){case ge.TileCut:at(dt,M,v,h,w),at(ue,c,l,M,v),P=Gs(M,v,T,dt[0],dt[1],ue[0],ue[1],p),P.noTurn?kr(L,M,v,T,ue[0],ue[1],O):Gr(L,O,P);break;case ge.Butt:case ge.Round:at(ue,M,v,h,w),kr(L,M,v,T,ue[0],ue[1],O),o===ge.Round&&Bi(L,M,v,T,ue[0],ue[1],-ue[0],-ue[1],O,p);break;default:throw new Error("LoftedLine: unknown Ending Type")}}}function Gs(e,t,n,i,s,o,r,a){const c=Ef(e,t,n,i,s,o,r,a);if(!c.noTurn&&!c.reverseTurn){yr(it,i,s,o,r);const l=it[0],f=it[1];c.extender[0]=l,c.extender[1]=f,c.faExtender[0]=l-i*2,c.faExtender[1]=f-s*2,c.saExtender[0]=l-o*2,c.saExtender[1]=f-r*2}else c.extender[0]=0,c.extender[1]=0,c.faExtender[0]=0,c.faExtender[1]=0,c.saExtender[0]=0,c.saExtender[1]=0;return c}function Ys(e,t,n,i,s,o,r,a,c,l){yr(it,s,o,r,a),s*-a+o*r<0?we(le,he,e,t,n,i,-it[0],-it[1],-it[0],-it[1],c,!1,l):we(le,he,e,t,n,i,it[0],it[1],it[0],it[1],c,!1,l),pe++}function Bi(e,t,n,i,s,o,r,a,c,l){const f=Gs(t,n,i,s,o,r,a,l);Gr(e,c,f),Tf(e,c,f),Of(e,c,f)}function Vr(e,t,n,i,s,o){we(le,he,0,e,t,n,-i,-s,-i,-s,o,!1,lt),we(le,he,0,e,t,n,i,s,i,s,o,!1,ft),pe=pe+2,Ne=1,ze=0}function kr(e,t,n,i,s,o,r){const a=pe+1,c=pe;we(le,he,e,t,n,i,-s,-o,-s,-o,r,!1,lt),we(le,he,e,t,n,i,s,o,s,o,r,!1,ft),pe=pe+2,Pt(He,Ze,ze,c,Ne,Ne,c,a),Ne=a,ze=c}function Tf(e,t,n){if(n.noTurn)return;const i=n.sharpTurn?2:1;let s,o;n.reverseTurn||n.patternedLine&&n.sharpTurn?(s=ze,o=Ne):n.leftTurn?(s=Ne,o=pe+i):(s=pe+i,o=ze);const r=pe;if($s(He,Ze,Ne,ze,r),n.sharpTurn){const c=pe+1;n.leftTurn?Pt(He,Ze,r,c,s,s,c,o):Pt(He,Ze,r,o,c,c,o,s)}else n.leftTurn,$s(He,Ze,r,o,s);const a=n.leftTurn?lt:ft;n.sharpTurn?(n.leftTurn?at(yn,n.xn2,n.yn2,n.xn1,n.yn1):at(yn,n.xn1,n.yn1,n.xn2,n.yn2),Ys(e,n.x,n.y,n.z,n.xn2,n.yn2,yn[0],yn[1],t,a),Ys(e,n.x,n.y,n.z,yn[0],yn[1],n.xn1,n.yn1,t,a)):Ys(e,n.x,n.y,n.z,n.xn2,n.yn2,n.xn1,n.yn1,t,a),n.reverseTurn||(n.leftTurn?we(le,he,e,n.x,n.y,n.z,-n.xn1,-n.yn1,-n.xn1,-n.yn1,t,!1,a):we(le,he,e,n.x,n.y,n.z,n.xn1,n.yn1,n.xn1,n.yn1,t,!1,a),pe++),ze=o,Ne=s}function Gr(e,t,n){if(n.noTurn)return;const i=pe+1,s=pe;if(n.reverseTurn||n.patternedLine&&n.sharpTurn?(we(le,he,e,n.x,n.y,n.z,-n.xn2,-n.yn2,-n.xn2,-n.yn2,t,!1,lt),we(le,he,e,n.x,n.y,n.z,n.xn2,n.yn2,n.xn2,n.yn2,t,!1,ft)):n.leftTurn?(we(le,he,e,n.x,n.y,n.z,-n.xn2,-n.yn2,n.faExtender[0],n.faExtender[1],t,!0,lt),we(le,he,e,n.x,n.y,n.z,n.xn2,n.yn2,n.extender[0],n.extender[1],t,!0,ft)):(we(le,he,e,n.x,n.y,n.z,-n.xn2,-n.yn2,-n.extender[0],-n.extender[1],t,!0,lt),we(le,he,e,n.x,n.y,n.z,n.xn2,n.yn2,-n.faExtender[0],-n.faExtender[1],t,!0,ft)),pe=pe+2,Pt(He,Ze,ze,s,Ne,Ne,s,i),ze=s,Ne=i,!n.patternedLine&&!n.reverseTurn){const o=pe+1,r=pe;n.leftTurn?(we(le,he,e,n.x,n.y,n.z,-n.xn2,-n.yn2,-n.xn2,-n.yn2,t,!1,0),we(le,he,e,n.x,n.y,n.z,0,0,0,0,t,!1,0),Pt(He,Ze,i,s,o,o,s,r)):(we(le,he,e,n.x,n.y,n.z,0,0,0,0,t,!1,0),we(le,he,e,n.x,n.y,n.z,n.xn2,n.yn2,n.xn2,n.yn2,t,!1,0),Pt(He,Ze,s,r,i,i,r,o)),pe=pe+2,ze=r,Ne=o}}function Of(e,t,n){if(n.noTurn||n.reverseTurn)return;const i=pe+1,s=pe;if(n.patternedLine&&n.sharpTurn){we(le,he,e,n.x,n.y,n.z,n.xn2,n.yn2,n.xn2,n.yn2,t,!1,lt),we(le,he,e,n.x,n.y,n.z,-n.xn2,-n.yn2,-n.xn2,-n.yn2,t,!1,ft),pe=pe+2,ze=s,Ne=i;return}else n.leftTurn?(we(le,he,e,n.x,n.y,n.z,-n.xn1,-n.yn1,n.saExtender[0],n.saExtender[1],t,!1,lt),we(le,he,e,n.x,n.y,n.z,n.xn1,n.yn1,n.extender[0],n.extender[1],t,!1,ft)):(we(le,he,e,n.x,n.y,n.z,-n.xn1,-n.yn1,-n.extender[0],-n.extender[1],t,!1,lt),we(le,he,e,n.x,n.y,n.z,n.xn1,n.yn1,-n.saExtender[0],-n.saExtender[1],t,!1,ft));pe=pe+2,n.leftTurn?Pt(He,Ze,ze,s,Ne,Ne,s,i):Pt(He,Ze,Ne,ze,i,i,ze,s),ze=s,Ne=i}function we(e,t,n,i,s,o,r,a,c,l,f,d,p){const m=e.elements.offset*t.offsetMultiplier,y=m>>1,A=m<<1;if(e.views.position[m]=16383+i,e.views.position[m+1]=16383+s,e.views.extender[m]=Math.floor(c*Ae*127+.5),e.views.extender[m+1]=Math.floor(l*Ae*127+.5),t.type===Ht.Patterned){const h=e,w=1e-5;h.views.texture[y]=(w+f)*Math.sign(p)}else if(t.type===Ht.Striped){const h=e;h.views.texExtender[A]=_e(r*Ae),h.views.texExtender[A+1]=_e(a*Ae),h.views.vertexDistance[y]=f,h.views.objectLength[y]=t.oLen,"componentDistance"in e.views&&(e.views.componentDistance[y]=t.cDist)}else if(t.type===Ht.Entrance){const h=e,{px:w,py:x,count:M}=t,v=n===0,T=n===M-1,E=v?n:n-1,S=v?n+1:n;gt(Vs,w[E],x[E],w[S],x[S]),h.views.direction[m]=Math.round(Vs[0]*127),h.views.direction[m+1]=Math.round(Vs[1]*127),h.views.type[y]=T?Nn.LineEnding:Nn.Line,h.views.texExtender[A]=_e(r*(d||T?-1:1)*Ae),h.views.texExtender[A+1]=_e(a*(d||T?-1:1)*Ae),h.views.vertexDistance[y]=f,h.views.objectLength[y]=t.oLen}e.views.localID[y]=t.localID,"height"in e.views&&(e.views.height[y]=o),e.elements.offset++}function $s(e,t,n,i,s){const o=e.buffer,r=e.offset;o[r]=t+n,o[r+1]=t+i,o[r+2]=t+s,e.offset=r+3}function Pt(e,t,n,i,s,o,r,a){const c=e.buffer,l=e.offset;c[l]=t+n,c[l+1]=t+i,c[l+2]=t+s,c[l+3]=t+o,c[l+4]=t+r,c[l+5]=t+a,e.offset=l+6}function Yr(e){return e/96}const $r=32,jr=512;function Sf(e,t,n,i,s){const o=[e[0][0],e[1][0]],r=ve(90+i),a=[];Rt(a,o,s);const c=xe.toGeo(a),l=lr(c,t),f=lr(c,n),d=Math.sqrt(l**2+f**2)/2,p=Math.atan(l/-f)+Math.PI+r,m=d*Math.cos(p),y=d*Math.sin(p),A=Math.atan(-l/-f)+Math.PI+r,h=d*Math.cos(A),w=d*Math.sin(A),x=Math.atan(-l/f)+2*Math.PI+r,M=d*Math.cos(x),v=d*Math.sin(x),T=Math.atan(l/f)+r,E=d*Math.cos(T),S=d*Math.sin(T),P=[],O=[],L=[],U=[];return qt(P,[a[0]+m,a[1]+y],s),qt(O,[a[0]+h,a[1]+w],s),qt(L,[a[0]+M,a[1]+v],s),qt(U,[a[0]+E,a[1]+S],s),[[P[0],O[0],L[0],U[0]],[P[1],O[1],L[1],U[1]]]}function js(e,t){const n=Math.max(e,t);return n*$r>jr?jr/n:$r}function bf(){let e=new _t(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}var _i={exports:{}},Li={exports:{}},Bf=Li.exports,Xr;function _f(){return Xr||(Xr=1,function(e,t){(function(n,i){e.exports=i()})(Bf,function(){function n(r,a,c,l,f){i(r,a,c||0,l||r.length-1,f||o)}function i(r,a,c,l,f){for(;l>c;){if(l-c>600){var d=l-c+1,p=a-c+1,m=Math.log(d),y=.5*Math.exp(2*m/3),A=.5*Math.sqrt(m*y*(d-y)/d)*(p-d/2<0?-1:1),h=Math.max(c,Math.floor(a-p*y/d+A)),w=Math.min(l,Math.floor(a+(d-p)*y/d+A));i(r,a,h,w,f)}var x=r[a],M=c,v=l;for(s(r,c,a),f(r[l],x)>0&&s(r,c,l);M<v;){for(s(r,M,v),M++,v--;f(r[M],x)<0;)M++;for(;f(r[v],x)>0;)v--}f(r[c],x)===0?s(r,c,v):(v++,s(r,v,l)),v<=a&&(c=v+1),a<=v&&(l=v-1)}}function s(r,a,c){var l=r[a];r[a]=r[c],r[c]=l}function o(r,a){return r<a?-1:r>a?1:0}return n})}(Li)),Li.exports}var Wr;function Lf(){if(Wr)return _i.exports;Wr=1,_i.exports=t,_i.exports.default=t;var e=_f();function t(h,w){if(!(this instanceof t))return new t(h,w);this._maxEntries=Math.max(4,h||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),w&&this._initFormat(w),this.clear()}t.prototype={all:function(){return this._all(this.data,[])},search:function(h){var w=this.data,x=[],M=this.toBBox;if(!m(h,w))return x;for(var v=[],T,E,S,P;w;){for(T=0,E=w.children.length;T<E;T++)S=w.children[T],P=w.leaf?M(S):S,m(h,P)&&(w.leaf?x.push(S):p(h,P)?this._all(S,x):v.push(S));w=v.pop()}return x},collides:function(h){var w=this.data,x=this.toBBox;if(!m(h,w))return!1;for(var M=[],v,T,E,S;w;){for(v=0,T=w.children.length;v<T;v++)if(E=w.children[v],S=w.leaf?x(E):E,m(h,S)){if(w.leaf||p(h,S))return!0;M.push(E)}w=M.pop()}return!1},load:function(h){if(!(h&&h.length))return this;if(h.length<this._minEntries){for(var w=0,x=h.length;w<x;w++)this.insert(h[w]);return this}var M=this._build(h.slice(),0,h.length-1,0);if(!this.data.children.length)this.data=M;else if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){var v=this.data;this.data=M,M=v}this._insert(M,this.data.height-M.height-1,!0)}return this},insert:function(h){return h&&this._insert(h,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(h,w){if(!h)return this;for(var x=this.data,M=this.toBBox(h),v=[],T=[],E,S,P,O;x||v.length;){if(x||(x=v.pop(),S=v[v.length-1],E=T.pop(),O=!0),x.leaf&&(P=n(h,x.children,w),P!==-1))return x.children.splice(P,1),v.push(x),this._condense(v),this;!O&&!x.leaf&&p(x,M)?(v.push(x),T.push(E),E=0,S=x,x=x.children[0]):S?(E++,x=S.children[E],O=!1):x=null}return this},toBBox:function(h){return h},compareMinX:r,compareMinY:a,toJSON:function(){return this.data},fromJSON:function(h){return this.data=h,this},_all:function(h,w){for(var x=[];h;)h.leaf?w.push.apply(w,h.children):x.push.apply(x,h.children),h=x.pop();return w},_build:function(h,w,x,M){var v=x-w+1,T=this._maxEntries,E;if(v<=T)return E=y(h.slice(w,x+1)),i(E,this.toBBox),E;M||(M=Math.ceil(Math.log(v)/Math.log(T)),T=Math.ceil(v/Math.pow(T,M-1))),E=y([]),E.leaf=!1,E.height=M;var S=Math.ceil(v/T),P=S*Math.ceil(Math.sqrt(T)),O,L,U,u;for(A(h,w,x,P,this.compareMinX),O=w;O<=x;O+=P)for(U=Math.min(O+P-1,x),A(h,O,U,S,this.compareMinY),L=O;L<=U;L+=S)u=Math.min(L+S-1,U),E.children.push(this._build(h,L,u,M-1));return i(E,this.toBBox),E},_chooseSubtree:function(h,w,x,M){for(var v,T,E,S,P,O,L,U;M.push(w),!(w.leaf||M.length-1===x);){for(L=U=1/0,v=0,T=w.children.length;v<T;v++)E=w.children[v],P=c(E),O=f(h,E)-P,O<U?(U=O,L=P<L?P:L,S=E):O===U&&P<L&&(L=P,S=E);w=S||w.children[0]}return w},_insert:function(h,w,x){var M=this.toBBox,v=x?h:M(h),T=[],E=this._chooseSubtree(v,this.data,w,T);for(E.children.push(h),o(E,v);w>=0&&T[w].children.length>this._maxEntries;)this._split(T,w),w--;this._adjustParentBBoxes(v,T,w)},_split:function(h,w){var x=h[w],M=x.children.length,v=this._minEntries;this._chooseSplitAxis(x,v,M);var T=this._chooseSplitIndex(x,v,M),E=y(x.children.splice(T,x.children.length-T));E.height=x.height,E.leaf=x.leaf,i(x,this.toBBox),i(E,this.toBBox),w?h[w-1].children.push(E):this._splitRoot(x,E)},_splitRoot:function(h,w){this.data=y([h,w]),this.data.height=h.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},_chooseSplitIndex:function(h,w,x){var M,v,T,E,S,P,O,L;for(P=O=1/0,M=w;M<=x-w;M++)v=s(h,0,M,this.toBBox),T=s(h,M,x,this.toBBox),E=d(v,T),S=c(v)+c(T),E<P?(P=E,L=M,O=S<O?S:O):E===P&&S<O&&(O=S,L=M);return L},_chooseSplitAxis:function(h,w,x){var M=h.leaf?this.compareMinX:r,v=h.leaf?this.compareMinY:a,T=this._allDistMargin(h,w,x,M),E=this._allDistMargin(h,w,x,v);T<E&&h.children.sort(M)},_allDistMargin:function(h,w,x,M){h.children.sort(M);var v=this.toBBox,T=s(h,0,w,v),E=s(h,x-w,x,v),S=l(T)+l(E),P,O;for(P=w;P<x-w;P++)O=h.children[P],o(T,h.leaf?v(O):O),S+=l(T);for(P=x-w-1;P>=w;P--)O=h.children[P],o(E,h.leaf?v(O):O),S+=l(E);return S},_adjustParentBBoxes:function(h,w,x){for(var M=x;M>=0;M--)o(w[M],h)},_condense:function(h){for(var w=h.length-1,x;w>=0;w--)h[w].children.length===0?w>0?(x=h[w-1].children,x.splice(x.indexOf(h[w]),1)):this.clear():i(h[w],this.toBBox)},_initFormat:function(h){var w=["return a"," - b",";"];this.compareMinX=new Function("a","b",w.join(h[0])),this.compareMinY=new Function("a","b",w.join(h[1])),this.toBBox=new Function("a","return {minX: a"+h[0]+", minY: a"+h[1]+", maxX: a"+h[2]+", maxY: a"+h[3]+"};")}};function n(h,w,x){if(!x)return w.indexOf(h);for(var M=0;M<w.length;M++)if(x(h,w[M]))return M;return-1}function i(h,w){s(h,0,h.children.length,w,h)}function s(h,w,x,M,v){v||(v=y(null)),v.minX=1/0,v.minY=1/0,v.maxX=-1/0,v.maxY=-1/0;for(var T=w,E;T<x;T++)E=h.children[T],o(v,h.leaf?M(E):E);return v}function o(h,w){return h.minX=Math.min(h.minX,w.minX),h.minY=Math.min(h.minY,w.minY),h.maxX=Math.max(h.maxX,w.maxX),h.maxY=Math.max(h.maxY,w.maxY),h}function r(h,w){return h.minX-w.minX}function a(h,w){return h.minY-w.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function l(h){return h.maxX-h.minX+(h.maxY-h.minY)}function f(h,w){return(Math.max(w.maxX,h.maxX)-Math.min(w.minX,h.minX))*(Math.max(w.maxY,h.maxY)-Math.min(w.minY,h.minY))}function d(h,w){var x=Math.max(h.minX,w.minX),M=Math.max(h.minY,w.minY),v=Math.min(h.maxX,w.maxX),T=Math.min(h.maxY,w.maxY);return Math.max(0,v-x)*Math.max(0,T-M)}function p(h,w){return h.minX<=w.minX&&h.minY<=w.minY&&w.maxX<=h.maxX&&w.maxY<=h.maxY}function m(h,w){return w.minX<=h.maxX&&w.minY<=h.maxY&&w.maxX>=h.minX&&w.maxY>=h.minY}function y(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function A(h,w,x,M,v){for(var T=[w,x],E;T.length;)x=T.pop(),w=T.pop(),!(x-w<=M)&&(E=w+Math.ceil((x-w)/M/2)*M,e(h,E,w,x,v),T.push(w,E,E,x))}return _i.exports}var Df=Lf(),Hr=rl(Df);rt(),rt();const Ff=Te(),Nf=Te();bf();function Rf(e,t,n){const i=bn(Ff,t,e),s=bn(Nf,n,e);return $t(s,i)/Pc(i)}function Zr(e,t,n,i,s){const o=Yr(s);wn(i.textureImage).forEach(r=>{if(!r.length)return;const a=n.byKey[Sr(r)];if(!a){console.error(`Not found raster set with texture ${r}`);return}if(!a.isSvg)return;const c=i.textureSize;let l;if(i.lengthUnits===Nr.Meters){const[d,p=d]=c;l=[d*js(d,d),p*js(p,p)]}else l=Cf(c);l.forEach(d=>{const[p,m]=Array.isArray(d)?d:[d,d];e.atlasPacker.packSvg(a,[{w:p,h:m}],o),a.rasters.forEach(y=>e.atlasPacker.addRastersToLoad(t,y))})})}function Cf(e){return At(e)?e.type==="step"?e.steps.map(t=>Array.isArray(t.value)||typeof t.value=="number"?t.value:t.value.type==="literalArray"?t.value.array:(console.warn("textureSize only supports shallow step expression"),[0])):e.type==="literalArray"?[nt(e)]:(Oe(`Unsupported texture size expression of type "${e.type}". Can't resovle.`),[0]):[e]}function Xs(e,t){const{tileAttrs:n,tileProps:i}=e,s=Number.isNaN(n[i.db_begin_nominal_height])?0:n[i.db_begin_nominal_height]??0,o=Number.isNaN(n[i.db_end_nominal_height])?0:n[i.db_end_nominal_height]??0,r=n[i.objectLength]??1,a=n[i.componentDistanceStart]??0,c=n[i.componentDistanceEnd]??0,l=Fn(s,o,a/r),f=Fn(s,o,c/r),d=e.tileInfo?Mt(e.tileInfo,[0,0]):1,p=Array.from({length:t.x.length});if(l===f)return p.fill(l*Be*d),p;const m=t.x.length;for(let y=0;y<m;y++)p[y]=Be*d*Fn(l,f,Rf([t.x[0],t.y[0]],[t.x[m-1],t.y[m-1]],[t.x[y],t.y[y]]));return p}const ht={symbol:"line",sinks:{solid:{stride:12,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int8Array(t,4),e.views.normal=new Int8Array(t,6),e.views.localID=new Uint32Array(t,8)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}},solid3d:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int8Array(t,4),e.views.normal=new Int8Array(t,6),e.views.height=new Float32Array(t,8),e.views.localID=new Uint32Array(t,12)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}},patterned:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int16Array(t,4),e.views.texture=new Float32Array(t,8),e.views.localID=new Uint32Array(t,12)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}},patterned3d:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int16Array(t,4),e.views.texture=new Float32Array(t,8),e.views.height=new Float32Array(t,12),e.views.localID=new Uint32Array(t,16)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}}},generate(e,t,n,i,s,o){const r=Ns(k(n.style.geometryModifier,i),s,o,i);if(r===null)return;const{tileAttrs:a,tileProps:c}=i,l=n.style.withHeight?Xs(i,r):void 0,f=e.idIndexer.getIndex(i,t,n),d=k(n.ignoreTier,i)?null:i.tileAttrs[c.db_tiers],p=n.style.withHeight?e.getBucket(n.type,"solid3d",ht.sinks.solid3d.packObjectAttributes(t,n,d,i),ht.sinks.solid3d.binder):e.getBucket(n.type,"solid",ht.sinks.solid.packObjectAttributes(t,n,d,i),ht.sinks.solid.binder),m=Number.isNaN(a[c.beginningIsCut])?!1:a[c.beginningIsCut]!==0,y=Number.isNaN(a[c.endingIsCut])?!1:a[c.endingIsCut]!==0,A=We(n.style.startCap,i),h=We(n.style.endCap,i);vr(p,r.x,r.y,l,r.x.length,m?ge.TileCut:Di(A),y?ge.TileCut:Di(h),f)},generatePatterned(e,t,n,i,s,o){const r=Ns(k(n.style.geometryModifier,i),s,o,i);if(r===null)return;const{tileAttrs:a,tileProps:c}=i,l=k(n.ignoreTier,i)?null:i.tileAttrs[c.db_tiers],f=n.style.withHeight?e.getBucket("line","patterned3d",ht.sinks.patterned3d.packObjectAttributes(t,n,l,i),ht.sinks.patterned3d.binder):e.getBucket("line","patterned",ht.sinks.patterned.packObjectAttributes(t,n,l,i),ht.sinks.patterned.binder),d=e.idIndexer.getIndex(i,t,n),p=Uf(a[c.componentDistanceStart]/32768,a[c.componentDistanceEnd]/32768,a[c.objectLength]/32768,d,n.style.withHeight?ht.sinks.patterned3d.stride/2:ht.sinks.patterned.stride/2),m=Number.isNaN(a[c.beginningIsCut])?!1:a[c.beginningIsCut]!==0,y=Number.isNaN(a[c.endingIsCut])?!1:a[c.endingIsCut]!==0,A=We(n.style.startCap,i),h=We(n.style.endCap,i),w=n.style.withHeight?Xs(i,r):void 0;ks(r.x,r.y,w,r.x.length,m?ge.TileCut:Di(A),y?ge.TileCut:Di(h),a[c.previousPointX],a[c.previousPointY],a[c.nextPointX],a[c.nextPointY],p,f,!0)}},vn={type:Ht.Patterned,cDist:0,sLen:0,oLen:0,localID:0,offsetMultiplier:8,px:[],py:[],count:0};function Uf(e,t,n,i,s){return vn.cDist=e,vn.sLen=t-e,vn.oLen=n,vn.localID=i,vn.offsetMultiplier=s,vn}function Di(e){switch(e){case"round":return ge.Round;case"tilecut":return ge.TileCut;case"butt":default:return ge.Butt}}const Ws={symbol:"shiftedLine",sinks:{solid:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int8Array(t,4),e.views.normal=new Int8Array(t,6),e.views.shift=new Float32Array(t,8)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}}},generate(e,t,n,i,s){const{tileAttrs:o,tileProps:r}=i,a=Number.isNaN(o[r.beginningIsCut])?!1:o[r.beginningIsCut]!==0,c=Number.isNaN(o[r.endingIsCut])?!1:o[r.endingIsCut]!==0,l=k(n.ignoreTier,i)?null:i.tileAttrs[r.db_tiers],f=e.getBucket(n.type,"solid",Ws.sinks.solid.packObjectAttributes(t,n,l,i),Ws.sinks.solid.binder);vr(f,s.x,s.y,void 0,s.x.length,a?ge.TileCut:ge.Round,c?ge.TileCut:ge.Round,0,s.normal_x,s.normal_y)}};function $e(e,t){return e===0?0:Math.min(e*2-1,(t-e)*2)}function qr(e,t,n,i,s,o,r,a,c){let l=e.elements.offset;for(let f=0;f<t;f++){const d=$e(f,t),p=f===t-1;if(s&&s[d]===1||!s&&!p){const m=n[d],y=i[d],A=(f+1)%t,h=$e(A,t),w=n[h],x=i[h];Vf(e,l),zf(e,l,m,y,w,x,o),c?Kr(e,l,c[0],c[1],c[0],c[1]):Kr(e,l,m,y,w,x),r!==void 0&&"localID"in e.views&&e.views.localID!==void 0&&Jr(e.views.localID,l,r,e.elements.stride),a!==void 0&&"labelingTextureID"in e.views&&e.views.labelingTextureID!==void 0&&Jr(e.views.labelingTextureID,l,a,e.elements.stride),l=l+4}}e.elements.offset=l}function zf(e,t,n,i,s,o,r){const a=e.views.position,c=e.elements.stride/a.BYTES_PER_ELEMENT;t=t*c,a[t]=16383+n,a[t+1]=16383+i,a[t+2]=0,t+=c,a[t]=16383+n,a[t+1]=16383+i,a[t+2]=Ye(r),t+=c,a[t]=16383+s,a[t+1]=16383+o,a[t+2]=0,t+=c,a[t]=16383+s,a[t+1]=16383+o,a[t+2]=Ye(r)}function Kr(e,t,n,i,s,o){const r=e.views.demPosition,a=e.elements.stride/r.BYTES_PER_ELEMENT;t=t*a,n=(n+16383)/8,i=(i+16383)/8,s=(s+16383)/8,o=(o+16383)/8,r[t]=n,r[t+1]=i,t+=a,r[t]=n,r[t+1]=i,t+=a,r[t]=s,r[t+1]=o,t+=a,r[t]=s,r[t+1]=o}function Jr(e,t,n,i){const s=i/e.BYTES_PER_ELEMENT;t=t*s,e[t]=n,e[t+=s]=n,e[t+=s]=n,e[t+=s]=n}function Vf(e,t){const n=e.indices.buffer;let i=e.indices.offset;n[i++]=t,n[i++]=t+3,n[i++]=t+1,n[i++]=t,n[i++]=t+2,n[i++]=t+3,e.indices.offset=i}const Et=[.5,.5],Tt=[.5,.5];function Hs(e,t,n,i,s,o){let r=e.elements.offset;const a=$e(t-1,t);let c=n[a],l=i[a],f=s?s[a]:0;const d=r;for(let p=0;p<t;p++){const m=$e(p,t),y=p===t-1,A=n[m],h=i[m],w=s?s[m]:y?0:1;f!==0&&(gt(Tt,c,l,A,h),ea(e,r,w,y?d:r+4),Gf(e,r,c,l,A,h),o?Qr(e,r,o[0],o[1],o[0],o[1]):Qr(e,r,c,l,A,h),bs(Tt),Yf(e,r,Tt),$f(e,r,Tt),r=r+4),c=A,l=h,f=w}e.elements.offset=r}function Zs(e,t,n,i,s,o,r){let a=e.elements.offset;const c=$e(t-2,t),l=$e(t-1,t);let f=n[l],d=i[l],p=s?s[c]:1,m=s?s[l]:0;at(Et,n[c],i[c],f,d);let y=Et[0],A=Et[1];for(let h=0;h<t;h++){const w=$e(h,t),x=h===t-1,M=n[w],v=i[w],T=s?s[w]:x?0:1;gt(Tt,f,d,M,v);const E=Tt[1],S=-Tt[0];p!==0&&(m===0?(Et[0]=y,Et[1]=A):kf(Et,y,A,E,S),Jc(Tt,y,A,Et[0],Et[1]),ea(e,a,0,0),jf(e,a,f,d,o,r??[f,d]),Xf(e,a,bs(Et),bs(Tt)),Wf(e,a),a=a+4),f=M,d=v,p=m,m=T,y=E,A=S}e.elements.offset=a}function kf(e,t,n,i,s){let o,r,a;t*i+n*s>0?(o=t+i,r=n+s,a=1/Math.sqrt(o*o+r*r),e[0]=o*a,e[1]=r*a):(o=s-n,r=t-i,o!==0&&r!==0?(a=1/Math.sqrt(o*o+r*r),e[0]=o*a,e[1]=r*a):(e[0]=0,e[1]=0))}function Qr(e,t,n,i,s,o){const r=e.views.demPosition,a=e.elements.stride/r.BYTES_PER_ELEMENT;t=t*a,n=(n+16383)/8,i=(i+16383)/8,s=(s+16383)/8,o=(o+16383)/8,r[t]=n,r[t+1]=i,t+=a,r[t]=n,r[t+1]=i,t+=a,r[t]=s,r[t+1]=o,t+=a,r[t]=s,r[t+1]=o}function Gf(e,t,n,i,s,o){const{position:r,distance:a}=e.views,c=e.elements.stride/r.BYTES_PER_ELEMENT;t=t*c,r[t]=16383+n,r[t+1]=16383+i,r[t+2]=0,a[t]=0,t+=c,r[t]=16383+n,r[t+1]=16383+i,r[t+2]=0,a[t]=-32767,t+=c,r[t]=16383+s,r[t+1]=16383+o,r[t+2]=0,a[t]=-32767,t+=c,r[t]=16383+s,r[t+1]=16383+o,r[t+2]=0,a[t]=0}function Yf(e,t,n){const i=e.elements.stride/e.views.normals.BYTES_PER_ELEMENT;t=t*i;for(let s=0;s<4;s++)e.views.normals[t]=n[0],e.views.normals[t+1]=n[1],e.views.normals[t+2]=0,e.views.normals[t+3]=0,t+=i}function $f(e,t,n){const i=e.elements.stride/e.views.direction.BYTES_PER_ELEMENT;t=t*i;for(let s=0;s<4;s++)e.views.direction[t]=n[0],e.views.direction[t+1]=n[1],e.views.direction[t+2]=0,e.views.direction[t+3]=0,t+=i}function jf(e,t,n,i,s,o){const r=e.elements.stride/e.views.position.BYTES_PER_ELEMENT;t=t*r,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.position[t+2]=0,e.views.distance[t]=32767,e.views.demPosition[t]=(16383+o[0])/8,e.views.demPosition[t+1]=(16383+o[1])/8,t+=r,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.position[t+2]=0,e.views.distance[t]=-32767,e.views.demPosition[t]=(16383+o[0])/8,e.views.demPosition[t+1]=(16383+o[1])/8,t+=r,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.position[t+2]=Ye(s),e.views.distance[t]=-32767,e.views.demPosition[t]=(16383+o[0])/8,e.views.demPosition[t+1]=(16383+o[1])/8,t+=r,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.position[t+2]=Ye(s),e.views.distance[t]=32767,e.views.demPosition[t]=(16383+o[0])/8,e.views.demPosition[t+1]=(16383+o[1])/8}function Xf(e,t,n,i){const s=e.elements.stride/e.views.normals.BYTES_PER_ELEMENT;t=t*s;for(let o=0;o<4;o++)e.views.normals[t]=n[0],e.views.normals[t+1]=n[1],e.views.normals[t+2]=i[0],e.views.normals[t+3]=i[1],t+=s}function Wf(e,t){const n=e.elements.stride/e.views.direction.BYTES_PER_ELEMENT;t=t*n;for(let i=0;i<4;i++)e.views.direction[t]=0,e.views.direction[t+2]=127,t+=n}function ea(e,t,n,i){const s=e.indices.buffer;let o=e.indices.offset;s[o++]=t,s[o++]=t+1,s[o++]=t+3,s[o++]=t+3,s[o++]=t+1,s[o++]=t+2,n!==0&&(s[o++]=t+2,s[o++]=i+1,s[o++]=i+0),e.indices.offset=o}const kn=rt(),Gn=rt(),Ot=rt();function Yn(e,t,n,i,s,o,r,a,c,l,f,d,p){Se(kn,t,n,i),Se(Gn,s,o,r),jt(Ot,Gn,kn),Dc(Gn,kn)||(Lt(Ot,Ot),dn(Ot,Ot,127)),Hf(e,0,1,3,3,1,2),Fi(e,kn,Ot,1,a,c,l,d),Fi(e,kn,Ot,-1,a,c,l,d),Fi(e,Gn,Ot,-1,a,c,f,p),Fi(e,Gn,Ot,1,a,c,f,p)}function Fi(e,t,n,i,s,o,r,a){const c=e.elements.offset*e.elements.stride,l=c/e.views.position.BYTES_PER_ELEMENT;if(e.views.position[l]=o?t[0]:16383+t[0],e.views.position[l+1]=o?t[1]:16383+t[1],"z"in e.views){const f=c/e.views.z.BYTES_PER_ELEMENT;e.views.z[f]=t[2]}else e.views.position[l+2]=o?t[2]:Ye(t[2]);if(e.views.directionDistance[c]=n[0],e.views.directionDistance[c+1]=n[1],e.views.directionDistance[c+2]=n[2],e.views.directionDistance[c+3]=i,"demPosition"in e.views){const f=c/e.views.demPosition.BYTES_PER_ELEMENT;s=s??t,e.views.demPosition[f]=(o?s[0]:16383+s[0])/8,e.views.demPosition[f+1]=(o?s[1]:16383+s[1])/8}"absZ"in e.views&&r!==void 0&&(e.views.absZ[c/e.views.absZ.BYTES_PER_ELEMENT]=r),"isPivot"in e.views&&(e.views.isPivot[c/e.views.isPivot.BYTES_PER_ELEMENT]=a??0),e.elements.offset++}function Hf(e,t,n,i,s,o,r){const a=e.indices.buffer,c=e.indices.offset,l=e.elements.offset;a[c]=l+t,a[c+1]=l+n,a[c+2]=l+i,a[c+3]=l+s,a[c+4]=l+o,a[c+5]=l+r,e.indices.offset=c+6}const Ni=32768/2,$n=(e,t,n,i,s,o)=>Pe([e,t.innerId,n,i,s],t,o),Ri=e=>({styleId:e[0],layerId:e[1],hiddenById:e[2],floorId:e[3],isFloorStack:e[4],tileData:e.slice(5)}),jn={symbol:"polygonExtrusion",sinks:{sideFill:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.localID=new Uint32Array(t,8),e.views.demPosition=new Int16Array(t,12),e.views.labelingTextureID=new Uint32Array(t,16)},packObjectAttributes:$n,unpackObjectAttributes:Ri},topFill:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.localID=new Uint32Array(t,8),e.views.demPosition=new Int16Array(t,12),e.views.labelingTextureID=new Uint32Array(t,16)},packObjectAttributes:$n,unpackObjectAttributes:Ri},sideStroke:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.distance=new Int16Array(t,6),e.views.normals=new Int8Array(t,8),e.views.direction=new Int8Array(t,12),e.views.demPosition=new Int16Array(t,16)},packObjectAttributes:$n,unpackObjectAttributes:Ri},topStroke:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.directionDistance=new Int8Array(t,8),e.views.demPosition=new Int16Array(t,12)},packObjectAttributes:$n,unpackObjectAttributes:Ri}},generate(e,t,n,i,s){const o=s.x,r=s.y,a=s.cut??[],c=i.tileProps.db_plan_id?i.tileAttrs[i.tileProps.db_plan_id]:"",l=i.tileAttrs[i.tileProps.db_hidden_by_plan_building_id]??"",f=i.tileAttrs[i.tileProps.db_sublayer]==="Floor_ground",d=o.length,p=i.id??"";let m;i.tileProps.db_centroid_x&&i.tileProps.db_centroid_y&&!Number.isNaN(i.tileAttrs[i.tileProps.db_centroid_x])&&!Number.isNaN(i.tileAttrs[i.tileProps.db_centroid_y])?m=[i.tileAttrs[i.tileProps.db_centroid_x],i.tileAttrs[i.tileProps.db_centroid_y]]:m=Qf(o,r,a);const y=k(n.style.height,i),A=i.tileInfo?Mt(i.tileInfo,[0,0]):1,h=y*Be*A,w=e.idIndexer.getIndex(i,t,n,{floorId:Number.isNaN(c)?void 0:c}),x=e.pointIndexer.getIndex(p),M=$n(t,n,l,c,f,i);if(h>0){const S=e.getBucket("polygonExtrusion","sideFill",M,jn.sinks.sideFill.binder);let P=S.indices.offset;qr(S,d,o,r,a,h,w,x,m),S.objectsData[P]={objectId:p,size:S.indices.offset-P};const O=e.getBucket("polygonExtrusion","sideStroke",M,jn.sinks.sideStroke.binder);c||(P=O.indices.offset,Hs(O,d,o,r,a,m),Zs(O,d,o,r,a,h,m),O.objectsData[P]={objectId:p,size:O.indices.offset-P})}const v=e.getBucket("polygonExtrusion","topFill",M,jn.sinks.topFill.binder);let T=v.indices.offset;Zf(v,d,o,r,h,w,x,m),v.objectsData[T]={objectId:p,size:v.indices.offset-T};const E=e.getBucket("polygonExtrusion","topStroke",M,jn.sinks.topStroke.binder);T=E.indices.offset,qf(E,d,o,r,a,h,m),E.objectsData[T]={objectId:p,size:E.indices.offset-T}}};function Zf(e,t,n,i,s,o,r,a){let c=e.elements.offset;const l=c;qs(e,c++,n[0],i[0],s,o,r,a),qs(e,c++,n[1],i[1],s,o,r,a);for(let f=2;f<t;f++)Kf(e,l,f),qs(e,c++,n[f],i[f],s,o,r,a);e.elements.offset=c}function qf(e,t,n,i,s,o,r){for(let a=0;a<t;a++){const c=$e(a,t);if(s&&s[c]===1){const l=$e((a+1)%t,t);Yn(e,n[c],i[c],o,n[l],i[l],o,r)}}}function qs(e,t,n,i,s,o,r,a){const c=e.elements.stride,l=t*(c/e.views.position.BYTES_PER_ELEMENT);e.views.position[l]=16383+n,e.views.position[l+1]=16383+i,e.views.position[l+2]=Ye(s),e.views.position[l+3]=1,e.views.demPosition[l]=(16383+a[0])/8,e.views.demPosition[l+1]=(16383+a[1])/8;const f=t*(c/e.views.localID.BYTES_PER_ELEMENT);e.views.localID[f]=o,e.views.labelingTextureID[f]=r}function Kf(e,t,n){const i=e.indices.buffer;let s=e.indices.offset;n%2===0?(i[s++]=t+n-2,i[s++]=t+n-1,i[s++]=t+n):(i[s++]=t+n-1,i[s++]=t+n-2,i[s++]=t+n),e.indices.offset=s}function ta(e){return(Ni-Math.abs(e[0]-Ni))**2+(Ni-Math.abs(e[1]-Ni))**2}function Jf(e){return e[0]===0||e[0]===32768||e[1]===0||e[1]===32768}function Qf(e,t,n){let i,s=1073741824;const o=e.length,r=Ln();for(let a=0;a<o;a++){i||Uc(r,[e[a],t[a]]);const c=$e(a,o);if(n[c]===0){const l=[e[c],t[c]],f=$e((a+1)%o,o),d=[e[f],t[f]];if(Jf(l)){const p=ta(l);p<s&&(i=l,s=p);const m=ta(d);m<s&&(i=d,s=m)}else i=[(e[c]+e[f])/2,(t[c]+t[f])/2]}}return i||(i=[],zc(i,r)),i}const Xn={type:Ht.Striped,cDist:0,oLen:0,sLen:0,localID:0,offsetMultiplier:14,px:[],py:[],count:0};function ed(e,t,n,i){return Xn.cDist=e,Xn.oLen=t,Xn.localID=n,Xn.offsetMultiplier=i,Xn}const en={symbol:"dashedLine",sinks:{stroke:{stride:28,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int16Array(t,4),e.views.texExtender=new Int8Array(t,8),e.views.vertexDistance=new Float32Array(t,12),e.views.componentDistance=new Float32Array(t,16),e.views.objectLength=new Float32Array(t,20),e.views.localID=new Uint32Array(t,24)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}},stroke3d:{stride:32,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.extender=new Int16Array(t,4),e.views.texExtender=new Int8Array(t,8),e.views.vertexDistance=new Float32Array(t,12),e.views.componentDistance=new Float32Array(t,16),e.views.objectLength=new Float32Array(t,20),e.views.height=new Float32Array(t,24),e.views.localID=new Uint32Array(t,28)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)}}}},generate(e,t,n,i,s,o){const r=Ns(k(n.style.geometryModifier,i),s,o,i);if(r===null)return;const{tileAttrs:a,tileProps:c}=i,l=k(n.ignoreTier,i)?null:i.tileAttrs[c.db_tiers],f=n.style.withHeight?e.getBucket(n.type,"stroke3d",en.sinks.stroke3d.packObjectAttributes(t,n,l,i),en.sinks.stroke3d.binder):e.getBucket(n.type,"stroke",en.sinks.stroke.packObjectAttributes(t,n,l,i),en.sinks.stroke.binder),d=e.idIndexer.getIndex(i,t,n),p=ed(a[c.componentDistanceStart]/32768,a[c.objectLength]/32768,d,n.style.withHeight?en.sinks.stroke3d.stride/2:en.sinks.stroke.stride/2),m=Number.isNaN(a[c.beginningIsCut])?!1:a[c.beginningIsCut]!==0,y=Number.isNaN(a[c.endingIsCut])?!1:a[c.endingIsCut]!==0,A=n.style.withHeight?Xs(i,r):void 0;ks(r.x,r.y,A,r.x.length,m?ge.TileCut:ge.Butt,y?ge.TileCut:ge.Butt,a[c.previousPointX],a[c.previousPointY],a[c.nextPointX],a[c.nextPointY],p,f)}},Ks=[65535/2,65535/2],xn={symbol:"buildingModel",sinks:{fill:{stride:24,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.texCoords=new Uint16Array(t,8),e.views.localID=new Uint32Array(t,12),e.views.demPosition=new Int16Array(t,16),e.views.labelingTextureID=new Uint32Array(t,20)},packObjectAttributes:(e,t,n,i,s,o)=>Pe([e,t.innerId,n,s,i],t,o),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],texture:e[2],id:e[3],matrix:e[4],tileData:e.slice(5)})},stroke:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.directionDistance=new Int8Array(t,8),e.views.demPosition=new Int16Array(t,12)},packObjectAttributes:(e,t,n,i,s)=>Pe([e,t.innerId,i,n],t,s),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],id:e[2],matrix:e[3],tileData:e.slice(4)})}},processSubmesh(e,t,n,i,s,o,r,a,c){const l=n.id??"",f=i.idIndexer.getIndex(n,e,t),d=i.pointIndexer.getIndex(l),p=i.getBucket(t.type,"fill",xn.sinks.fill.packObjectAttributes(e,t,a,c,l,n),xn.sinks.fill.binder,r);nd(p,o);for(let m=0;m<s.length;m++)td(p,s,m,f,d)},processOuterEdge(e,t,n,i,s,o,r){const a=n.id??"",c=i.getBucket(t.type,"stroke",xn.sinks.stroke.packObjectAttributes(e,t,r,a,n),xn.sinks.stroke.binder);for(let l=0;l<o.length;l+=2){const f=o[l]*5,d=o[l+1]*5;Yn(c,s[f],s[f+1],s[f+2],s[d],s[d+1],s[d+2],Ks,!0)}}};function td(e,t,n,i,s){const o=e.elements.offset,r=xn.sinks.fill.stride,a=n*5,c=o*(r/e.views.position.BYTES_PER_ELEMENT),l=o*(r/e.views.localID.BYTES_PER_ELEMENT);e.views.position[c]=t[a],e.views.position[c+1]=t[a+1],e.views.position[c+2]=t[a+2],e.views.texCoords[c]=t[a+3],e.views.texCoords[c+1]=t[a+4],e.views.localID[l]=i,e.views.demPosition[c]=Ks[0]/8,e.views.demPosition[c+1]=Ks[1]/8,e.views.labelingTextureID[l]=s,e.elements.offset++}function nd(e,t){const n=e.elements.offset;let i=e.indices.offset;for(let s=0;s<t.length;s++)e.indices.buffer[i++]=n+t[s];e.indices.offset=i}const In=Te(),Wn=Te(),Mn={type:Ht.Entrance,offsetMultiplier:18,cDist:0,oLen:0,sLen:0,px:[],py:[],count:0,localID:0};function id(e,t,n,i){return Mn.px=e.x,Mn.py=e.y,Mn.oLen=n/32768,Mn.count=t,Mn.localID=i,Mn}const Js={symbol:"arrow",sinks:{stroke:{stride:36,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.segmentEnd=new Uint16Array(t,4),e.views.texExtender=new Int8Array(t,8),e.views.arrowExtender=new Int8Array(t,10),e.views.extender=new Int16Array(t,12),e.views.direction=new Int16Array(t,16),e.views.vertexDistance=new Float32Array(t,20),e.views.objectLength=new Float32Array(t,24),e.views.type=new Float32Array(t,28),e.views.localID=new Uint32Array(t,32)},packObjectAttributes(e,t,n,i){return Pe([e,t.innerId,n>2?1:0],t,i)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],isLongArrow:e[2],tileData:e.slice(3)}}}},generate:(e,t,n,i,s)=>{const o=s.x,r=s.y,a=s.x.length,c=sd(o,r,a),l=e.getBucket(n.type,"stroke",Js.sinks.stroke.packObjectAttributes(t,n,a,i),Js.sinks.stroke.binder),f=e.idIndexer.getIndex(i,t,n),d=id(s,a,c,f);ks(s.x,s.y,void 0,a,ge.Butt,ge.Butt,0,0,0,0,d,l);let p=0;na(l,Nn.StartBorder,o[0],r[0],o[1],r[1],0,0,p,c,f);for(let m=0;m<a-1;m++){if(m!==0){const y=o[m]-o[m-1],A=r[m]-r[m-1];p+=Math.sqrt(y*y+A*A)}na(l,Nn.Arrow,o[m],r[m],o[m+1],r[m+1],-1,0,p,c,f)}}};function sd(e,t,n){let i=0;for(let s=1;s<n;s++){const o=e[s]-e[s-1],r=t[s]-t[s-1];i+=Math.sqrt(o*o+r*r)}return i}function na(e,t,n,i,s,o,r,a,c,l,f){od(e,1,2,0,0,2,3),Ci(e,t,n,i,s,o,r,a,-1,-1,c,l,!0,f),Ci(e,t,n,i,s,o,r,a,1,-1,c,l,!1,f),Ci(e,t,n,i,s,o,r,a,1,1,c,l,!1,f),Ci(e,t,n,i,s,o,r,a,-1,1,c,l,!0,f)}function Ci(e,t,n,i,s,o,r,a,c,l,f,d,p,m){const y=e.elements,A=y.stride*y.offset,h=A>>1,w=h>>1;gt(In,n,i,s,o),un(Wn,In),e.views.position[h]=16383+n,e.views.position[h+1]=16383+i,e.views.segmentEnd[h]=16383+s,e.views.segmentEnd[h+1]=16383+o,e.views.texExtender[A]=_e(Wn[0]*l*(p?-1:1)*Ae),e.views.texExtender[A+1]=_e(Wn[1]*l*(p?-1:1)*Ae),e.views.arrowExtender[A]=_e(c*Ae),e.views.arrowExtender[A+1]=_e(l*Ae);const x=c+r,M=l+a,v=In[0]*x+Wn[0]*M,T=In[1]*x+Wn[1]*M;e.views.extender[h]=Math.round(v*Ae*127),e.views.extender[h+1]=Math.round(T*Ae*127),e.views.direction[h]=Math.round(In[0]*127),e.views.direction[h+1]=Math.round(In[1]*127),e.views.vertexDistance[w]=f/65535,e.views.objectLength[w]=d/65535,e.views.type[w]=t,e.views.localID[w]=m,e.elements.offset++}function od(e,t,n,i,s,o,r){const{elements:a,indices:c}=e,{buffer:l,offset:f}=c,d=a.offset;l[f]=d+t,l[f+1]=d+n,l[f+2]=d+i,l[f+3]=d+s,l[f+4]=d+o,l[f+5]=d+r,c.offset=f+6}const Qs={symbol:"circle",sinks:{fill:{stride:20,binder:(e,t)=>{e.views.flatPosition=new Uint16Array(t),e.views.ecefPosition=new Int16Array(t,6),e.views.extender=new Int16Array(t,12),e.views.localID=new Uint32Array(t,16)},packObjectAttributes:(e,t,n)=>Pe([e,t.innerId],t,n),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],tileData:e.slice(2)})}},generate(e,t,n,i,s){const o=e.getBucket(n.type,"fill",Qs.sinks.fill.packObjectAttributes(t,n,i),Qs.sinks.fill.binder),r=e.idIndexer.getIndex(i,t,n),a=[s.x[0],s.y[0],s.z?s.z[0]:0],c=i.tileInfo?Fs(i.tileInfo,a):[0,0,0];rd(o,0,2,1,0,3,2),Ui(o,a,c,-1,-1,r),Ui(o,a,c,-1,1,r),Ui(o,a,c,1,1,r),Ui(o,a,c,1,-1,r)}};function Ui(e,[t,n,i],s,o,r,a){const l=e.elements.offset*e.elements.stride>>1,f=l>>1;e.views.flatPosition[l]=16383+t,e.views.flatPosition[l+1]=16383+n,e.views.flatPosition[l+2]=Ye(i),e.views.ecefPosition[l]=s[0]*Ve,e.views.ecefPosition[l+1]=s[1]*Ve,e.views.ecefPosition[l+2]=s[2]*Ve,e.views.extender[l]=o,e.views.extender[l+1]=r,e.views.localID[f]=a,e.elements.offset++}function rd(e,t,n,i,s,o,r){const{elements:a,indices:c}=e,{buffer:l,offset:f}=c,d=a.offset;l[f]=d+t,l[f+1]=d+n,l[f+2]=d+i,l[f+3]=d+s,l[f+4]=d+o,l[f+5]=d+r,c.offset=f+6}const An=Te(),Pn=Te(),ia=Te(),sa=Te(),eo=(e,t,n)=>Pe([e,t.innerId],t,n),to=e=>({styleId:e[0],layerId:e[1],tileData:e.slice(2)}),Hn=ml(1),tn={symbol:"lineExtrusion",sinks:{fill:{stride:12,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.demPosition=new Int16Array(t,8)},packObjectAttributes:eo,unpackObjectAttributes:to},topStroke:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.directionDistance=new Int8Array(t,8),e.views.demPosition=new Int16Array(t,12)},packObjectAttributes:eo,unpackObjectAttributes:to},sideStroke:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.distance=new Int16Array(t,6),e.views.normals=new Int8Array(t,8),e.views.direction=new Int8Array(t,12),e.views.demPosition=new Int16Array(t,16)},packObjectAttributes:eo,unpackObjectAttributes:to}},generate(e,t,n,i,s){const o=s.x,r=s.y,a=o.length,c=e.getBucket(n.type,"fill",tn.sinks.fill.packObjectAttributes(t,n,i),tn.sinks.fill.binder),l=e.getBucket(n.type,"topStroke",tn.sinks.topStroke.packObjectAttributes(t,n,i),tn.sinks.topStroke.binder),f=e.getBucket(n.type,"sideStroke",tn.sinks.sideStroke.packObjectAttributes(t,n,i),tn.sinks.sideStroke.binder);for(let d=0;d<a-1;d++){const p=o[d],m=r[d],y=o[d+1],A=r[d+1];Le(An,p,y),Le(Pn,m,A),Le(ia,y,p),Le(sa,A,m),qr(c,2,An,Pn,void 0,Hn),Yn(l,p,m,Hn,y,A,Hn),Hs(f,2,An,Pn,void 0),Hs(f,2,ia,sa,void 0),Zs(f,2,An,Pn,void 0,Hn)}Le(An,o[a-1],o[0]),Le(Pn,r[a-1],r[0]),Zs(f,2,An,Pn,void 0,Hn)}};function ad(e){const t=Math.log(e)*256;return t+(t<0?-.5:.5)<<16>>16}function Ct(e){return e*32768+.5<<16>>>16}function cd(e){return Math.log(e)*256+.5<<16>>16}const no={symbol:"raster",sinks:{fill:{stride:8,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.txtrCoords=new Uint16Array(t,4)},packObjectAttributes(e,t,n,i,s){return Pe([e,t.innerId,i,s],t,n)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],textureIndex:e[2],tiers:e[3],tileData:e.slice(4)}}}},generate(e,t,n,i,s,o,r){const a=t.x,c=t.y,l=e.getBucket(s.type,"fill",no.sinks.fill.packObjectAttributes(n,s,i,o,r),no.sinks.fill.binder);let f=l.elements.offset;ld(l.indices,f,0,1,2,2,1,3),zi(l,f++,a[0],c[0],0,1),zi(l,f++,a[1],c[1],1,1),zi(l,f++,a[2],c[2],0,0),zi(l,f++,a[3],c[3],1,0),l.elements.offset=f}};function zi(e,t,n,i,s,o){t=t*4,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.txtrCoords[t]=Ct(s),e.views.txtrCoords[t+1]=Ct(o)}function ld(e,t,n,i,s,o,r,a){const c=e.buffer,l=e.offset;c[l]=t+n,c[l+1]=t+i,c[l+2]=t+s,c[l+3]=t+o,c[l+4]=t+r,c[l+5]=t+a,e.offset=l+6}function fd(e){return!!e&&e.type==="polygon"}function oa(e,t,n,i,s){return Pe([e,t.innerId,n,i],t,s)}const dd=(e,t,n,i,s)=>Pe([e,t.innerId,n,i],t,s),ra=e=>({styleId:e[0],layerId:e[1],tiers:e[2],floorId:e[3],tileData:e.slice(4)}),nn={symbol:"polygon",sinks:{fill:{stride:8,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.localID=new Uint32Array(t,4)},packObjectAttributes:oa,unpackObjectAttributes:ra},stroke:{stride:8,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.directionDistance=new Int8Array(t,4)},packObjectAttributes:oa,unpackObjectAttributes:ra},shadow:{stride:4,binder:(e,t)=>{e.views.position=new Uint16Array(t)},packObjectAttributes:dd,unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],tiers:e[2],floorId:e[3],tileData:e.slice(4)})}},generate(e,t,n,i,s,o,r){if(i.tileAttrs[i.tileProps.db_geometry_type]==="polyline")return;const c=s.x,l=s.y,f=s.cut,d=i.tileAttrs[i.tileProps.db_plan_id]||"";fd(n)&&r&&Zr(e,t,r,n.style,o);const p=e.idIndexer.getIndex(i,t,n,{floorId:d||void 0}),m=i.id??"",y=n.type==="polygon"&&!k(n.ignoreTier,i)?i.tileAttrs[i.tileProps.db_tiers]:null,A=e.getBucket("polygon","fill",nn.sinks.fill.packObjectAttributes(t,n,y,d,i),nn.sinks.fill.binder),h=A.indices.offset;aa(A,c.length,c,l,p),A.objectsData[h]={objectId:m,size:A.indices.offset-h};const w=e.getBucket("polygon","stroke",nn.sinks.stroke.packObjectAttributes(t,n,y,d,i),nn.sinks.stroke.binder);if(f){const x=w.indices.offset;hd(w,c.length,c,l,f),w.objectsData[x]={objectId:m,size:w.indices.offset-x}}}};function aa(e,t,n,i,s){const o=e.indices.buffer;let r=e.indices.offset,a=e.elements.offset;const c=a;io(e,a++,n[0],i[0],s),io(e,a++,n[1],i[1],s);for(let l=2;l<t;l++)ud(o,r,c,l),io(e,a++,n[l],i[l],s),r=r+3;e.elements.offset=a,e.indices.offset=r}function hd(e,t,n,i,s){for(let o=0;o<t;o++){const r=$e(o,t);if(s[r]===1){const a=$e((o+1)%t,t);Yn(e,n[r],i[r],0,n[a],i[a],0)}}}function io(e,t,n,i,s){t=t*e.elements.stride/e.views.position.BYTES_PER_ELEMENT,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,t=t>>1,"localID"in e.views&&(e.views.localID[t]=s)}function ud(e,t,n,i){i%2===0?(e[t]=n+i-2,e[t+1]=n+i-1,e[t+2]=n+i):(e[t]=n+i-1,e[t+1]=n+i-2,e[t+2]=n+i)}function pd(e,t,n=[],i=[]){return{x:ca(n,e),y:ca(i,t)}}function ca(e,t){const n=e.reduce((s,o)=>s.concat(o),[0]).concat(t),i=n.length-1;return{coords:n.slice(n[0]===n[1]?1:0,n[i-1]===n[i]?i:i+1),isOddStretchable:md(e)}}function md(e){var t;return!((t=e==null?void 0:e[0])!=null&&t[0])}function gd(e,t,n,i,s){return[la(e.x,t,i[0],s),la(e.y,n,i[1],s)]}function la(e,t,n,i){if(e.coords.length<2)throw new Error("The source coords array must have at least two coordinates");return e.coords.map((s,o)=>(t+s+i*(o===0?-1:o===e.coords.length-1?1:0))/n)}function wd(e,t,n,i,s=0,o=0){return[da(fa(e.x,t),i,s),da(fa(e.y,n),i,o)]}function fa(e,t){const{stretchSize:n,fixSize:i}=yd(e),{coords:s,isOddStretchable:o}=e,r=t<i?i:t,a=[s[0]];for(let c=1;c<s.length;c++){const l=s[c-1],f=s[c],d=c%2===(o?1:0),p=a[a.length-1];if(!d){a.push(p+f-l);continue}a.push(Math.round((r-i)*(f-l)/n)+p)}return a}function yd({coords:e,isOddStretchable:t}){if(e.length<2)throw new Error("An axis must have at least two coordinates");if(e.length===2)return{stretchSize:e[e.length-1],fixSize:0};let n=0;for(let i=t?0:1;i<e.length-1;i=i+2)n+=e[i+1]-e[i];return{stretchSize:n,fixSize:e[e.length-1]-n}}function da(e,t,n=0){const i=e[e.length-1]-e[0],s=e.map(o=>Math.round(o-i/2+n));return s.length===2?s[s.length-1]+=2*t:(s[0]-=t,s[s.length-1]+=t),s}function vd(e,t,n,i,s,o,r,a,c){const l=pd(n.w,n.h,a,c),f=gd(l,n.x,n.y,t,zo),d=wd(l,i,s,zo,o,r);e.set(d,f)}function xd(e,t,n,i,s,o,r,a,c,l,f,d){const{textureX:p,textureY:m,stretchedX:y,stretchedY:A,countX:h,countY:w}=s,x=r!==-1/0?r:uc,M=a!==1/0?a:pc,[v,T]=d;for(let E=0;E<h-1;E++){const S=p[E],P=p[E+1],O=y[E],L=y[E+1];for(let U=0;U<w-1;U++){const u=m[U],g=m[U+1],I=A[U],b=A[U+1];ha(o,0,2,1,1,2,3),Vi(o,e,t,n,i,O,I,S,u,v,T,x,M,c,l,f),Vi(o,e,t,n,i,L,I,P,u,v,T,x,M,c,l,f),Vi(o,e,t,n,i,O,b,S,g,v,T,x,M,c,l,f),Vi(o,e,t,n,i,L,b,P,g,v,T,x,M,c,l,f)}}}const sn=[0,0];function Id(e,t,n,i,s,o,r){const{stretchedX:a,stretchedY:c}=i,l=Math.ceil((a[a.length-1]-a[0])/2),f=Math.ceil((c[c.length-1]-c[0])/2),d=o*Go/2;sn[0]=a[0]+l,sn[1]=c[0]+f;const p=sn[0]-d,m=sn[0]+d,y=sn[1]-d,A=sn[1]+d;return ha(s,0,2,1,1,2,3),ki(s,e,t,n,p,y,r),ki(s,e,t,n,m,y,r),ki(s,e,t,n,p,A,r),ki(s,e,t,n,m,A,r),sn}function Vi(e,t,n,i,s,o,r,a,c,l,f,d,p,m,y,A){let h=e.elements.offset*20;e.views.flatPosition[h]=16383+t,e.views.flatPosition[h+1]=16383+n,e.views.flatPosition[h+2]=Ye(i),e.views.ecefPosition[h]=s[0]*Ve,e.views.ecefPosition[h+1]=s[1]*Ve,e.views.ecefPosition[h+2]=s[2]*Ve,e.views.cornerOffset[h]=o,e.views.cornerOffset[h+1]=-r,e.views.checkPointOffset[h]=l,e.views.checkPointOffset[h+1]=f,e.views.texCoords[h]=Ct(a),e.views.texCoords[h+1]=Ct(c),e.views.scales[h]=cd(d),e.views.scales[h+1]=ad(p),h=h>>1,e.views.localID[h]=m,e.views.labelingTextureID[h]=y,e.views.spritePointTextureID[h]=A,e.elements.offset++}function ki(e,t,n,i,s,o,r){const a=e.elements,c=a.stride*a.offset>>1;e.views.position[c]=16383+t,e.views.position[c+1]=16383+n,e.views.position[c+2]=Ye(i),e.views.cornerOffset[c]=s,e.views.cornerOffset[c+1]=-o,e.views.labelingTextureID[c>>1]=r,a.offset++}function ha(e,t,n,i,s,o,r){const{elements:a,indices:c}=e,{buffer:l,offset:f}=c,d=a.offset;l[f]=d+t,l[f+1]=d+n,l[f+2]=d+i,l[f+3]=d+s,l[f+4]=d+o,l[f+5]=d+r,c.offset=f+6}class Md{constructor(){this.countX=0,this.countY=0,this.textureX=[],this.textureY=[],this.stretchedX=[],this.stretchedY=[]}reset(){this.countX=0,this.countY=0}set(t,n){this.countX=n[0].length,this.countY=n[1].length,this.textureX=n[0],this.textureY=n[1],this.stretchedX=t[0],this.stretchedY=t[1]}isEmpty(){return this.countX===0||this.countY===0}}var wt=(e=>(e[e.Common=0]="Common",e[e.Commercial=1]="Commercial",e[e.CommercialCity=2]="CommercialCity",e[e.CommercialPremium=3]="CommercialPremium",e[e.Landmark=4]="Landmark",e))(wt||{}),Gi=(e=>(e[e.Point=0]="Point",e[e.Line=1]="Line",e))(Gi||{}),En=(e=>(e[e.Tile=0]="Tile",e[e.Floor=1]="Floor",e[e.DynamicObject=2]="DynamicObject",e[e.PersonalPoi=3]="PersonalPoi",e))(En||{}),ut=(e=>(e[e.Dead=0]="Dead",e[e.Alive=1]="Alive",e[e.Unused=2]="Unused",e[e.CommercialAlive=3]="CommercialAlive",e[e.CommercialDead=4]="CommercialDead",e))(ut||{}),Ie=(e=>(e[e.Text=0]="Text",e[e.Icon=1]="Icon",e[e.PoiText=2]="PoiText",e[e.PoiText2=3]="PoiText2",e[e.OneWayLine=4]="OneWayLine",e[e.LineText=5]="LineText",e[e.Box=6]="Box",e))(Ie||{});let ua=Math.random;const Ad=e=>{const t={randomSeed:0};zl(t,[e]),ua=()=>Dr(t,0,1)};function Pd(e,t,n,i){const s=pa(e,n,i),o=pa(t,n,i);return s===void 0&&o===void 0?!0:s===void 0?o!==void 0?o:!0:o===void 0?s!==void 0?s:!0:s||o}function pa(e,t,n){const i=e[t];if(i!==void 0)return i[n]}var Zn=(e=>(e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.OneWayLine=2]="OneWayLine",e))(Zn||{});function Yi(e,t){if(!e)return"";const n=k(e,t);return!Number.isNaN(n)&&(n||n===0)?String(n):""}const qe=4294967295,St=4294967040,Ed=St-1,so={},Td=1e6,ma=["main","parser","labeling","models"];let oo=0;ma.forEach(e=>{const t=oo+Math.floor(Ed/ma.length);so[e]={min:oo,max:t-Td},oo=t});class Od{constructor(t){this.ids=[],this.orphanIds=[],this.phases=[],this.sublayers=[],this.styleIds=[],this.layerIds=[],this.instanceIds=[],this.objectClasses=[],this.floorIds=[],this.center=[],this.strings={},this.minIdentifyIndex=so[t].min,this.maxIdentifyIndex=so[t].max,this.index=this.minIdentifyIndex}getIndex(t,n,i,s={}){const{id:o,tileProps:r,tileAttrs:a}=t,c=i.interactive,l=s.ignoreHover?!1:a[r.hovered],f=l&&i.type!=="polygon3d"||i.type==="embankment";return!!o&&c&&!l&&!f?this.getIndexInternal({id:o,styleId:n,layer:i,sublayer:a[r.db_sublayer],...s}):qe}getIndexInternal(t){var o,r,a,c;const n=this.index+this.ids.length;this.ids.push(t.id),this.floorIds.push(t.floorId??""),this.phases.push(t.layer.renderIndex),this.sublayers.push(((r=(o=t.metatile)==null?void 0:o.dictionaries.db_sublayer)==null?void 0:r[t.sublayer])??NaN),this.styleIds.push(t.styleId),this.layerIds.push(t.layer.innerId),this.instanceIds.push(t.instanceId??0);const{center:i,objectClass:s}=t;if(i?this.center.push(Math.round(i[0]),Math.round(i[1])):this.center.push(Vo,Vo),typeof s=="string"){const l=(c=(a=t.metatile)==null?void 0:a.dictionaries.db_object_class)==null?void 0:c[s];l?this.objectClasses.push(l):(this.objectClasses.push(0),this.strings[n]={objectClass:s})}else this.objectClasses.push(qe);return n}addOrphanId(t){this.orphanIds.push(t)}getIndexerStats(){return{ids:this.ids.length,orphanIds:this.orphanIds.length,floorIds:this.floorIds.length,phases:this.phases.length,sublayers:this.sublayers.length,styleIds:this.styleIds.length,layerIds:this.layerIds.length,instanceIds:this.instanceIds.length,objectClasses:this.objectClasses.length,strings:Object.keys(this.strings).length,center:this.center.length}}getPacked(){const t=this.ids,n=this.orphanIds,i=this.floorIds,s=new Float32Array(this.phases).buffer,o=new Uint32Array(this.sublayers).buffer,r=new Uint16Array(this.styleIds).buffer,a=new Uint32Array(this.layerIds).buffer,c=new Uint8Array(this.instanceIds).buffer,l=new Uint32Array(this.objectClasses).buffer,f=new Int32Array(this.center).buffer,d=this.index,p=this.index+this.ids.length-1;this.index=this.index+this.ids.length,this.index>this.maxIdentifyIndex&&(this.index=this.minIdentifyIndex);const m=this.strings;return this.ids=[],this.orphanIds=[],this.floorIds=[],this.phases=[],this.sublayers=[],this.styleIds=[],this.layerIds=[],this.instanceIds=[],this.objectClasses=[],this.strings={},this.center=[],{idBuffer:t,orphanIds:n,floorIdBuffer:i,startIndex:d,endIndex:p,phaseBuffer:s,sublayerBuffer:o,styleIdBuffer:r,layerIdBuffer:a,instanceIdBuffer:c,objectClassBuffer:l,centerBuffer:f,strings:m}}}function Sd(e){return e.type==="labelLine"||e.type==="point"||e.type==="oneWayLine"}function bd(e,t,n,i,s){const o=[];for(const r of e)for(const a of r.labels){const c=n.getStyle(a.styleId);if(!c){console.error(`Not found style ${a.styleId} in unpackPreLabelingResult`);continue}const l=c.layersById[a.layerId];if(!l||!Sd(l)){console.error(`Not found layer: ${a.layerId} in style ${a.styleId} in unpackPreLabelingResult`);continue}const f=new ro(a,l,t,r.metatileHash);switch(a.type){case Zn.Point:f.setSpecificPointAttributes(a,i,s);break;case Zn.Line:f.setSpecificLineAttributes(a,i,s);break;case Zn.OneWayLine:f.setSpecificOneWayAttributes(a);break}o.push(f)}return o}class ro{constructor(t,n,i,s){this.rtlProcessed=!1,this.labelingElements=[],this.id="",this.floorId="",this.detailLevel=0,this.labelPriority=0,this.label="",this.ranges=[],this.pointType=wt.Common,this.iconPriority=0,this.styleIconPriority=0,this.styleTextPriority=0,this.identifyIndex=qe,this.identifyPoiLabelIndex=qe,this.labelingTextureIndex=qe,this.spritePointTextureIndex=qe,this.hovered=0,this.label2Priority=0,this.mapPointVertices=[0,0,0],this.geoPoint=[NaN,NaN],this.demElevation=0,this.elevation=0,this.componentDistanceStartWorld=0,this.componentDistanceEnd=0,this.componentDistanceStart=0,this.objectLengthWorld=0,this.checkPointOffset=[0,0],this.layer=n,this.styleId=t.styleId,this.source=i,this.sourceId=t.sourceId,this.metatileHash=s,this.geometryType=t.type===Zn.Point?t.geometryType:Gi.Line,this.tileData=t.tileData,this.labelPriority=t.labelPriority,this.detailLevel=t.tileCoords[2],this.styleIconPriority=t.styleIconPriority,this.styleTextPriority=t.styleTextPriority,this.id=t.id,this.floorId=t.floorId}setSpecificPointAttributes(t,n,i){if(this.layer.type!=="point")throw new Error("Label: layer type is not a point");const s=this.layer.style;this.pointType=t.pointType,this.label2Priority=t.label2Priority,this.iconPriority=t.iconPriority,this.identifyIndex=t.identifyIndex,this.identifyPoiLabelIndex=t.identifyPoiLabelIndex,this.labelingTextureIndex=t.labelingTextureIndex,this.spritePointTextureIndex=t.spritePointTextureIndex,this.hovered=t.hovered,this.demElevation=t.demElevation;const o=Ue(i,n,!0,t.tileData);this.label=Us(Yi(s.textField,o),s.textMaxLengthPerLine),s.textField2&&(this.label2=Us(Yi(s.textField2,o),s.textMaxLengthPerLine)),this.layer.type==="point"&&s.iconTextField&&(this.iconLabel=Us(Yi(s.iconTextField,o),s.textMaxLengthPerLine));const r=Pi(t.tileCoords);this.mapPointVertices=[];const a=[0,0,0],c=[0,0,0];if(t.geometryType===Gi.Point)pl(this.mapPointVertices,t.vertices,0,r),this.geoPoint=xe.toGeo(this.mapPointVertices),this.layer.style.allowElevation||(this.mapPointVertices[2]=0);else{for(let l=0;l<t.vertices[0].length;l++)a[0]=t.vertices[0][l],a[1]=t.vertices[1][l],Rt(c,a,r),this.mapPointVertices.push(c[0],c[1],c[2]);this.componentDistanceStart=t.componentDistanceStart,this.componentDistanceEnd=t.componentDistanceEnd,this.componentDistanceStartWorld=gn(this.componentDistanceStart,t.tileCoords[2]),this.objectLengthWorld=gn(t.objectLength,t.tileCoords[2])}}setSpecificLineAttributes(t,n,i){if(this.layer.type!=="labelLine")throw new Error("Label: layer type is not a labelLine");const s=Ue(i,n,!0,t.tileData);this.label=Yi(this.layer.style.textField,s);const o=Pi(t.tileCoords);this.mapPointVertices=[];const r=[0,0,0],a=[0,0,0];for(let c=0;c<t.vertices[0].length;c++)r[0]=t.vertices[0][c],r[1]=t.vertices[1][c],Rt(a,r,o),this.mapPointVertices.push(a[0],a[1],a[2]);this.componentDistanceStart=t.componentDistanceStart,this.componentDistanceEnd=t.componentDistanceEnd,this.componentDistanceStartWorld=gn(this.componentDistanceStart,t.tileCoords[2]),this.objectLengthWorld=gn(t.objectLength,t.tileCoords[2]),this.tiers=k(this.layer.ignoreTier,s)?void 0:t.tiers}setSpecificOneWayAttributes(t){const n=Pi(t.tileCoords);this.mapPointVertices=[];const i=[0,0,0],s=[0,0,0];for(let o=0;o<t.vertices[0].length;o++)i[0]=t.vertices[0][o],i[1]=t.vertices[1][o],Rt(s,i,n),this.mapPointVertices.push(s[0],s[1],s[2]);this.componentDistanceStart=t.componentDistanceStart,this.componentDistanceEnd=t.componentDistanceEnd,this.componentDistanceStartWorld=gn(this.componentDistanceStart,t.tileCoords[2]),this.objectLengthWorld=gn(t.objectLength,t.tileCoords[2]),this.tiers=t.tiers}updateRanges(){this.ranges=Nl([this.label,this.label2,this.iconLabel])}}function Ut(e,t,n){const{minX:i,maxX:s,minY:o,maxY:r}=n;e.push(i,o,s-i,r-o,t)}function bt(e,t,n,i){const s=e.anchorScreen,o=e.boxes[t];return{element:e,minX:s[0]+o[0]-n,maxX:s[0]+o[2]+n,minY:s[1]+o[1]-i,maxY:s[1]+o[3]+i}}function Bd(e,t){if(e.parent===t||e.firstLabel===t||t.parent===e||t.firstLabel===e)return!1;const n=e.labelingGroup,i=t.labelingGroup,s=e.labelingGroupTable,o=t.labelingGroupTable;return Pd(s,o,n,i)}function ao(e,t,n,i,s,o){const r=bt(t,n,i,s);if(r.minX>o.maxX||r.maxX<o.minX||r.minY>o.maxY||r.maxY<o.minY)return!0;const a=e.search(r);for(let c=0;c<a.length;c++)if(Bd(t,a[c].element))return!0;return!1}function ga(e,t,n,i,s){if(e.placementIndex===-1){s&&Ut(s,ut.CommercialDead,bt(e,0,i.leftRight,i.topBottom));return}if(ao(t,e,0,i.leftRight,i.topBottom,n))e.placementIndex=-1,s&&Ut(s,ut.CommercialDead,bt(e,0,i.leftRight,i.topBottom));else{e.placementIndex=0;const r=bt(e,0,i.leftRight,i.topBottom);t.insert(r),s&&Ut(s,ut.CommercialAlive,r)}}function co(e,t,n,i){let s=!0;for(let o=0;o<e.boxes.length;o++)if(ao(t,e,o,e.marginLeftRight,e.marginTopBottom,n)){if(s=!1,i)for(let r=0;r<e.boxes.length;r++){const a=bt(e,r,e.marginLeftRight,e.marginTopBottom);let c;r===o?c=ut.Dead:r<o?c=ut.Alive:c=ut.Unused,Ut(i,c,a)}break}if(s)for(let o=0;o<e.boxes.length;o++){const r=bt(e,o,e.marginLeftRight,e.marginTopBottom);t.insert(r),i&&Ut(i,ut.Alive,r)}e.placementIndex=s?0:-1}function _d(e,t,n,i){e.placementIndex=-1;for(let s=0;s<e.boxes.length;s++)if(!(e.firstLabel&&e.firstLabel.placementIndex!==s))if(ao(t,e,s,e.marginLeftRight,e.marginTopBottom,n))i&&Ut(i,ut.Dead,bt(e,s,e.marginLeftRight,e.marginTopBottom));else{const o=bt(e,s,e.marginLeftRight,e.marginTopBottom);if(t.insert(o),e.placementIndex=s,i){Ut(i,ut.Alive,o);for(let r=s+1;r<e.boxes.length;r++)Ut(i,ut.Unused,bt(e,r,e.marginLeftRight,e.marginTopBottom))}break}}function wa(e,t){return e.sort((n,i)=>i.groupPriority-n.groupPriority||(t.has(i.id)?1:0)-(t.has(n.id)?1:0)||i.commPriorityRandomFactor-n.commPriorityRandomFactor)}function on(e){return e.type!==Ie.Box&&!Number.isNaN(e.commPriorityRandomFactor)}function ya(e){return e.label.pointType===wt.CommercialCity}function Ld(e){return on(e)&&ya(e)}function Dd(e){return on(e)&&e.label.pointType===wt.CommercialPremium}function qn(e){return e.pointType===wt.Commercial||e.pointType===wt.CommercialCity||e.pointType===wt.CommercialPremium}function Fd(e){return e.label.pointType!==wt.CommercialCity||e.placementIndex!==-1&&e.label.pointType===wt.CommercialCity}function Nd(e,t){return t.size===0?!1:e.filter(i=>Rd(i,t)?(i.adsType=0,!0):!1).length>0}function Rd(e,t){return e.type===Ie.Icon&&t.has(e.label.id)}function Cd(e){return e.type===Ie.Box&&e.labelingGroup==="markerText"&&e.parent!==void 0}function Ud(e,t,n,i,s){const o=Hr();wa(e.filter(ya),n).forEach(a=>{ga(a,o,t,i.city,s)}),o.clear(),wa(e.filter(Fd),n).forEach(a=>{ga(a,o,t,i.default,s)})}function va(e,t,n,i,s){switch(e.type){case Ie.LineText:case Ie.Icon:if(e.placementIndex===-1&&on(e))break;if(co(e,n,i,s),e.adsType===0){const r=t.get(e.label.id);if(!r)break;e.placementIndex!==-1&&(r.parent=e,co(r,n,i,s),t.delete(e.label.id))}break;case Ie.Box:if(!e.parent){co(e,n,i,s);break}e.placementIndex=-1;break;case Ie.PoiText:case Ie.PoiText2:(!e.parent||e.parent.placementIndex!==-1)&&(!e.firstLabel||e.firstLabel.placementIndex!==-1)?_d(e,n,i,s):e.placementIndex=-1;break}}function zd(e,t,n,i,s,o){const r=[],a=new Map;t.forEach(P=>{if(Cd(P)){a.set(P.parent.label.id,P),P.placementIndex=-1;return}r.push(P)});const c=new Set(a.keys());let l=[];if(n.globeMode){for(const P of e)o.ecef.canSee(P.anchorGeo)?l.push(P):P.placementIndex=-1;for(const P of r)o.ecef.canSee(P.anchorGeo)?l.push(P):P.placementIndex=-1}else l=e.concat(r);const f=n.debugLabels?[]:void 0,{size:d,viewport:p}=n,m=d[0],y=d[1],A=(hi.tileMultiplier-1)/2,h=Math.round(m*A),w=Math.round(y*A),x={minX:p.left-h,maxX:p.left+m+h,minY:p.top-w,maxY:p.top+y+w},M=Hr(),v=Nd(l,c),T=l.sort((P,O)=>{const L=P.label instanceof ro?P.label.hovered:0,U=O.label instanceof ro?O.label.hovered:0,u=i.has(P.id),g=i.has(O.id),I=n.disableSurvivedPoiPrevalence?0:(g?1:0)-(u?1:0),b=v?(O.adsType===0?1:0)-(P.adsType===0?1:0):0;return O.groupPriority-P.groupPriority||(on(O)?O.commPriorityRandomFactor+ +g:0)-(on(P)?P.commPriorityRandomFactor+ +u:0)||b||I||U-L||O.itemPriority-P.itemPriority||(O.label.id>P.label.id?1:O.label.id===P.label.id?0:-1)||O.label.layer.innerId-P.label.layer.innerId||O.anchorWorld[0]-P.anchorWorld[0]||O.anchorWorld[1]-P.anchorWorld[1]});let E=-1;const S=T.filter((P,O)=>on(P)?(E=O,!0):!1);if(E!==-1){for(let P=0;P<=E;P++)va(T[P],a,M,x,f);M.clear(),Ud(S,x,i,s,f)}for(let P=0;P<T.length;P++)va(T[P],a,M,x,f);return f}const lo=new Map;class $i{constructor(t,n,i,s,o,r,a){if(this.anchorWorld=[0,0,0,0],this.anchorGeo=[0,0],this.groupPriority=0,this.labelingGroup=kl,this.marginTopBottom=0,this.marginLeftRight=0,this.elevation=0,this.type=n,this.label=t,this.layer=t.layer,this.elevation=t.elevation,this.id=t.id+"_"+n+"_"+Math.floor(i[0]/1e3)+"_"+Math.floor(i[1]/1e3)+this.getIconLabelPriorityToId(t),Rc(this.anchorWorld,i),this.anchorGeo=t.geoPoint,s!==0&&(this.anchorWorld[2]*=s),a){const c=Xe.fromGeo(this.anchorGeo);this.anchorScreen=o.ecef.project(c,!1)}else this.anchorScreen=o.flat.project([this.anchorWorld[0],this.anchorWorld[1],this.anchorWorld[2]+this.elevation,0]);switch(this.anchorPosition=0,this.anchorSegmentIndex=0,this.halfLabelWidth=0,this.commPriorityRandomFactor=NaN,this.itemPriority=n===Ie.Icon?t.iconPriority:t.labelPriority,this.layer.type){case"labelLine":this.labelingGroup=this.layer.style.labelingGroup,this.groupPriority=t.styleTextPriority;break;case"oneWayLine":this.labelingGroup=this.layer.style.labelingGroup,this.groupPriority=this.layer.style.priority;break;case"point":{if(qn(t))if(lo.has(this.label.id))this.commPriorityRandomFactor=lo.get(this.label.id);else{const c=ua();this.commPriorityRandomFactor=c,lo.set(this.label.id,c)}n===Ie.PoiText?(this.labelingGroup=this.layer.style.allowOverlap?Vn:this.layer.style.textLabelingGroup,this.groupPriority=this.layer.style.iconImage?Math.min(t.styleTextPriority,t.styleIconPriority):t.styleTextPriority,this.marginTopBottom=this.layer.style.textLabelingMargin.topBottom,this.marginLeftRight=this.layer.style.textLabelingMargin.leftRight):n===Ie.PoiText2?(this.labelingGroup=this.layer.style.allowOverlap?Vn:this.layer.style.textLabelingGroup2,this.groupPriority=Math.min(t.styleTextPriority,t.styleIconPriority),this.marginTopBottom=this.layer.style.textLabelingMargin.topBottom,this.marginLeftRight=this.layer.style.textLabelingMargin.leftRight):(this.labelingGroup=this.layer.style.allowOverlap?Vn:this.layer.style.iconLabelingGroup,this.groupPriority=t.styleIconPriority,this.marginTopBottom=this.layer.style.iconLabelingMargin.topBottom,this.marginLeftRight=this.layer.style.iconLabelingMargin.leftRight);break}}this.labelingGroupTable=r.labelingGroups.table,this.overflowStyleZoom=-1/0,this.boxes=[],this.placementIndex=0}getIconLabelPriorityToId(t){if(qn(t))return"";const{layer:n}=t;if(n.type==="point"){const i=t.styleIconPriority.toFixed(0),s=t.styleTextPriority.toFixed(0);return"_"+i+"_"+s}return""}}function xa(e,t,n,i,s,o){if(!e||s&&!o)return[0,0];if(!o)return[e.w/t,e.h/t];const r=fo(n,i,o),a=nt(n.style.iconTextPadding);return[a[3]+a[1]+r[0],a[0]+a[2]+r[1]]}function ji(e,t,n){return ho(se(e.style.textFontSize,t),e.style.textLineHeight,n)}function Ia(e,t,n){return ho(se(e.style.textFontSize2,t),e.style.textLineHeight,n)}function fo(e,t,n){return ho(se(e.style.iconTextFontSize,t),e.style.iconTextLineHeight,n)}function ho(e,t,n){const s=e/Je.baseSize*n.maxWidth,o=e*t*n.lines.length;return[s,o]}function Ma(e,t,n){const i=n[0]??0,s=n[1]??0;return[(.5-e.anchorX)*t[0]+i,(.5-e.anchorY)*t[1]+s]}function Vd(e,t,n){const i=t[0]??.5,s=t[1]??.5,o=n[0]??0,r=n[1]??0;return[(.5-i)*e[0]+o,(.5-s)*e[1]+r]}function Aa(e,t,n,i,s){const o=n[0]??.5,r=n[1]??.5,a=s[0]??0,c=s[1]??0;return[e[0]/2-o*t[0]-i[3]+a,e[1]/2-r*t[1]-i[0]+c]}function Xi(e,t,n,i,s){const o=t[0],r=t[1],a=n[0],c=n[1];let l=0,f=0;const d=c/2+r/2,p=c/2-r/2,m=-d,y=-p,A=a/2+o/2,h=a/2-o/2,w=-A,x=-h;switch(e){case"bottomCenter":f=d+s;break;case"rightCenter":l=A+s;break;case"topCenter":f=m-s;break;case"leftCenter":l=w-s;break;case"bottomRight":l=h,f=d+s;break;case"topRight":l=h,f=m-s;break;case"bottomLeft":l=x,f=d+s;break;case"rightBottom":l=A+s,f=y;break;case"rightTop":l=A+s,f=p;break;case"topLeft":l=x,f=m-s;break;case"leftTop":l=w-s,f=p;break;case"leftBottom":l=w-s,f=y;break}return[l+i[0],f+i[1]]}var Pa=(e=>(e[e.Static=0]="Static",e[e.Unique=1]="Unique",e[e.Loaded=2]="Loaded",e))(Pa||{});function Ea(e,t,n){let i,s=1/0;for(let o=0;o<e.length;o++){const r=e[o];if(n&&!r.isPacked)continue;const a=Math.abs(r.w-t);a<s&&(i=o,s=a)}return i}function Ta(e){return!!e&&"stretchX"in e&&Array.isArray(e.stretchX)&&"stretchY"in e&&Array.isArray(e.stretchY)&&"width"in e&&typeof e.width=="number"&&"height"in e&&typeof e.height=="number"}function uo(e,t){const n=t.precomputes;return e.map((i,s)=>{const o=n[s];return o&&o.usage===Fr.Uniform?i:null})}var Oa=(e=>(e[e.Icon=0]="Icon",e[e.First=1]="First",e[e.Second=2]="Second",e))(Oa||{});const po=new Md,Tn=[0,0,0];let Kn=[0,0,0];const yt={symbol:"point",sinks:{raster:{stride:40,binder:(e,t)=>{e.views.flatPosition=new Uint16Array(t),e.views.ecefPosition=new Int16Array(t,6),e.views.cornerOffset=new Int16Array(t,12),e.views.checkPointOffset=new Int16Array(t,16),e.views.texCoords=new Uint16Array(t,20),e.views.scales=new Int16Array(t,24),e.views.localID=new Uint32Array(t,28),e.views.labelingTextureID=new Uint32Array(t,32),e.views.spritePointTextureID=new Uint32Array(t,36)},packObjectAttributes:(e,t,n,i,s,o)=>Cn([e.styleId,e.layer.innerId,t,n,i,s],o),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],animDirection:e[2],atlasIndex:e[3],labelTest:e[4],floorId:e[5],tileData:e.slice(6)})},text:{stride:36,binder:(e,t)=>{e.views.flatPosition=new Uint16Array(t),e.views.ecefPosition=new Int16Array(t,6),e.views.cornerOffset=new Int16Array(t,12),e.views.checkPointOffset=new Int16Array(t,16),e.views.texCoords=new Uint16Array(t,20),e.views.localID=new Uint32Array(t,24),e.views.labelingTextureID=new Uint32Array(t,28),e.views.spritePointTextureID=new Uint32Array(t,32)},packObjectAttributes:(e,t,n,i,s,o,r,a)=>Cn([e.styleId,e.layer.innerId,t,n,i[0],-i[1],s,o,r],a),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],animDirection:e[2],range:e[3],offsetX:e[4],offsetY:e[5],labelIndex:e[6],fontIndex:e[7],floorId:e[8],tileData:e.slice(9)})},labelingTexture:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.cornerOffset=new Int16Array(t,8),e.views.labelingTextureID=new Uint32Array(t,12)},packObjectAttributes:(e,t=[0,0])=>Cn([e.styleId,e.layer.innerId,t[0],-t[1],e.floorId],[]),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],offsetX:e[2],offsetY:e[3],floorId:e[4],tileData:e.slice(5)})}},processElement(e,t,n,i,s,o,r){const{layer:a,label:c}=n;if(a.type!=="point")return;const l=Ue(o.styleZoom,o.styleState,!0,c.tileData),f=Sa(l,e,s,c),d=e.icons[We(a.style.iconImage,l)],p=Ta(d),m=xa(f,s,a,l,p,c.iconTextMetrics),y=nt(a.style.iconTextOffset),A=nt(a.style.iconTextPadding);let h,w=[0,0];if(f)if(c.iconTextMetrics){const v=nt(a.style.iconTextAnchor);h=fo(a,l,c.iconTextMetrics),w=Aa(m,h,v,A,y)}else{const v=nt(a.style.iconOffset);w=Ma(f,m,v)}qt(Tn,n.anchorWorld,r);const{globeInterStartZoom:x}=ui;if(!(!(o.globeMode&&o.zoom<x)&&!Ds(Tn)))switch(Kn=Xe.fromGeo(n.anchorGeo),n.type){case Ie.Icon:if(!f||p&&!c.iconTextMetrics)return;const v=p?d.stretchX:void 0,T=p?d.stretchY:void 0;if($d(t,c,Tn,Kn,i,f,m[0]*s,m[1]*s,w[0]*s,w[1]*s,s,v==null?void 0:v.map(([S,P])=>[S*s,P*s]),T==null?void 0:T.map(([S,P])=>[S*s,P*s])),!h)return;const E=nt(a.style.iconTextAnchor);kd(e,t,n.label,Tn,Kn,o,i,Vd(h,E,y),a,s);return;case Ie.PoiText:Gd(e,t,n,Tn,Kn,m,o,i,w,a,s);return;case Ie.PoiText2:Yd(e,t,n,Tn,Kn,m,o,i,w,a,s);return}},getLabelingInfo(e,t,n,i,s,o){const{layer:r}=e;if(r.type!=="point")return;e.labelingElements.length=0;const a=Ue(i.styleZoom,i.styleState,!0,e.tileData),c=Sa(a,n,o,e),l=n.icons[We(r.style.iconImage,a)],f=Ta(l),d=xa(c,o,r,a,f,e.iconTextMetrics);let p,m=[0,0];if(c&&(!f||e.iconTextMetrics)){if(e.iconTextMetrics){const w=nt(r.style.iconTextAnchor),x=nt(r.style.iconTextOffset),M=nt(r.style.iconTextPadding);p=fo(r,a,e.iconTextMetrics),m=Aa(d,p,w,M,x)}else{const w=nt(r.style.iconOffset);m=Ma(c,d,w)}const h=new $i(e,Ie.Icon,t,i.buildingHeight,s,n,i.globeMode);h.boxes.push([-d[0]/2+m[0],-d[1]/2+m[1],d[0]/2+m[0],d[1]/2+m[1]]),e.labelingElements.push(h)}const y=We(r.style.textFont,a);e.label.length>0&&y.length&&(jd(e,t,n,d,i,s,m,r),e.label2&&Xd(e,t,n,d,i,s,m,r))}};function kd(e,t,n,i,s,o,r,a,c,l){const{iconTextMetrics:f}=n;if(!f||!c.style.iconTextFont)return;const d=Ue(o.styleZoom,o.styleState,!1,n.tileData),p=We(c.style.iconTextFont,d),m=e.fontNameToIndex[p]??e.fontNameToIndex[cn];mo(t,n,0,f,i,s,r,a,c,m,l)}function Gd(e,t,n,i,s,o,r,a,c,l,f){const{label:d}=n,{textMetrics:p}=d,m=Ue(r.styleZoom,r.styleState,!1,d.tileData),y=We(l.style.textFont,m);if(!y.length)return;const A=ji(l,m,p),h=e.fontNameToIndex[y]??e.fontNameToIndex[cn],w=n.parent?bi(l.style.textPlacement,m):"centerCenter",x=se(l.style.textOffset,m),M=Xi(w,o,A,c,x);mo(t,d,1,d.textMetrics,i,s,a,M,l,h,f)}function Yd(e,t,n,i,s,o,r,a,c,l,f){const{label:d}=n,{textMetrics:p,textMetrics2:m}=d;if(!m||!l.style.textFont2)return;const y=Ue(r.styleZoom,r.styleState,!1,d.tileData),A=ji(l,y,p),h=Ia(l,y,m),w=se(l.style.textOffset,y),x=se(l.style.textOffset2??0,y,0),M=We(l.style.textFont2,y),v=e.fontNameToIndex[M]??e.fontNameToIndex[cn],T=Xi(bi(l.style.textPlacement,y),o,[h[0],A[1]],c,w);T[1]+=(A[1]+h[1])/2+x,mo(t,d,2,m,i,s,a,T,l,v,f)}function mo(e,t,n,i,s,o,r,a,c,l,f){if(n===1&&t.labelingElements.length===1){const p=e.getBucket("point","labelingTexture",yt.sinks.labelingTexture.packObjectAttributes(t),yt.sinks.labelingTexture.binder);t.checkPointOffset=Hd(p,s,i,c,f,t.labelingTextureIndex)}const d={};for(const p of t.ranges)d[p]=e.getBucket("point","text",yt.sinks.text.packObjectAttributes(t,r,p,a,n,l,t.floorId,uo(t.tileData,c)),yt.sinks.text.binder);Wd(d,t,s,o,i,c,n,t.checkPointOffset)}function $d(e,t,n,i,s,o,r,a,c,l,f,d,p){if(r<=0||a<=0)return;const m=t.layer;if(m.type!=="point")return;vd(po,Gt,o,r,a,c,l,d,p),e.atlasPacker.addRastersToLoad(t.styleId,o);const y=e.getBucket("point","labelingTexture",yt.sinks.labelingTexture.packObjectAttributes(t),yt.sinks.labelingTexture.binder);t.checkPointOffset=Id(n[0],n[1],n[2],po,y,f,t.labelingTextureIndex);const A=e.getBucket("point","raster",yt.sinks.raster.packObjectAttributes(t,s,o.atlasIndex,d!==void 0||p!==void 0,t.floorId,uo(t.tileData,m)),yt.sinks.raster.binder);xd(n[0],n[1],n[2],i,po,A,-1/0,1/0,t.identifyIndex,t.labelingTextureIndex,t.spritePointTextureIndex,t.checkPointOffset)}function jd(e,t,n,i,s,o,r,a){const{textMetrics:c}=e;if(!c)return;const l=Ue(s.styleZoom,s.styleState,!1,e.tileData),f=se(a.style.textOffset,l),d=ji(a,l,c),p=new $i(e,Ie.PoiText,t,s.buildingHeight,o,n,s.globeMode);e.labelingElements.length>0&&(p.parent=e.labelingElements[0]);const m=p.parent?bi(a.style.textPlacement,l):"centerCenter",y=Xi(m,i,d,r,f);p.boxes.push([y[0]-d[0]/2,y[1]-d[1]/2,y[0]+d[0]/2,y[1]+d[1]/2]),e.labelingElements.push(p)}function Xd(e,t,n,i,s,o,r,a){const{textMetrics:c,textMetrics2:l}=e;if(!l)return;const f=Ue(s.styleZoom,s.styleState,!1,e.tileData),d=ji(a,f,c),p=Ia(a,f,l),m=se(a.style.textOffset,f),y=se(a.style.textOffset2??0,f,0),A=new $i(e,Ie.PoiText2,t,s.buildingHeight,o,n,s.globeMode);e.labelingElements.length>1?(A.parent=e.labelingElements[0],A.firstLabel=e.labelingElements[1]):e.labelingElements.length>0&&(A.parent=e.labelingElements[0],A.firstLabel=e.labelingElements[0]);const h=Xi(bi(a.style.textPlacement,f),i,[p[0],d[1]],r,m);h[1]+=(d[1]+p[1])/2+y,A.boxes.push([h[0]-p[0]/2,h[1]-p[1]/2,h[0]+p[0]/2,h[1]+p[1]/2]),e.labelingElements.push(A)}function Sa(e,t,n,i){const{rasterSets:s}=t,{layer:o}=i;if(o.type!=="point")return;let r;const a=qn(i);if(a||i.pointType===wt.Landmark)r=s.byKey[Tl(i.id,a?"commercial":"landmark")];else{const c=We(o.style.iconImage,e);if(c.length){const l=nt(o.style.iconAnchor);r=s.byKey[El(c,l[0],l[1])]}}if(r){const c=se(o.style.iconWidth,e),l=Ea(r.rasters,c*n,!0);if(l!==void 0)return r.rasters[l]}}const Wi=[0,0];function Wd(e,t,n,i,s,o,r,a){let{textLineHeight:f,textLetterSpacing:d}=o.style;r===Oa.Icon&&(f=o.style.iconTextLineHeight,d=o.style.iconTextLetterSpacing);const{identifyPoiLabelIndex:p,labelingTextureIndex:m,spritePointTextureIndex:y}=t,{lines:A,maxWidth:h}=s,w=f*Je.baseSize;let x=ba(1,w,A.length);for(let M=0;M<A.length;M++){const v=A[M].width;let T=0;T=-v/2,Wi[0]=T,Wi[1]=x;const E=A[M].glyphs;for(let S=0;S<E.length;S++){const P=E[S];P.bitmap!==void 0&&Kd(e[P.range],n,i,Wi,P,p,m,y,a),Wi[0]+=P.advance+Je.baseSize*d}x-=w}}const vt=[0,0];function Hd(e,t,n,i,s,o){const{lines:r,maxWidth:a}=n;if(!r.length)return vt[0]=0,vt[1]=0,vt;const{textLineHeight:c}=i.style,l=c*Je.baseSize,f=-a/2,d=ba(1,l,r.length),p=a/2,m=d-(r.length-1)*l;vt[0]=s*(f+p)/2,vt[1]=s*(d+m)/2;const y=s*Go/2,A=vt[0]-y,h=vt[0]+y,w=vt[1]+y,x=vt[1]-y,M=e.elements.offset;return Ji(e.indices,M,1,0,3,2,3,0),Zi(e,t,A,w,o),Zi(e,t,h,w,o),Zi(e,t,A,x,o),Zi(e,t,h,x,o),vt}function Zd(e,t,n,i,s,o,r){const a=n[1]+i.top,c=n[0]+i.left,l=a-i.height,f=c+i.width,d=Math.sin(s),p=Math.cos(s),m=c*p-a*d,y=c*d+a*p,A=f*p-a*d,h=f*d+a*p,w=c*p-l*d,x=c*d+l*p,M=f*p-l*d,v=f*d+l*p,T=e.elements.offset;qi(e,t,m,y,i.texLeft,i.texTop,o,r),qi(e,t,A,h,i.texRight,i.texTop,o,r),qi(e,t,w,x,i.texLeft,i.texBottom,o,r),qi(e,t,M,v,i.texRight,i.texBottom,o,r),Ji(e.indices,T,1,0,3,2,3,0)}function qd(e,t,n){const i=e.elements.offset,s=_e(Math.cos(n)),o=_e(Math.sin(n));Ki(e,t,s,o,-1,-1),Ki(e,t,s,o,1,-1),Ki(e,t,s,o,1,1),Ki(e,t,s,o,-1,1),Ji(e.indices,i,0,1,2,2,3,0)}function ba(e,t,n){let i;switch(e){case 0:i=t/2+t*(n-1);break;case 2:i=-t/2;break;default:i=n&1?t*(n>>1):t/2+t*(n-1>>1)}return i}function Kd(e,t,n,i,s,o,r,a,c){const l=i[1]+s.top,f=i[0]+s.left,d=l-s.height,p=f+s.width,[m,y]=c,A=e.elements.offset;Hi(e,t,n,f,l,s.texLeft,s.texTop,m,y,o,r,a),Hi(e,t,n,p,l,s.texRight,s.texTop,m,y,o,r,a),Hi(e,t,n,f,d,s.texLeft,s.texBottom,m,y,o,r,a),Hi(e,t,n,p,d,s.texRight,s.texBottom,m,y,o,r,a),Ji(e.indices,A,1,0,3,2,3,0)}function Hi(e,t,n,i,s,o,r,a,c,l,f,d){const p=e.elements,m=p.stride*p.offset>>1,y=m>>1;e.views.flatPosition[m]=16383+t[0],e.views.flatPosition[m+1]=16383+t[1],e.views.flatPosition[m+2]=Ye(t[2]),e.views.ecefPosition[m]=n[0]*Ve,e.views.ecefPosition[m+1]=n[1]*Ve,e.views.ecefPosition[m+2]=n[2]*Ve,e.views.cornerOffset[m]=i,e.views.cornerOffset[m+1]=s,e.views.checkPointOffset[m]=a,e.views.checkPointOffset[m+1]=c,e.views.texCoords[m]=o,e.views.texCoords[m+1]=r,e.views.localID[y]=l,e.views.labelingTextureID[y]=f,e.views.spritePointTextureID[y]=d,p.offset++}function Zi(e,t,n,i,s){const o=e.elements,r=o.stride*o.offset>>1;e.views.position[r]=16383+t[0],e.views.position[r+1]=16383+t[1],e.views.position[r+2]=Ye(t[2]),e.views.cornerOffset[r]=n,e.views.cornerOffset[r+1]=i,e.views.labelingTextureID[r>>1]=s,o.offset++}function qi(e,t,n,i,s,o,r,a){const c=e.elements;let l=c.stride*c.offset>>1;e.views.position[l]=16383+t[0],e.views.position[l+1]=16383+t[1],e.views.position[l+2]=Ye(t[2]),e.views.texCoords[l]=s,e.views.texCoords[l+1]=o,l=l>>1,e.views.cornerOffset[l]=n,e.views.cornerOffset[l+1]=i,e.views.styleZoomLimits[l]=r,e.views.styleZoomLimits[l+1]=a,c.offset++}function Ki(e,t,n,i,s,o){const r=e.elements.stride*e.elements.offset,a=r/e.views.position.BYTES_PER_ELEMENT,c=r/e.views.direction.BYTES_PER_ELEMENT;e.views.position[a]=16383+t[0],e.views.position[a+1]=16383+t[1],e.views.direction[c]=n,e.views.direction[c+1]=i,e.views.widenDirection[c]=s,e.views.widenDirection[c+1]=o,e.elements.offset++}function Ji(e,t,n,i,s,o,r,a){const c=e.buffer,l=e.offset;c[l]=t+n,c[l+1]=t+i,c[l+2]=t+s,c[l+3]=t+o,c[l+4]=t+r,c[l+5]=t+a,e.offset=l+6}const go=[0,0,0],Jn=[0,0],Qi={symbol:"labelLine",sinks:{raster:{stride:28,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.texCoords=new Uint16Array(t,8),e.views.cornerOffset=new Float32Array(t,12),e.views.styleZoomLimits=new Float32Array(t,20)},packObjectAttributes:(e,t,n,i,s,o)=>Cn([e.styleId,e.layer.innerId,t,n,i,s],o),unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],animDirection:e[2],range:e[3],fontIndex:e[4],tiers:e[5],tileData:e.slice(6)}}}},processElement(e,t,n,i,s,o,r){const{label:a,anchorPosition:c,anchorSegmentIndex:l,halfLabelWidth:f,layer:d}=n;if(d.type!=="labelLine")return;const{axis:p}=a,{center:m,styleZoom:y}=o,A=Ue(y,o.styleState,!1,a.tileData),h=We(d.style.textFont,A),w=e.fontNameToIndex[h]??e.fontNameToIndex[cn],x={},M=k(d.ignoreTier,A)?null:a.tiers;for(const P of a.ranges)x[P]=t.getBucket("labelLine","raster",Qi.sinks.raster.packObjectAttributes(a,i,P,w,M??null,uo(a.tileData,d)),Qi.sinks.raster.binder);const v=a.textMetrics.lines[0],T=se(d.style.textFontSize,A)/Je.baseSize,E=v.glyphs,S=Jd(p,c,f,o.rotation);Jn[0]=-v.width/2,Jn[1]=0;for(let P=0;P<E.length;P++){const O=E[P],L=(Jn[0]+O.left+O.width/2)*T*(S?-1:1),U=Ps(L)||1;let u=-1/0,g=1/0;for(let I=l;I>=1&&I<p.vertexCount&&!(g<n.overflowStyleZoom);I+=U,g=u){const b=U===1?I:I-1;u=cr(fr(L,p.lengths[b]-c),m);const B=p.interpolate(c,I);qt(go,B,r),Ds(go)&&O.bitmap!==void 0&&Zd(x[O.range],go,Jn,O,B[3]+(S?Math.PI:0),Math.max(u,n.overflowStyleZoom),g)}Jn[0]+=O.advance+Je.baseSize*d.style.textLetterSpacing}},getLabelingInfo(){}};function Jd(e,t,n,i){const s=e.interpolate(t-n,e.getSegmentIndex(t-n)),o=e.interpolate(t+n,e.getSegmentIndex(t+n)),r=Math.atan2(o[1]-s[1],o[0]-s[0])-i;return Math.cos(r)<0}const wo=[0,0,0],es={symbol:"oneWayLine",sinks:{raster:{stride:12,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.direction=new Int8Array(t,8),e.views.widenDirection=new Int8Array(t,10)},packObjectAttributes:(e,t,n)=>Cn([e.styleId,e.layer.innerId,t,n],e.tileData),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],animDirection:e[2],tiers:e[3],tileData:e.slice(4)})}},processElement(e,t,n,i,s,o,r){const{label:a,anchorWorld:c}=n;if(qt(wo,c,r),!Ds(wo))return;const l=t.getBucket("oneWayLine","raster",es.sinks.raster.packObjectAttributes(a,i,a.tiers??null),es.sinks.raster.binder);qd(l,wo,c[3])},getLabelingInfo(){}},Qn={symbol:"heatmap",sinks:{fill:{stride:8,binder:(e,t)=>{e.views.position=new Float32Array(t)},packObjectAttributes:(e,t,n,i)=>[e,t.innerId,n,i],unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],textureIndex:e[2],rampTextureIndex:e[3],tileData:e.slice(4)})},framebuffer:{stride:12,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.weight=new Float32Array(t,4),e.views.widen=new Int8Array(t,8)},packObjectAttributes:(e,t)=>[e,t],unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],tileData:e.slice(2)})}},generate(e,t,n,i,s){const o=i.x,r=i.y,a=Number(k(n.style.weight,s));if(Number.isNaN(a)){console.error("Can't resolve style.weight to number");return}const c=e.getBucket(n.type,"framebuffer",Qn.sinks.framebuffer.packObjectAttributes(t,n.innerId),Qn.sinks.framebuffer.binder);for(let l=0;l<o.length;l++)eh(c,0,1,2,2,1,3),ns(c,o[l],r[l],-1,-1,a),ns(c,o[l],r[l],1,-1,a),ns(c,o[l],r[l],-1,1,a),ns(c,o[l],r[l],1,1,a)},generateTexture(e,t,n,i,s){const o=[-1,1,1,-1],r=[-1,-1,1,1],a=e.getBucket(n.type,"fill",Qn.sinks.fill.packObjectAttributes(t,n,i,s),Qn.sinks.fill.binder);let c=a.elements.offset;Qd(a.indices,c,0,1,2,0,2,3),ts(a,c++,o[0],r[0]),ts(a,c++,o[1],r[1]),ts(a,c++,o[2],r[2]),ts(a,c++,o[3],r[3]),a.elements.offset=c}};function ts(e,t,n,i){const s=t*2;e.views.position[s]=n,e.views.position[s+1]=i}function Qd(e,t,n,i,s,o,r,a){const c=e.buffer,l=e.offset;c[l]=t+n,c[l+1]=t+i,c[l+2]=t+s,c[l+3]=t+o,c[l+4]=t+r,c[l+5]=t+a,e.offset=l+6}function ns(e,t,n,i,s,o){const r=e.elements.offset*e.elements.stride,a=r>>1,c=a>>1;e.views.position[a]=16383+t,e.views.position[a+1]=16383+n,e.views.weight[c]=o,e.views.widen[r]=i,e.views.widen[r+1]=s,e.elements.offset++}function eh(e,t,n,i,s,o,r){const{elements:a,indices:c}=e,{buffer:l,offset:f}=c,d=a.offset;l[f]=d+t,l[f+1]=d+n,l[f+2]=d+i,l[f+3]=d+s,l[f+4]=d+o,l[f+5]=d+r,c.offset=f+6}let th=0;function Ba(){return th++}const nh=Ba();Ba();const _a={stride:4,binder:(e,t)=>{},packObjectAttributes(e,t){return[e,t]},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tileData:e.slice(3)}}},yo={stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.normal=new Float32Array(t,4),e.views.height=new Float32Array(t,16)},packObjectAttributes(e,t){return[e,t]},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tileData:e.slice(2)}}},pt={symbol:"dem",sinks:{mesh:_a,ground:_a,mesh2:yo,ground2:yo,elevation:yo,hillshade:{stride:8,binder:(e,t)=>{},packObjectAttributes(e,t){return[e,t]},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tileData:e.slice(2)}}},flatBottom:{stride:12,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.demPosition=new Int16Array(t,4),e.views.extender=new Int8Array(t,8)},packObjectAttributes(e,t,n){return n?[e,t,n]:[e,t]},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],matrix:e[2]?e[2]:void 0,tileData:e.slice(3)}}}},generateMeshElevation(e,t,n,i){const s=e.getBucket("dem","elevation",pt.sinks.elevation.packObjectAttributes(n,i),pt.sinks.elevation.binder),o=e.getBucket("dem","mesh2",pt.sinks.mesh2.packObjectAttributes(n,i),pt.sinks.mesh2.binder),r=e.getBucket("dem","ground2",pt.sinks.ground2.packObjectAttributes(n,i),pt.sinks.ground2.binder);xo(s,t),xo(o,t),xo(r,t)},generateHillshade(e,t,n,i){const s=new Uint16Array(t.reduce((r,a)=>{const[c,l,f,d]=a;return r.push(c*32768,l*32768,Ct(f),Ct(d)),r},[]));return{symbol:pt.symbol,sink:"hillshade",buffer:s.buffer,generatedObjects:[{drawMode:ko,attributes:pt.sinks.hillshade.packObjectAttributes(n,i),rangeStart:0,rangeEnd:s.buffer.byteLength,extents:new Uint16Array(6)}]}},generateFloorsBottomFill(e,t,n,i,s,o){const r=n[0],a=n[1],c=n[0].length,l=pt.sinks.flatBottom.packObjectAttributes(t,nh,o),f=e.getBucket("dem","flatBottom",l,pt.sinks.flatBottom.binder);ih(f,c,r,a,i,s,!!o)}};function ih(e,t,n,i,s,o,r){let a=e.elements.offset;const c=a;if(!(t<3)){vo(e,a++,n[0],i[0],o,s[0],r),vo(e,a++,n[1],i[1],o,s[1],r);for(let l=2;l<t;l++)sh(e,c,l),vo(e,a++,n[l],i[l],o,s[l],r);e.elements.offset=a}}function vo(e,t,n,i,s,o,r){const a=t*(e.elements.stride/e.views.position.BYTES_PER_ELEMENT),c=t*(e.elements.stride/e.views.extender.BYTES_PER_ELEMENT);e.views.position[a]=r?n:16383+n,e.views.position[a+1]=r?i:16383+i,e.views.demPosition[a]=(r?s[0]:16383+s[0])/8,e.views.demPosition[a+1]=(r?s[1]:16383+s[1])/8,e.views.extender[c]=o[0]*127,e.views.extender[c+1]=o[1]*127}function sh(e,t,n){const i=e.indices.buffer;let s=e.indices.offset;n%2===0?(i[s++]=t+n-2,i[s++]=t+n-1,i[s++]=t+n):(i[s++]=t+n-1,i[s++]=t+n-2,i[s++]=t+n),e.indices.offset=s}function xo(e,t){for(let n=0;n<t.indices.length;n++){const i=t.indices[n],s=e.elements.offset*(e.elements.stride/e.views.position.BYTES_PER_ELEMENT);e.views.position[s]=16383+t.vertices[i*3],e.views.position[s+1]=16383+t.vertices[i*3+1];const o=e.elements.offset*(e.elements.stride/e.views.normal.BYTES_PER_ELEMENT);e.views.normal[o]=t.normals[i*3],e.views.normal[o+1]=t.normals[i*3+1],e.views.normal[o+2]=t.normals[i*3+2];const r=e.elements.offset*(e.elements.stride/e.views.height.BYTES_PER_ELEMENT);e.views.height[r]=t.vertices[i*3+2],e.elements.offset++,e.indices.buffer[e.indices.offset]=n,e.indices.offset++}}new Set(yc),new Set(Yo),new Set($o),new Set(xc),new Set(Ic),new Set(vc);function oh(e,t,n){return ah(e)||!t?e:ch(t)?dl(t,{modelSrc:e,subdomain:ul(n)}):lh(t,e)}const rh=new RegExp("^(?:(?:[a-z]+:)?(?:[a-z]+:)?//|data:)","i");function ah(e){return rh.test(e)}function ch(e){return/{\w+}/g.test(e)}function lh(...e){const t=e.filter(i=>i.length>0);let n=t[0];for(let i=1;i<t.length;i++){n[n.length-1]!=="/"&&(n+="/");const s=t[i];s[0]==="/"?n+=s.slice(1):n+=s}return n}function fh(e){return Array.isArray(e)?e:[e]}var On=(e=>(e[e.None=0]="None",e[e.Zoom=1]="Zoom",e[e.Distance=2]="Distance",e))(On||{});const xt=[0,0,0],ei=new Int16Array([0,0,0]),ke=new Array(16),Io=new Float32Array(9),rn=[0,0,0],Mo=[0,0,0],Ao=[0,0,0],is=[0,0,0],dh=rt(),hh=ys([1,1,1]),ti={symbol:"gltfModel",sinks:{instances:{stride:64,binder:(e,t)=>{e.views.flatPosition=new Uint16Array(t),e.views.ecefPosition=new Int16Array(t,8),e.views.matrix=new Float32Array(t,16),e.views.localID=new Uint32Array(t,52),e.views.labelingTextureID=new Uint32Array(t,56),e.views.absZ=new Float32Array(t,60)},packObjectAttributes(e,t,n,i,s,o,r,a,c=[],l,f,d,p){return Pe([e,t.innerId,n,c,a,o,i,s,l,f,d,p],t,r)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],modelIndices:e[2],lngLat:e[3],emitShowHideEvents:e[4],sourceId:e[5],modelStepValues:e[6],modelStepSource:e[7],parentId:e[8],absZ:e[9],floorId:e[10],subkey:e[11],tileData:e.slice(12)}}}},generateInstances(e,t,n,i,s,o,r,a,c,l,f=0){const d=k(n.style.linkedIds,i),p=d===""?[]:fh(d),m=n.style.modelSrc,y=[];let A=On.None;const h=wn(m,i,n,!0);if(h.length===1)y.push(0);else if(h.length>1){if(!At(m)||m.type!=="step"||!At(m.value)){console.error(`Only step-expression is allowed as 'modelSrc' style property. Models won't be displayed for layer ${n.id}`);return}switch(m.value.type){case"zoom":A=On.Zoom;break;case"distance":A=On.Distance;break;default:console.error(`'${m.value.type}' type in 'modelSrc' step expression is not supported. Only 'zoom' and 'distance' are supported. Models won't be displayed for layer ${n.id}`);return}m.steps.forEach(({key:g})=>{y.push(g)})}A===On.Distance&&h.reverse(),h.forEach((g,I)=>{g===null&&I!==0&&(h[I]=h[I-1])}),A===On.Distance&&h.reverse();const w=h.map(g=>g===null?"":g).map(g=>{let I=t.modelIndex[g];return I===void 0&&(g=oh(g,a??"",o.coords),I=e.addUsedModelByUrl(g)),e.addUsedModel(I),I}),{tileProps:x,tileAttrs:M}=i;let v=St;n.interactive?i.id&&(v=M[x.hovered]?qe:e.idIndexer.getIndex(i,t.id,n,{metatile:l,objectClass:M[x.db_object_class]})):v=n.interactiveOcclusion?St:qe;const T=i.id??"-1",E=M[x.db_point_building_id];let S=St;i.id&&(S=e.pointIndexer.getIndex(E??i.id));const P=c!=null&&c.has(M[x.db_sublayer])&&T!=="-1"?1:0,O=e.getBucket("gltfModel","instances",ti.sinks.instances.packObjectAttributes(t.id,n,w,y,A,r,i,P,P?Pr(s.x[0],s.y[0],o):void 0,E,!!s.abs_z,x.db_plan_id?M[x.db_plan_id]:"",wl(o,s.x[0],s.y[0],f)),ti.sinks.instances.binder);let L=O.meta;if(L)L.linkedIds.push(...p);else{const g=x.db_plan_id?M[x.db_plan_id]:void 0;L=O.meta={linkedIds:p.slice(),modelsPath:a??"",buildingId:T,planId:g}}P&&(L.sublayer=M[x.db_sublayer]),E&&(L.childrenIds||(L.childrenIds=[]),L.childrenIds.push(T));let U;const u=mh(M,i);if(u){const g=s.x[0],I=s.y[0],b=[0,0,0];Rt(b,[g,I],o),U=[b,xe.fromGeo(u)]}for(let g=0;g<s.x.length;g++){const I=s.abs_z&&s.abs_z[g];Se(Mo,0,0,0),Es(k(n.style.rotation,i),Mo),Se(rn,1,1,1),Es(k(n.style.scale,i),rn),Se(Ao,0,0,0),Es(k(n.style.offset,i),Ao),La(s.x[g],s.y[g],0,Ao,rn,Mo,U,o,n.minzoom<ui.globeMaxZoom),gh(O,xt,ei,Io,v,S,I)}},patchBuffer(e,t,n,i,s,o,r,a,c){const l=ti.sinks.instances.stride*n;La(s[0],s[1],s[2],o,r,a,void 0,i,c),xt[0]+=16383,xt[1]+=16383,xt[2]=Ye(xt[2]),t.subData(e,l+0,new Uint16Array(xt)),c&&t.subData(e,l+8,ei),t.subData(e,l+16,Io)}};function uh(e,t,n,i){const s=n*32768/Ti(i.coords[2]);ot(t,t,s),t[2]*=n,fn(e,e,t)}function La(e,t,n,i,s,o,r,a,c){Se(xt,e,t,n);const l=Mt(a,xt)*Be;if(qo(ke),Qo(ke,ke,ve(o[2])),Jo(ke,ke,ve(o[1])),xs(ke,ke,ve(o[0])),vs(ke,ke,s),r?ph(ke,r[0],r[1]):(Se(rn,l,l,l),vs(ke,ke,rn)),xs(ke,ke,Math.PI/2),Zc(Io,ke),uh(xt,i,l,a),c){const f=Fs(a,xt);ei[0]=f[0]*Ve,ei[1]=f[1]*Ve,ei[2]=f[2]*Ve}}function ph(e,t,n){bn(is,n,t),Qo(e,e,Math.atan2(is[1],is[0]));const i=pi(is);Se(rn,i,i,i),vs(e,e,rn)}function mh(e,t){const n=e[t.tileProps.direction];return n===void 0?null:Array.isArray(n)?n:n.type==="Point"?n.coordinates:null}function gh(e,t,n,i,s,o,r){const a=e.elements.offset*ti.sinks.instances.stride,c=e.views,l=a/c.flatPosition.BYTES_PER_ELEMENT,f=16383+t[0],d=16383+t[1],p=Ye(t[2]);if(c.flatPosition[l]=f,c.flatPosition[l+1]=d,c.flatPosition[l+2]=p,c.ecefPosition[l]=n[0],c.ecefPosition[l+1]=n[1],c.ecefPosition[l+2]=n[2],e.elements.offset>e.elements.maximum-1)return;c.matrix.set(i,a/c.matrix.BYTES_PER_ELEMENT),c.localID[a/c.localID.BYTES_PER_ELEMENT]=s,c.labelingTextureID[a/c.labelingTextureID.BYTES_PER_ELEMENT]=o,r!==void 0&&(c.absZ[a/c.absZ.BYTES_PER_ELEMENT]=r),wh(e,f,d,p,i);const m=e.indices;m.buffer[m.offset]=e.elements.offset,m.offset++,e.elements.offset++}function wh(e,t,n,i,s){const o=e.extents;t<o[0]&&(o[0]=t),n<o[1]&&(o[1]=n),i<o[2]&&(o[2]=i),t>o[3]&&(o[3]=t),n>o[4]&&(o[4]=n),i>o[5]&&(o[5]=i);const r=dh;el(s,r);const a=ys(r)/hh;a>e.maxDiag&&(e.maxDiag=a)}var C=(e=>(e[e.side=0]="side",e[e.top=1]="top",e[e.bottom=2]="bottom",e))(C||{});const ni=[0,0,0],ii=[0,0,0],si=[0,0,0],ss=[0,0,0],Da=(e,t,n,i,s)=>Pe([e,t.innerId,n,i],t,s),Fa=(e,t,n,i)=>Pe([e,t.innerId,n],t,i),Na=e=>({styleId:e[0],layerId:e[1],side:e[2],absZ:e[3],tileData:e.slice(4)}),Ra=e=>({styleId:e[0],layerId:e[1],absZ:e[2],tileData:e.slice(3)}),R={symbol:"mesh",sinks:{fill:{stride:28,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.z=new Float32Array(t,4),e.views.normal=new Int8Array(t,8),e.views.gradient=new Int8Array(t,11),e.views.localID=new Uint32Array(t,12),e.views.demPosition=new Int16Array(t,16),e.views.absZ=new Float32Array(t,16),e.views.isPivot=new Uint8Array(t,20),e.views.labelingTextureID=new Uint32Array(t,24)},packObjectAttributes:Da,unpackObjectAttributes:Na},inverse:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.z=new Float32Array(t,4),e.views.demPosition=new Int16Array(t,8),e.views.absZ=new Float32Array(t,8),e.views.isPivot=new Uint8Array(t,12)},packObjectAttributes:Fa,unpackObjectAttributes:Ra},depthClear:{stride:16,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.z=new Float32Array(t,4),e.views.demPosition=new Int16Array(t,8),e.views.absZ=new Float32Array(t,8),e.views.isPivot=new Uint8Array(t,12)},packObjectAttributes:Fa,unpackObjectAttributes:Ra},stroke:{stride:20,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.z=new Float32Array(t,4),e.views.directionDistance=new Int8Array(t,8),e.views.demPosition=new Int16Array(t,12),e.views.absZ=new Float32Array(t,12),e.views.isPivot=new Uint8Array(t,16)},packObjectAttributes:Da,unpackObjectAttributes:Na}},generate(e,t,n,i,s,o,r,a,c,l,f="fill",d=!1){const p=o.x,m=o.y,y=o.signed_z;let A=0;if(n.type==="polygon3d"||n.type==="embankment"){const O=k(n.style.elevation,s),L=s.tileInfo?Mt(s.tileInfo,[0,0]):1;A=O*Be*L}const h=o.gradient,w=o.abs_z,x=o.is_pivot,M=p.length,v=s.tileAttrs[s.tileProps.hovered],T=s.id??"",E=e.pointIndexer.getIndex(T);let S=St;switch(n.type){case"polygon3d":{n.interactive?(S=v?qe:e.idIndexer.getIndex(s,t,n),!v&&S===qe&&(S=St)):S=n.interactiveOcclusion?St:qe;break}case"overpass":case"tunnel":{S=e.idIndexer.getIndex(s,t,n),S===qe&&(S=St);break}case"embankment":{S=St;break}default:{const{type:O}=n}}(n.type==="embankment"||n.type==="polygon3d")&&c&&Zr(e,t,c,n.style,a);let P;if(f==="inverse")P=e.getBucket("mesh","inverse",R.sinks.inverse.packObjectAttributes(t,n,!!w,s),R.sinks.inverse.binder);else if(f==="fill")P=e.getBucket("mesh","fill",R.sinks.fill.packObjectAttributes(t,n,i,!!w,s),R.sinks.fill.binder);else if(f==="depthClear")P=e.getBucket("mesh","depthClear",R.sinks.depthClear.packObjectAttributes(t,n,!!w,s),R.sinks.depthClear.binder);else return;for(let O=0;O<M-2;O++){const L=!(O%2);yh(P);const U=d?2:1,u=d?1:2,g=L?O+U:O+u,I=L?O+u:O+U,b=32768/r.size;Se(ni,p[O],m[O],((y==null?void 0:y[O])??0)*b),Se(ii,p[g],m[g],((y==null?void 0:y[g])??0)*b),Se(si,p[I],m[I],((y==null?void 0:y[I])??0)*b),wr(ss,ni,ii,si),ni[2]/=b,ii[2]/=b,si[2]/=b,ni[2]+=A,ii[2]+=A,si[2]+=A;const B=P.elements.offset;Po(P,ni,ss,h==null?void 0:h[O],S,E,l,w==null?void 0:w[O],x==null?void 0:x[O]),Po(P,ii,ss,h==null?void 0:h[g],S,E,l,w==null?void 0:w[g],x==null?void 0:x[g]),Po(P,si,ss,h==null?void 0:h[I],S,E,l,w==null?void 0:w[I],x==null?void 0:x[I]),P.objectsData[B]={objectId:T,size:P.elements.offset-B}}}};function Po(e,t,n,i,s,o,r,a,c){const l=e.elements.stride*e.elements.offset,f=l/e.views.position.BYTES_PER_ELEMENT;e.views.position[f]=16383+t[0],e.views.position[f+1]=16383+t[1],e.views.z[l/e.views.z.BYTES_PER_ELEMENT]=t[2];const d=l/e.views.demPosition.BYTES_PER_ELEMENT;if(e.views.demPosition[d]=(((r==null?void 0:r[0])??t[0])+16383)/8,e.views.demPosition[d+1]=(((r==null?void 0:r[1])??t[1])+16383)/8,a!==void 0&&(e.views.absZ[l/e.views.absZ.BYTES_PER_ELEMENT]=a),e.views.isPivot[l/e.views.isPivot.BYTES_PER_ELEMENT]=c??0,"normal"in e.views){const p=l/e.views.normal.BYTES_PER_ELEMENT,m=l/e.views.localID.BYTES_PER_ELEMENT,y=l/e.views.gradient.BYTES_PER_ELEMENT;e.views.normal[p]=_e(n[0]),e.views.normal[p+1]=_e(n[1]),e.views.normal[p+2]=_e(n[2]),e.views.gradient[y]=_e(i??0),e.views.localID[m]=s,e.views.labelingTextureID[m]=o}e.elements.offset++}function yh(e){const t=e.indices.buffer,n=e.indices.offset,i=e.elements.offset;t[n]=i,t[n+1]=i+1,t[n+2]=i+2,e.indices.offset+=3}const Ca=[0,0,0],Ua=[0,0,0],za=[0,0,0],os=[0,0,0],oi={symbol:"mapMesh",sinks:{fill:{stride:24,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.z=new Float32Array(t,4),e.views.extender=new Int16Array(t,8),e.views.normal=new Int8Array(t,12),e.views.gradient=new Int8Array(t,15),e.views.demPosition=new Int16Array(t,16),e.views.absZ=new Float32Array(t,16),e.views.isPivot=new Uint8Array(t,20)},packObjectAttributes:(e,t,n,i,s)=>Pe([e,t.innerId,n,i],t,s),unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],meshTier:e[2],absZ:e[3],tileData:e.slice(4)})}},generate(e,t,n,i,s,o,r,a){const c=s.x,l=s.y,f=s.signed_z??[],d=s.gradient,p=s.is_pivot,m=s.abs_z,y=c.length,A=a==null?void 0:a[0],h=a==null?void 0:a[1];if(y<3)return;const w=32768/r.size,x=e.getBucket("mapMesh","fill",oi.sinks.fill.packObjectAttributes(t,n,o,!!m,i),oi.sinks.fill.binder),M=x.indices.buffer;let v=x.indices.offset;const T=x.elements.offset;for(let E=2;E<y;E++){const S=!(E%2),P=S?E-2:E-1,O=S?E-1:E-2;vh(M,v,T,(E-2)*3+2),Se(za,c[P],l[P],f[P]*w),Se(Ua,c[O],l[O],f[O]*w),Se(Ca,c[E],l[E],f[E]*w),wr(os,za,Ua,Ca),Eo(x,c[P],l[P],f[P],d==null?void 0:d[P],p==null?void 0:p[P],m==null?void 0:m[P],os,A,h),Eo(x,c[O],l[O],f[O],d==null?void 0:d[O],p==null?void 0:p[O],m==null?void 0:m[O],os,A,h),Eo(x,c[E],l[E],f[E],d==null?void 0:d[E],p==null?void 0:p[E],m==null?void 0:m[E],os,A,h),v+=3}x.indices.offset=v}};function vh(e,t,n,i){e[t]=n+i-2,e[t+1]=n+i-1,e[t+2]=n+i}function Eo(e,t,n,i,s,o,r,a,c=t,l=n){const f=e.elements.offset*e.elements.stride,d=f/e.views.position.BYTES_PER_ELEMENT,p=f/e.views.normal.BYTES_PER_ELEMENT,m=f/e.views.demPosition.BYTES_PER_ELEMENT;e.views.position[d]=16383+t,e.views.position[d+1]=16383+n,e.views.z[f/e.views.z.BYTES_PER_ELEMENT]=i,e.views.normal[p]=_e(a[0]),e.views.normal[p+1]=_e(a[1]),e.views.normal[p+2]=_e(a[2]),e.views.gradient[f/e.views.gradient.BYTES_PER_ELEMENT]=s??0,e.views.isPivot[f/e.views.isPivot.BYTES_PER_ELEMENT]=o??0,e.views.demPosition[m]=(16383+c)/8,e.views.demPosition[m+1]=(16383+l)/8,r!==void 0&&(e.views.absZ[f/e.views.absZ.BYTES_PER_ELEMENT]=r),e.elements.offset++}const xh=1,To=-1,Ih=1.3,Va=-200,ka=-300,Mh=Math.tan(ve(175/2)),st=[0,0,0],zt=[0,0,0],Ah=[0,0,0],ri=[0,0,0],Oo=[0,0,0],Ee=[0,0,0];let rs=0,ai=0;const Ph={symbol:"overpass",sinks:{},generate(e,t,n,i,s,o,r,a){var ye;let c=s.signed_z;if(!c)return;const l=s.abs_z!==void 0&&Array.from(s.abs_z).some($=>$)?s.abs_z:void 0,f=i.styleState.terrainEnabled===!0,d=i.tileAttrs[i.tileProps.db_road_part],p=i.tileAttrs[i.tileProps.db_geometry_type],m=(ye=i.tileAttrs[i.tileProps.db_tiers])==null?void 0:ye[0],y=!!i.tileAttrs[i.tileProps.db_is_mountain]&&!!l&&f,A=d==="tunnel_arch"&&y,h=d==="border_tunnel"&&y;if(d==="roadbed_flat"||d==="border_tunnel_descent"&&y)return;const x=i.tileProps,M=i.tileAttrs.slice();i.id=void 0,M[x.db_tiers]=void 0;const v=t.id,T=s.x.length,E=s.x,S=s.y,P=s.cut??[],O=new Uint8Array(T);A||c.forEach(($,oe)=>{O[oe]=$?0:1}),!!i.tileAttrs[i.tileProps.db_ignore_z]&&!!l&&f&&(c=new Int32Array(c.length));const U=f?Ih:1;f&&!y&&(d==="roadbed_tunnel"||d==="roadbed_tunnel_descent"||d==="border_tunnel"||d==="border_tunnel_descent")&&(c=new Int32Array(c).map($=>$*U)),Le(ri,0,0);const g=Mt(o,ri)*Be,I=32768/o.size*g,b=Math.max(se(n.style.borderWidth,i,0),0)*I,B=Math.max(se(n.style.thickness,i,0),0)*g,_=b>0?Math.max(-B,se(n.style.borderHeight,i,0)*g):0,D=Math.max(se(n.style.tunnelHeight,i,0),0)*g;if(p==="polygon"){if(m===void 0)return;const $=[E,S,P,c,new Int8Array(T),O];l&&$.push(l);const oe=d==="roadbed_tunnel_descent",me=d==="roadbed_tunnel"||oe;oi.generate(e,v,n,i,G($),m,o,void 0);const z=$.map(F=>Array.from(F));for(let F=0;F<z[3].length;F++)z[3][F]-=B,z[4][F]=0;R.generate(e,v,n,C.bottom,i,G(z),o,r,a,void 0,me?"inverse":"fill",!0);const re=[];for(let F=0;F<m;F++)re.push(F);const te=e.getBucket("polygon","shadow",nn.sinks.shadow.packObjectAttributes(v,n,re,"",i),nn.sinks.shadow.binder);if(aa(te,$[0].length,$[0],$[1],qe),me&&!oe){const F=$.slice();F[3]=y?new Array($[0].length).fill(D):Array.from($[3]).map(V=>V+Math.abs(V/U)-1),R.generate(e,v,n,C.top,i,G(F),o,r,a,void 0,y?"fill":"inverse"),y&&R.generate(e,v,n,C.bottom,i,G(F),o,r,a,void 0,"fill",!0)}if(oe&&f&&!y){const F=$.slice();F[3]=new Array($[0].length).fill(Math.max(0,_)),R.generate(e,v,n,C.top,i,G(F),o,r,a,void 0,"depthClear")}}else if(p==="polyline"){const $=R.sinks.stroke.packObjectAttributes(v,n,C.top,!!l,i),oe=R.sinks.stroke.packObjectAttributes(v,n,C.side,!!l,i),me=R.sinks.stroke.packObjectAttributes(v,n,C.bottom,!!l,i),z=Eh({x:E,y:S,cut:P,signed_z:c,is_pivot:O,abs_z:l});if(d==="tunnel_arch"&&!y){const re=Math.max(_,0),te=ci(z),F=Ga(z,b),V=z.map(N=>{const j=N.slice();return j[2]=f?ka:Va,j[4]=0,j});ee(e,me,V);const Q=je(F,te,b).map(N=>(N[2]=re,N[4]=1,N)),fe=F.map(N=>{const j=N.slice();return j[2]=re,j[4]=1,j}),ne=q(Q,fe);do R.generate(e,v,n,C.top,i,G(ne),o,r,a,void 0,re?"fill":"inverse");while(e.isOverloaded());const ie=z.map(N=>{const j=N.slice();return j[2]=re,j[4]=1,j});ee(e,$,ie);const W=q(ie,V);do R.generate(e,v,n,C.side,i,G(W),o,r,a);while(e.isOverloaded());const Y=q(Q.map(N=>{const j=N.slice();return j[2]=f?ka:Va,j[4]=0,j}),Q.map(N=>{const j=N.slice();return j[2]=0,j}));do R.generate(e,v,n,C.side,i,G(Y),o,r,a,void 0,"inverse");while(e.isOverloaded());if(re){const N=je(F,te,b).map(X=>(X[2]=0,X[4]=0,X));ee(e,me,N),ee(e,$,Q);const j=q(N,Q);do R.generate(e,v,n,C.side,i,G(j),o,r,a,void 0,"fill");while(e.isOverloaded());const ce=F.map(X=>{const Z=X.slice();return Z[2]=0,Z[4]=0,Z}),H=q([fe[0],ce[0]],[Q[0],N[0]]);do R.generate(e,v,n,C.side,i,G(H),o,r,a,void 0,"fill");while(e.isOverloaded());ee(e,$,[fe[0],Q[0]]),ee(e,oe,[Q[0],N[0]]),ee(e,me,[N[0],ce[0]]);const J=fe.length-1,be=q([ce[J],fe[J]],[N[J],Q[J]]);do R.generate(e,v,n,C.side,i,G(be),o,r,a,void 0,"fill");while(e.isOverloaded());if(ee(e,$,[fe[J],Q[J]]),ee(e,oe,[Q[J],N[J]]),ee(e,me,[N[J],ce[J]]),f){do R.generate(e,v,n,C.top,i,G(ne),o,r,a,void 0,"depthClear");while(e.isOverloaded());do R.generate(e,v,n,C.side,i,G(j),o,r,a,void 0,"depthClear");while(e.isOverloaded());do R.generate(e,v,n,C.side,i,G(H),o,r,a,void 0,"depthClear");while(e.isOverloaded());do R.generate(e,v,n,C.side,i,G(be),o,r,a,void 0,"depthClear");while(e.isOverloaded())}}}else if(A){if(!D)return;const re=ci(z),te=Ga(z,b),F=je(z,re,b),V=je(te,re,b),Q=z.map(ne=>{const ie=ne.slice();return ie[2]=D,ie}),fe=q(Q,z);do R.generate(e,v,n,C.side,i,G(fe),o,r,a,void 0,"depthClear");while(e.isOverloaded());if(b){const ne=[z[0],te[0]],ie=ne.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),W=q(ne,ie);do R.generate(e,v,n,C.side,i,G(W),o,r,a);while(e.isOverloaded());const Y=[F[0],V[0]],N=Y.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),j=q(N,Y);do R.generate(e,v,n,C.side,i,G(j),o,r,a);while(e.isOverloaded());const ce=[F[0],z[0]],H=ce.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),J=q(ce,H);do R.generate(e,v,n,C.side,i,G(J),o,r,a);while(e.isOverloaded());const be=[te[0],V[0]],X=be.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),Z=q(be,X);do R.generate(e,v,n,C.side,i,G(Z),o,r,a);while(e.isOverloaded());const Ce=z.length-1,Vt=[te[Ce],z[Ce]],Bt=Vt.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),Me=q(Vt,Bt);do R.generate(e,v,n,C.side,i,G(Me),o,r,a);while(e.isOverloaded());const ae=[V[Ce],F[Ce]],Uo=ae.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),kt=q(Uo,ae);do R.generate(e,v,n,C.side,i,G(kt),o,r,a);while(e.isOverloaded());const fc=[V[Ce],te[Ce]],A0=fc.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),P0=q(fc,A0);do R.generate(e,v,n,C.side,i,G(P0),o,r,a);while(e.isOverloaded());const dc=[z[Ce],F[Ce]],E0=dc.map(Ge=>{const de=Ge.slice();return de[2]=D,de[4]=D/(D+_),de}),T0=q(dc,E0);do R.generate(e,v,n,C.side,i,G(T0),o,r,a);while(e.isOverloaded())}if(_){const ne=z.length-1,ie=[te[ne],z[ne],z[0],te[0]].map(Me=>{const ae=Me.slice();return ae[2]=D,ae[4]=D/(D+_),ae}),W=ie.map(Me=>{const ae=Me.slice();return ae[2]=D+_,ae[4]=1,ae}),Y=q(ie,W);do R.generate(e,v,n,C.side,i,G(Y),o,r,a);while(e.isOverloaded());const N=[V[ne],F[ne],F[0],V[0]].map(Me=>{const ae=Me.slice();return ae[2]=D,ae[4]=D/(D+_),ae}),j=N.map(Me=>{const ae=Me.slice();return ae[2]=D+_,ae[4]=1,ae}),ce=q(j,N);do R.generate(e,v,n,C.side,i,G(ce),o,r,a);while(e.isOverloaded());const H=q(W,j);do R.generate(e,v,n,C.top,i,G(H),o,r,a);while(e.isOverloaded());const J=q(N,ie);do R.generate(e,v,n,C.bottom,i,G(J),o,r,a);while(e.isOverloaded());const be=[te[0],V[0]].map(Me=>{const ae=Me.slice();return ae[2]=D,ae[4]=D/(D+_),ae}),X=be.map(Me=>{const ae=Me.slice();return ae[2]=D+_,ae[4]=1,ae}),Z=q(be,X);do R.generate(e,v,n,C.side,i,G(Z),o,r,a);while(e.isOverloaded());const Ce=[V[ne],te[ne]].map(Me=>{const ae=Me.slice();return ae[2]=D,ae[4]=D/(D+_),ae}),Vt=Ce.map(Me=>{const ae=Me.slice();return ae[2]=D+_,ae[4]=1,ae}),Bt=q(Ce,Vt);do R.generate(e,v,n,C.side,i,G(Bt),o,r,a);while(e.isOverloaded())}}else if(d==="border_overpass"||d==="border_flat"){const re=[M[x.previousPointX],M[x.previousPointY],c[0]??0,0],te=!!M[x.beginningIsCut]&&Ya(z[1],z[0],re);te&&z.splice(0,0,re);const F=z.length-1,V=[M[x.nextPointX],M[x.nextPointY],c[c.length-1]??0,0],Q=!!M[x.endingIsCut]&&Ya(z[F-1],z[F],V);Q&&z.push(V);const fe=ci(z);te&&(fe.shift(),z.shift()),Q&&(fe.pop(),z.pop());const ne=z.map(H=>{const J=H.slice();return J[2]=Math.max(J[2]-B,0),J[4]=0,J});ee(e,oe,z);const ie=je(z,fe,b).map(H=>{const J=H.slice();return J[2]=Math.max(H[2]-B,0),J[4]=0,J}),W=je(z,fe,b).map(H=>{const J=H.slice();return J[2]=Math.max(H[2]+_,0),J[4]=1,J}),Y=z.map(H=>{const J=H.slice();return _>0&&(J[2]=Math.max(J[2]+_,0)),J[4]=1,J});if(_>0){ee(e,$,Y);const H=q(Y,z.map(J=>{const be=J.slice();return be[4]=0,be}));do R.generate(e,v,n,C.side,i,G(H),o,r,a);while(e.isOverloaded())}ee(e,me,ie),ee(e,$,W);const N=q(W,Y);do R.generate(e,v,n,C.top,i,G(N),o,r,a);while(e.isOverloaded());const j=q(ne,ie);do R.generate(e,v,n,C.bottom,i,G(j),o,r,a,void 0,"fill");while(e.isOverloaded());const ce=q(ie,W);do R.generate(e,v,n,C.side,i,G(ce),o,r,a,void 0,"fill");while(e.isOverloaded());if(c[0]===0){const H=q([Y[0],ne[0]],[W[0],ie[0]]);do R.generate(e,v,n,C.side,i,G(H),o,r,a,void 0,"fill");while(e.isOverloaded());ee(e,$,[W[0],Y[0]]),ee(e,oe,[Y[0],ne[0]]),ee(e,oe,[ie[0],W[0]]),ee(e,me,[ne[0],ie[0]])}if(c[c.length-1]===0){const H=ne.length-1,J=q([ne[H],Y[H]],[ie[H],W[H]]);do R.generate(e,v,n,C.side,i,G(J),o,r,a,void 0,"fill");while(e.isOverloaded());ee(e,$,[Y[H],W[H]]),ee(e,oe,[ne[H],Y[H]]),ee(e,oe,[W[H],ie[H]]),ee(e,me,[ie[H],ne[H]])}}else if(h){const re=z.map(F=>{const V=F.slice();return V[2]=D,V[4]=D/(D+_),V}),te=q(re,z);do R.generate(e,v,n,C.side,i,G(te),o,r,a);while(e.isOverloaded());do R.generate(e,v,n,C.side,i,G(te),o,r,a,void 0,"fill",!0);while(e.isOverloaded())}else{const re=ci(z),te=d==="border_tunnel_descent",F=d==="border_tunnel"||te,V=F?Math.max(_,0):_,Q=z.map(W=>{const Y=W.slice();return Y[2]-=B,te?Y[2]=0:F&&(Y[2]=Math.max(Y[2],To)),Y[4]=0,Y}),fe=je(z,re,b).map(W=>(W[2]-=B,te&&(W[2]=0),W[4]=0,W)),ne=je(z,re,b).map(W=>(W[2]+=V,te?W[2]=V:F&&(W[2]=Math.max(W[2],To)),W[4]=1,W)),ie=z.map(W=>{const Y=W.slice();if(Y[4]=1,te)Y[2]=V;else if(F){const N=Math.abs(Y[2]/U),j=V-Y[2],ce=Y[2]+N-1;Y[4]=(ce+Math.abs(Y[2]))/j,Y[2]=ce}else Y[2]+=V;return Y});if(F){te&&ee(e,$,ie);const W=q(ie,z.map(j=>{const ce=j.slice();return ce[4]=0,ce}));do R.generate(e,v,n,C.side,i,G(W),o,r,a);while(e.isOverloaded());const Y=ie.map(j=>{const ce=j.slice();return ce[2]=Math.min(j[2],To),ce}),N=q(Y,z);do R.generate(e,v,n,C.side,i,G(N),o,r,a,void 0,"inverse",!0);while(e.isOverloaded())}if(_>0&&(!F||te)){ee(e,me,fe),ee(e,$,ne);const W=q(ne,ie);do R.generate(e,v,n,C.top,i,G(W),o,r,a);while(e.isOverloaded());if(te&&f)do R.generate(e,v,n,C.top,i,G(W),o,r,a,void 0,"depthClear");while(e.isOverloaded())}if(!F||te){const W=q(Q,fe);do R.generate(e,v,n,C.bottom,i,G(W),o,r,a,void 0,"fill");while(e.isOverloaded());const Y=q(fe,ne);do R.generate(e,v,n,C.side,i,G(Y),o,r,a,void 0,"fill");while(e.isOverloaded());if(te&&f)do R.generate(e,v,n,C.side,i,G(Y),o,r,a,void 0,"depthClear");while(e.isOverloaded());if(c[0]===0){const N=q([ie[0],Q[0]],[ne[0],fe[0]]);do R.generate(e,v,n,C.side,i,G(N),o,r,a,void 0,"fill");while(e.isOverloaded());if(te&&f)do R.generate(e,v,n,C.side,i,G(N),o,r,a,void 0,"depthClear");while(e.isOverloaded());ee(e,$,[ne[0],ie[0]]),ee(e,oe,[ie[0],Q[0]]),ee(e,oe,[fe[0],ne[0]]),ee(e,me,[Q[0],fe[0]])}if(c[c.length-1]===0){const N=Q.length-1,j=q([Q[N],ie[N]],[fe[N],ne[N]]);do R.generate(e,v,n,C.side,i,G(j),o,r,a,void 0,"fill");while(e.isOverloaded());if(te&&f)do R.generate(e,v,n,C.side,i,G(j),o,r,a,void 0,"depthClear");while(e.isOverloaded());ee(e,$,[ie[N],ne[N]]),ee(e,oe,[Q[N],ie[N]]),ee(e,oe,[ne[N],fe[N]]),ee(e,me,[fe[N],Q[N]])}}}}}};function Eh(e){var i,s,o;const t=[],n=e.x.length;for(let r=0;r<n;r++){const a=[e.x[r],e.y[r],((i=e.signed_z)==null?void 0:i[r])??0,((s=e.cut)==null?void 0:s[r])??0,0,((o=e.is_pivot)==null?void 0:o[r])??0];e.abs_z&&a.push(e.abs_z[r]),t.push(a)}return t}function ci(e){const t=[];gt(st,e[0][0],e[0][1],e[1][0],e[1][1]),rs=0;for(let n=1;n<e.length;n++)Th(t,e,n);return t}function Th(e,t,n){const i=n===t.length-1;if(Le(Ah,t[n-1][0],t[n-1][1]),Le(ri,t[n][0],t[n][1]),Qc(Ee,st),i)ai=0;else{Le(Oo,t[n+1][0],t[n+1][1]),gt(zt,ri[0],ri[1],Oo[0],Oo[1]);const r=Dt($t(st,zt),-1,1),a=Math.min(Math.sqrt((1-r)/(1+r)),Mh),c=Ps($t(Ee,zt));ai=a*c}let s=Ee[0]+st[0]*rs,o=Ee[1]+st[1]*rs;e.push([s,o]),i&&(s=Ee[0]+st[0]*ai,o=Ee[1]+st[1]*ai,e.push([s,o])),i||(ms(st,zt),rs=ai)}function je(e,t,n){const i=[];for(let s=0;s<e.length;s++){const o=e[s].slice();ms(Ee,t[s]),ot(Ee,Ee,n),mt(o,o,Ee),i.push(o)}return i}function ee(e,t,n){do{const i=e.getBucket("mesh","stroke",t,R.sinks.stroke.binder),s=n.length;for(let o=0;o<s-1;o++){const r=o+1;Yn(i,n[o][0],n[o][1],n[o][2],n[r][0],n[r][1],n[r][2],void 0,!1,n[o][6],n[r][6],n[o][5],n[r][5])}}while(e.isOverloaded())}function q(e,t){return Oh([e[0]].concat(e,t.slice().reverse()))}function Oh(e){const t=e.length,n=[[],[],[],[],[],[]];e[0][6]!==void 0&&n.push([]);for(let i=0;i<t;i++){const s=$e(i,t),o=e[i];n[0][s]=o[0],n[1][s]=o[1],n[2][s]=o[3],n[3][s]=o[2],n[4][s]=o[4]??0,n[5][s]=o[5]??0,n[6]&&(n[6][s]=o[6]??0)}return n}function G(e){return{x:e[0],y:e[1],cut:e[2],signed_z:e[3],gradient:e[4],is_pivot:e[5],abs_z:e[6]}}function Ga(e,t){return e=e.map(n=>n.slice()),jt(Ee,e[0],e[1]),Lt(Ee,Ee),dn(Ee,Ee,t),fn(e[0],e[0],Ee),jt(Ee,e[e.length-1],e[e.length-2]),Lt(Ee,Ee),dn(Ee,Ee,t),fn(e[e.length-1],e[e.length-1],Ee),e}const Ya=function(){const e=Math.cos(ve(xh));return(t,n,i)=>(bn(st,n,t),mi(st,st),bn(zt,n,i),mi(zt,zt),$t(st,zt)<=e)}();function Sh(e,t,n,i){return Pe([e,t.innerId,n],t,i)}const So={symbol:"metricPoint",sinks:{fill:{stride:8,binder:(e,t)=>{e.views.position=new Uint16Array(t),e.views.texCoords=new Uint16Array(t,4)},packObjectAttributes:Sh,unpackObjectAttributes:e=>({styleId:e[0],layerId:e[1],tiers:e[2],tileData:e.slice(3)})}},generate(e,t,n,i,s,o,r){Bh(e,i,s,n,o);const a=se(s.style.width,o),c=se(s.style.height,o),l=se(s.style.rotation,o),[f,d]=Sf([t.x,t.y],a,c,l,r),p=k(s.ignoreTier,o)?null:o.tileAttrs[o.tileProps.db_tiers],m=e.getBucket("metricPoint","fill",So.sinks.fill.packObjectAttributes(i.id,s,p,o),So.sinks.fill.binder);let y=m.elements.offset;bh(m.indices,y,0,1,2,0,2,3),as(m,y++,f[0],d[0],0,0),as(m,y++,f[1],d[1],1,0),as(m,y++,f[2],d[2],1,1),as(m,y++,f[3],d[3],0,1),m.elements.offset=y}};function as(e,t,n,i,s,o){t=t*4,e.views.position[t]=16383+n,e.views.position[t+1]=16383+i,e.views.texCoords[t]=Ct(s),e.views.texCoords[t+1]=Ct(o)}function bh(e,t,n,i,s,o,r,a){const c=e.buffer,l=e.offset;c[l]=t+n,c[l+1]=t+i,c[l+2]=t+s,c[l+3]=t+o,c[l+4]=t+r,c[l+5]=t+a,e.offset=l+6}function Bh(e,t,n,i,s){const{rasterSets:o}=t,r=Yr(i);wn(n.style.iconImage).forEach(a=>{if(!a.length)return;const c=o.byKey[Sr(a)];if(!c){console.error(`Not found raster set with texture ${a}`);return}if(!c.isSvg)return;const l=se(n.style.width,s),f=se(n.style.height,s),d=js(l,f),p=l*d,m=f*d;e.atlasPacker.packSvg(c,[{w:p,h:m}],r),c.rasters.forEach(y=>e.atlasPacker.addRastersToLoad(t.id,y))})}const _h=64,an=1e5,bo=4;function Lh(e){return e!==null&&typeof e=="object"&&e.type===_h}function $a(e){return Rh(e.lo,e.hi)}function ja(e){return[e%an,Math.floor(e/an)%an,0,0]}function Dh(e){let n=0;for(let i=0;i<bo;i++){const s=e[i]*4294967296+n;n=Math.floor(s/an),e[i]=s%an}}function Fh(e,t){let n=0;for(let i=0;i<bo;i++){const s=e[i]+t[i]+n;n=Math.floor(s/an),e[i]=s%an}}function Nh(e){const t="00000";let n=!0,i=bo,s="";for(;--i>=0;){const o=String(e[i]);n?e[i]!==0&&(s+=o,n=!1):s+=t.slice(o.length)+o}return s.length||(s="0"),s}function Rh(e,t){const n=ja(e),i=ja(t);return Dh(i),Fh(i,n),Nh(i)}const Re=[0,0,0],cs=[0,0,0],ls=new Float64Array(16),Ch={symbol:"tunnel",sinks:{},generate(e,t,n,i,s,o,r,a){var te;const{tileProps:c,tileAttrs:l}=i,f=(te=l[c.db_tiers])==null?void 0:te[0];if($a(l[c.id])!=="70030076221371399"||!f)return;const p=t.id;Le(Re,0,0);const y=Mt(o,Re)*Be,A=32768/o.size*y,h=1/(32768/o.size),w=l[c.objectLength],x=l[c.componentDistanceStart]??0,M=l[c.componentDistanceEnd]??0,v=x===0?0:-5,T=175,E=243,S=M===w?0:-5;if(Number.isNaN(w)||Number.isNaN(x)||w===0)return;const P=E-T,O=T+P*x/w,L=T+P*M/w,U=3.5*A,u=5*A,g=[];let I=0;for(let F=0;F<s.x.length;F++){const V=[s.x[F],s.y[F],0];F>0&&(I+=Bn(V,g[F-1]),V[2]=I),g.push(V)}const b=Uh(g),B=ci(g);g.forEach(F=>{const V=F[2]/b;F[2]=(v+V*(S-v))*y,F[5]=(O+V*(L-O))*y});const _=R.sinks.stroke.packObjectAttributes(p,n,C.side,!0,i),D=je(g,B,U),ye=je(g,B,-U),$=q(D,ye),oe=je(g,B,u),me=oe.map(F=>{const V=F.slice();return V[2]=Math.max(0,V[2]),V});R.generate(e,p,n,C.side,i,G(q(oe,me)),o,r,a,void 0,"inverse");const z=je(g,B,-u),re=z.map(F=>{const V=F.slice();return V[2]=Math.max(0,V[2]),V});R.generate(e,p,n,C.side,i,G(q(re,z)),o,r,a,void 0,"inverse"),g[0][2]!==0&&g[g.length-1][2]!==0&&R.generate(e,p,n,C.side,i,G(q(me,re)),o,r,a,void 0,"inverse");do oi.generate(e,p,n,i,G($),f,o,void 0);while(e.isOverloaded());for(let F=1;F<g.length;F++){const V=[],Q=[],fe=g[F-1],ne=g[F],ie=B[F-1],W=B[F];for(let N=0;N<=181;N+=15){const j=ve(N),ce=fe.slice();Se(Re,ie[0],ie[1],0),dn(Re,Re,U),un(cs,Re),er(ls,-j,cs),yi(Re,Re,ls),Re[2]*=h,fn(ce,ce,Re),V.push(ce);const H=ne.slice();Se(Re,W[0],W[1],0),dn(Re,Re,U),un(cs,Re),er(ls,-j,cs),yi(Re,Re,ls),Re[2]*=h,fn(H,H,Re),Q.push(H)}const Y=q(V,Q);if(R.generate(e,p,n,C.side,i,G(Y),o,r,a,void 0,"fill"),F===1&&g[0][2]===0){ee(e,_,V);const N=g[0].slice(),j=g[0].slice(),ce=B[0].slice(),H=B[0].slice();ot(ce,ce,u),ot(H,H,-u),mt(N,N,ce),mt(j,j,H);const J=N.slice(),be=j.slice();J[2]+=u*h,be[2]+=u*h;const X=[N];for(let Z=0;Z<5;Z++)X.push(J);for(let Z=0;Z<5;Z++)X.push(be);X.push(j),ee(e,_,X),R.generate(e,p,n,C.side,i,G(q(X,V)),o,r,a,void 0,"fill")}else if(F===g.length-1&&g[g.length-1][2]===0){ee(e,_,Q);const N=g[g.length-1].slice(),j=g[g.length-1].slice(),ce=B[g.length-1].slice(),H=B[g.length-1].slice();ot(ce,ce,u),ot(H,H,-u),mt(N,N,ce),mt(j,j,H);const J=N.slice(),be=j.slice();J[2]+=u*h,be[2]+=u*h;const X=[N];for(let Z=0;Z<5;Z++)X.push(J);for(let Z=0;Z<5;Z++)X.push(be);X.push(j),ee(e,_,X),R.generate(e,p,n,C.side,i,G(q(Q,X)),o,r,a,void 0,"fill")}}if(g[0][2]===0||g[g.length-1][2]===0){const F=je(g,B,u),V=je(g,B,-u),Q=F.map(Y=>{const N=Y.slice();return N[2]=Math.max(0,N[2]+u*h),N}),fe=V.map(Y=>{const N=Y.slice();return N[2]=Math.max(0,N[2]+u*h),N});F.forEach(Y=>{Y[2]=Math.max(0,Y[2])}),V.forEach(Y=>{Y[2]=Math.max(0,Y[2])});const ne=q(F,Q),ie=q(fe,V);ee(e,_,F),ee(e,_,V),ee(e,_,Q),ee(e,_,fe),R.generate(e,p,n,C.side,i,G(ne),o,r,a,void 0,"fill"),R.generate(e,p,n,C.side,i,G(ie),o,r,a,void 0,"fill");const W=q(Q,fe);R.generate(e,p,n,C.top,i,G(W),o,r,a,void 0,"fill")}}};function Uh(e){let t=0;for(let n=0;n<e.length-1;n++)t+=Xo(e[n],e[n+1]);return t}const zh={symbol:"simpleMesh",sinks:{fill:{stride:24,binder:()=>{},packObjectAttributes(e,t,n){return Pe([e,t.innerId],t,n)},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tileData:e.slice(2)}}}}},Vh=32,fs={symbol:"globe",sinks:{fill:{stride:16,binder:(e,t)=>{e.views.ecefPosition=new Int16Array(t),e.views.flatPosition=new Uint16Array(t,6),e.views.texture=new Uint16Array(t,12)},packObjectAttributes(e,t,n){return[e,t.innerId,n]},unpackObjectAttributes(e){return{styleId:e[0],layerId:e[1],tileData:e.slice(2)}},generate(e,t,n,i){const s=i.coords.join("/"),o=e.getBucket("globe","fill",fs.sinks.fill.packObjectAttributes(t.id,n,s),fs.sinks.fill.binder);Yh(o,Vh,i.coords)}}}},kh=Xe.fromGeo([0,90]),Gh=Xe.fromGeo([0,-90]);function Yh(e,t,n){const i=Pi(n),s=e.views.ecefPosition,o=e.indices.buffer,r=n[1]===2**n[2]-1,a=n[1]===0,c=e.elements.offset*fs.sinks.fill.stride/Uint16Array.BYTES_PER_ELEMENT;let l=0,f=e.indices.offset;for(let d=0;d<t;d++)for(let p=0;p<t;p++){let m;const y=[d*32768/(t-1),p*32768/(t-1)];r&&p===t-1?m=kh:a&&p===0?m=Gh:m=Fs(i,y),s[c+l++]=m[0]*Ve,s[c+l++]=m[1]*Ve,s[c+l++]=m[2]*Ve,s[c+l++]=16383+y[0],s[c+l++]=16383+y[1],s[c+l++]=0,s[c+l++]=d/(t-1)*(2**16-1),s[c+l++]=p/(t-1)*(2**16-1)}for(let d=0;d<t-1;d++)for(let p=0;p<t-1;p++){const m=d*t+p,y=m+1,A=m+t,h=A+1;o[f++]=m,o[f++]=A,o[f++]=y,o[f++]=y,o[f++]=A,o[f++]=h}e.indices.offset=f,e.elements.offset=c+l/8}var Sn=(e=>(e[e.none=0]="none",e[e.fadeIn=1]="fadeIn",e[e.fadeOut=-1]="fadeOut",e))(Sn||{});const $h={arrow:Js,line:ht,polygon:nn,embankment:R,polygon3d:R,metricPoint:So,labelLine:Qi,lineExtrusion:tn,polygonExtrusion:jn,oneWayLine:es,dashedLine:en,shiftedLine:Ws,circle:Qs,buildingModel:xn,gltfModel:ti,point:yt,raster:no,heatmap:Qn,dem:pt,mesh:R,mapMesh:oi,overpass:Ph,tunnel:Ch,simpleMesh:zh,globe:fs},Xa={labelLine:Qi,oneWayLine:es,point:yt};function Wa(e,t){const n=$h[e];return n?n.sinks[t].stride:0}function Ha(e,t,n,i,s,o,r,a){const c=Xa[t.type];if(c)do c.processElement(e,n,i,s,o,r,a);while(n.isOverloaded())}function jh(e,t,n,i,s,o,r){const a=Xa[i.type];a&&a.getLabelingInfo(e,t,n,s,o,r)}function Xh(e,t){let n=!1,i;function s(){n=!1,i&&(o(...i),i=!1)}function o(...r){n?i=r:(e(...r),setTimeout(s,t),n=!0)}return o}const ds=.8;class Wh{constructor(t,n){this.offset=0,this.stride=n,this.buffer=new ArrayBuffer(t),this.view=new Int32Array(this.buffer),this.comittedOffsets=0,this.maximum=t/n,this.watermark=this.maximum*ds}extend(){const t=this.buffer.byteLength*2;this.maximum=t/this.stride,this.watermark=this.maximum*ds;const n=new ArrayBuffer(t),i=new Int32Array(n);return i.set(this.view),this.buffer=n,this.view=i,n}}class Hh{constructor(t){this.offset=0,this.buffer=new Int32Array(t),this.comittedOffsets=0,this.watermark=t*ds}extend(){const t=this.buffer.length*2;this.watermark=t*ds;const n=new Int32Array(t);n.set(this.buffer),this.buffer=n}}class Za{constructor(t,n,i,s,o,r){this.objectsData={},this.extents=new Uint16Array([65535,65535,65535,0,0,0]),this.maxDiag=0,this.drawMode=o;const a=t!=="buildingModel"?67200:67200*5,c=Wa(t,n);this.elements=new Wh(a,c),this.indices=new Hh(a*2/c),this.views={},this.binder=s,s(this,this.elements.buffer),this.attributes=i,this.key=r}static generateKey(t){return JSON.stringify(t)}resetOffsets(){this.elements.offset=0,this.elements.comittedOffsets=0,this.indices.offset=0,this.indices.comittedOffsets=0}resetBuildingsData(){this.objectsData={}}resetInstancesExtents(){this.extents[0]=65535,this.extents[1]=65535,this.extents[2]=65535,this.extents[3]=0,this.extents[4]=0,this.extents[5]=0,this.maxDiag=0}commit(){this.elements.comittedOffsets=this.elements.offset,this.indices.comittedOffsets=this.indices.offset}rollback(){this.elements.offset=this.elements.comittedOffsets,this.indices.offset=this.indices.comittedOffsets}checkWatermarks(){let t=0;const n=this.elements;n.offset>n.watermark&&(n.offset>=n.buffer.byteLength/n.stride&&(t=1),this.binder(this,n.extend()));const i=this.indices;return i.offset>i.watermark&&(i.offset>=i.buffer.length&&(t=1),i.extend()),t}}function Ke(e,t,n){n=n||{},this.w=e||64,this.h=t||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}Ke.prototype.pack=function(e,t){e=[].concat(e),t=t||{};for(var n=[],i,s,o,r,a=0;a<e.length;a++)if(i=e[a].w||e[a].width,s=e[a].h||e[a].height,o=e[a].id,i&&s){if(r=this.packOne(i,s,o),!r)continue;t.inPlace&&(e[a].x=r.x,e[a].y=r.y,e[a].id=r.id),n.push(r)}return this.shrink(),n},Ke.prototype.packOne=function(e,t,n){var i={freebin:-1,shelf:-1,waste:1/0},s=0,o,r,a,c;if(typeof n=="string"||typeof n=="number"){if(o=this.getBin(n),o)return this.ref(o),o;typeof n=="number"&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(c=0;c<this.freebins.length;c++){if(o=this.freebins[c],t===o.maxh&&e===o.maxw)return this.allocFreebin(c,e,t,n);t>o.maxh||e>o.maxw||t<=o.maxh&&e<=o.maxw&&(a=o.maxw*o.maxh-e*t,a<i.waste&&(i.waste=a,i.freebin=c))}for(c=0;c<this.shelves.length;c++)if(r=this.shelves[c],s+=r.h,!(e>r.free)){if(t===r.h)return this.allocShelf(c,e,t,n);t>r.h||t<r.h&&(a=(r.h-t)*e,a<i.waste&&(i.freebin=-1,i.waste=a,i.shelf=c))}if(i.freebin!==-1)return this.allocFreebin(i.freebin,e,t,n);if(i.shelf!==-1)return this.allocShelf(i.shelf,e,t,n);if(t<=this.h-s&&e<=this.w)return r=new Bo(s,this.w,t),this.allocShelf(this.shelves.push(r)-1,e,t,n);if(this.autoResize){var l,f,d,p;return l=f=this.h,d=p=this.w,(d<=l||e>d)&&(p=Math.max(e,d)*2),(l<d||t>l)&&(f=Math.max(t,l)*2),this.resize(p,f),this.packOne(e,t,n)}return null},Ke.prototype.allocFreebin=function(e,t,n,i){var s=this.freebins.splice(e,1)[0];return s.id=i,s.w=t,s.h=n,s.refcount=0,this.bins[i]=s,this.ref(s),s},Ke.prototype.allocShelf=function(e,t,n,i){var s=this.shelves[e],o=s.alloc(t,n,i);return this.bins[i]=o,this.ref(o),o},Ke.prototype.shrink=function(){if(this.shelves.length>0){for(var e=0,t=0,n=0;n<this.shelves.length;n++){var i=this.shelves[n];t+=i.h,e=Math.max(i.w-i.free,e)}this.resize(e,t)}},Ke.prototype.getBin=function(e){return this.bins[e]},Ke.prototype.ref=function(e){if(++e.refcount===1){var t=e.h;this.stats[t]=(this.stats[t]|0)+1}return e.refcount},Ke.prototype.unref=function(e){return e.refcount===0?0:(--e.refcount===0&&(this.stats[e.h]--,delete this.bins[e.id],this.freebins.push(e)),e.refcount)},Ke.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},Ke.prototype.resize=function(e,t){this.w=e,this.h=t;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(e);return!0};function Bo(e,t,n){this.x=0,this.y=e,this.w=this.free=t,this.h=n}Bo.prototype.alloc=function(e,t,n){if(e>this.free||t>this.h)return null;var i=this.x;return this.x+=e,this.free-=e,new Zh(n,i,this.y,e,t,e,this.h)},Bo.prototype.resize=function(e){return this.free+=e-this.w,this.w=e,!0};function Zh(e,t,n,i,s,o,r){this.id=e,this.x=t,this.y=n,this.w=i,this.h=s,this.maxw=o||i,this.maxh=r||s,this.refcount=0}class qh{constructor(){this.packer=new Ke(Gt[0],Gt[1]),this.currentAtlasIndex=0,this.packedRasters=[],this.rastersToLoad=[],this.newRasterSets=new Map}addNewRasterSet(t,n){let i=this.newRasterSets.get(t);i||(i=[],this.newRasterSets.set(t,i)),i.push(n)}pack(t,n,i){t.isSvg?this.packSvg(t,n.map(s=>({w:s,h:s})),i):this.packPng(t,n,i)}packSvg(t,n,i){const{rasters:s}=t,o=new Set;for(const{w:r,h:a}of s)o.add(`${r}_${a}`);for(const r of n){const a=r.w*i,c=r.h*i;if(o.has(`${a}_${c}`))continue;let l=this.packer.packOne(a+2,c+2);l===null&&(this.packer=new Ke(Gt[0],Gt[1]),this.currentAtlasIndex++,l=this.packer.packOne(a+2,c+2));const f=s.length,d={rasterSetIndex:t.index,rasterIndex:f,w:a,h:c,x:l.x+1,y:l.y+1,anchorX:t.anchorX,anchorY:t.anchorY,atlasIndex:this.currentAtlasIndex,isPacked:!0};s.push(d),this.packedRasters.push(t.index,f,d.x,d.y,d.w,d.h,this.currentAtlasIndex)}}addRastersToLoad(t,n){this.rastersToLoad.push(t,n.rasterSetIndex,n.rasterIndex)}getNewRasterSets(){const t=this.newRasterSets;return this.newRasterSets=new Map,t}getPackedRasters(){if(this.packedRasters.length===0)return;const t=new Uint16Array(this.packedRasters);return this.packedRasters=[],t}getRastersToLoad(){const t=new Float64Array(this.rastersToLoad);return this.rastersToLoad=[],t}packPng(t,n,i){const{rasters:s}=t;for(const o of n){const r=o*i,a=Ea(s,r,!1);if(a===void 0)continue;const c=t.rasters[a];if(c.isPacked)continue;let l=this.packer.packOne(c.w+2,c.h+2);l===null&&(this.packer=new Ke(Gt[0],Gt[1]),this.currentAtlasIndex++,l=this.packer.packOne(c.w+2,c.h+2)),c.x=l.x+1,c.y=l.y+1,c.atlasIndex=this.currentAtlasIndex,c.isPacked=!0,this.packedRasters.push(t.index,a,c.x,c.y,c.w,c.h,this.currentAtlasIndex)}}}const Kh=2**32-1;class Jh{constructor(){this.colorById=new Map,this.index=0}getIndex(t){if(!t)return this.nextIndex();const n=this.colorById.get(t);if(n!==void 0)return n;const i=this.nextIndex();return this.colorById.set(t,i),i}nextIndex(){return++this.index%Kh}}const qa=2**20,Ka=["main","parser","labeling","models"],_o={};for(let e=0;e<Ka.length;e++){const t=Ka[e];_o[t]={min:1+e*qa,max:(e+1)*qa}}class Qh{constructor(t){this.atlasPacker=new qh,this.pointIndexer=new Jh,this.floorHidingMap=new Map,this.usedModels=new Set,this.dataModels={},this.promotedObjectAttributes={},this.addedBuckets=[],this.labels=[],this.idIndexer=new Od(t),this.workerName=t,this.dataModelsIndex=_o[t].min,this.buckets={},this.geoJsonData=[],this.reset()}reset(){this.buckets={},this.geoJsonData=[],this.addedBuckets=[],this.floorHidingMap.clear(),this.labels=[],this.usedModels.clear()}getStatsAfterReset(){return{buckets:Object.keys(this.buckets).length,geoJsonData:this.geoJsonData.length,addedBuckets:this.addedBuckets.length,floorHidingMap:this.floorHidingMap.size,labels:this.labels.length,usedModels:this.usedModels.size}}addLabel(t){this.labels.push(t)}addUsedModel(t){this.usedModels.add(t)}getIndexerStats(){return this.idIndexer.getIndexerStats()}getBucketsMemoryFootprint(){return Object.keys(this.buckets).map(t=>{const n=t,i=this.buckets[n];return i?{[t]:Object.keys(i).map(s=>{const o=i[s];if(o&&typeof o=="object"){const r=Object.keys(o).map(a=>{const c=o[a];if(c&&c.elements&&c.elements.buffer)return{elementsBuffer:c.elements.buffer.byteLength,indices:c.indices.buffer.byteLength}});return{[s]:r}}return{[s]:0}})}:{[t]:[]}})}addPromotedObjectAttributes(t,n){this.promotedObjectAttributes[t]=n}addFeature(t){this.geoJsonData.push(t)}addUsedModelByUrl(t){const n=this.dataModels[t];if(n!==void 0)return n;const{min:i,max:s}=_o[this.workerName];this.dataModelsIndex=i+(this.dataModelsIndex+1-i)%(s-i);const o=-this.dataModelsIndex;return this.dataModels[t]=o,o}getDataModelsUrls(){const t={};for(const n in this.dataModels)this.usedModels.has(this.dataModels[n])&&(t[n]=this.dataModels[n]);return t}getBucket(t,n,i,s,o=ko){let r=this.buckets[t];r===void 0&&(r={},this.buckets[t]=r);let a=r[n];a===void 0&&(a=r[n]={});const c=Za.generateKey(i),l=a[c];if(l)return this.addedBuckets.push(l),l;const f=new Za(t,n,i,s,o,c);return a[c]=f,this.addedBuckets.push(f),f}isOverloaded(){const t=this.addedBuckets;let n=0,i=0;for(;i<t.length;)n=n+t[i++].checkWatermarks();const s=n>0;if(s)for(;i--;)t[i].rollback();else for(;i--;)t[i].commit();return t.length=0,s}addFloorHidingMap(t,n){let i=this.floorHidingMap.get(n);i===void 0&&(i=[],this.floorHidingMap.set(n,i)),i.push(t)}getAccumulatedData(){const t=this.buckets,n=[],i=[];for(const p in t){const m=p,y=t[m];for(const A in y){const h=A,w=y[h],x=Wa(m,h)/4;let M=0;for(const S in w)M+=w[S].indices.offset;if(M===0)continue;const v=[],T=new Int32Array(M*x);let E=0;for(const S in w){const P=w[S],{elements:O,indices:L,attributes:U,meta:u,objectsData:g,extents:I,maxDiag:b}=P,{view:B}=O,{buffer:_}=L;if(O.offset===0)continue;const D=E,ye={};for(let $=0;$<L.offset;$++){const oe=g?g[$]:null;if(oe){const z=E/x;e0(oe,z,ye)}const me=_[$]*x;for(let z=0;z<x;z++)T[E++]=B[me+z]}v.push({attributes:U,drawMode:P.drawMode,rangeStart:D*4,rangeEnd:E*4,meta:u,objectsData:Object.keys(ye).length>0?ye:void 0,extents:new Uint16Array(I),maxDiag:b}),P.resetOffsets(),P.resetBuildingsData(),P.resetInstancesExtents(),P.meta=void 0}n.push({symbol:m,sink:h,buffer:T.buffer,generatedObjects:v}),i.push(T.buffer)}}const s=this.idIndexer.getPacked();i.push(s.centerBuffer),i.push(s.instanceIdBuffer),i.push(s.layerIdBuffer),i.push(s.objectClassBuffer),i.push(s.phaseBuffer),i.push(s.styleIdBuffer),i.push(s.sublayerBuffer);const o=this.atlasPacker.getPackedRasters();o!==void 0&&i.push(o.buffer);const r=this.atlasPacker.getRastersToLoad();i.push(r.buffer);const a=this.getDataModelsUrls();this.usedModels=new Set;const c=this.floorHidingMap;this.floorHidingMap=new Map;const l=this.labels;this.labels=[];const f=this.promotedObjectAttributes;this.promotedObjectAttributes={};const d=this.geoJsonData.length?this.geoJsonData:void 0;return this.geoJsonData=[],{data:n,labels:l,floorHidingMap:c,packedRasters:o,rastersToLoad:r,dataModelsUrls:a,identifyIds:s,transferable:i,promotedObjectAttributes:f,debugGeoJsonData:d}}}function e0(e,t,n){const i=e.objectId;n[i]||(n[i]=[]);let s=!1;for(const o of n[i]){const r=o.offset+o.size,a=t+e.size;(o.offset<=t&&r>=t||t<=o.offset&&a>=o.offset)&&(o.offset=Math.min(t,o.offset),o.size=Math.max(r,a)-o.offset,s=!0)}s||n[i].push({offset:t,size:e.size})}class Ja{constructor(t,n,i){this.line=t,this.lengths=[],this.angles=[];let s=n,o=t[0],r=t[1];const a=t.length/3;for(let c=0;c<a;c++){const l=t[c*3]-o,f=t[c*3+1]-r;s+=Math.sqrt(l*l+f*f),this.lengths.push(s),o+=l,r+=f}this.finishLength=this.lengths[this.lengths.length-1],this.startLength=this.lengths[0],this.midLength=i/2,this.vertexCount=a,this.angles.push(0);for(let c=1;c<a;c++){const l=this.line[(c-1)*3],f=this.line[c*3],d=this.line[(c-1)*3+1],p=this.line[c*3+1];this.angles.push(Math.atan2(p-d,f-l))}}interpolate(t,n){const i=n,s=i-1,o=this.lengths[s],r=this.lengths[i],a=this.line[s*3],c=this.line[i*3],l=this.line[s*3+1],f=this.line[i*3+1],d=(t-o)/(r-o);return[(1-d)*a+d*c,(1-d)*l+d*f,0,this.angles[n]]}getSegmentIndex(t){for(let n=0;n<this.lengths.length;n++)if(t<this.lengths[n])return n;return this.lengths.length}}class t0{constructor(){this.labels={}}add(t){const n=t.id,i=t.componentDistanceStart;this.labels[n]===void 0&&(this.labels[n]={});const s=this.labels[n];s[i]===void 0&&(s[i]=[]),s[i].push(t)}merge(){const t=[];for(const n in this.labels){const i=this.labels[n],s=Object.keys(i).sort((r,a)=>Number(r)-Number(a));let o=0;for(;o<s.length;){const r=s[o];if(i[r].length===0){o++;continue}const a=[];let c=i[r].pop();for(;c!==void 0;)if(a.push(c),(c.componentDistanceStart!==0||c.componentDistanceEnd!==0)&&i[c.componentDistanceEnd]!==void 0){const l=c;if(c=i[c.componentDistanceEnd].pop(),c){const f=l.mapPointVertices.length;(l.mapPointVertices[f-3]!==c.mapPointVertices[0]||l.mapPointVertices[f-2]!==c.mapPointVertices[1])&&(c=void 0)}}else c=void 0;if(a.length===1){const l=a[0];l.axis=new Ja(l.mapPointVertices,l.componentDistanceStartWorld,l.objectLengthWorld),t.push(l)}else a.length>1&&t.push(this.stitch(a))}}return t}stitch(t){let n=0;for(let r=0;r<t.length;r++)n+=t[r].mapPointVertices.length;n-=(t.length-1)*3;const i=new Int32Array(n);let s=0;for(let r=0;r<t.length;r++){const a=t[r].mapPointVertices,c=r>0?3:0;for(let l=c;l<a.length;l++)i[s++]=a[l]}const o=t[0];return o.axis=new Ja(i,o.componentDistanceStartWorld,o.objectLengthWorld),t[0]}}class n0{constructor(t,n,i,s,o,r,a,c,l,f,d,p){this.type=Ie.Box,this.marginTopBottom=0,this.marginLeftRight=0,this.id=t,this.label={layer:{innerId:0},styleId:-100,id:this.id,symbol:"nevermind",phase:NaN},this.groupPriority=p??hc,this.itemPriority=d??1,this.parent=f,this.placementIndex=0,this.labelingGroup=l,this.labelingGroupTable=c.labelingGroups.table,this.anchorWorld=_n(),Oc(this.anchorWorld,s),r!==0&&(this.anchorWorld[2]*=r),this.anchorGeo=xe.toGeo(this.anchorWorld),this.anchorScreen=a.project(this.anchorGeo),mt(this.anchorScreen,this.anchorScreen,o),this.boxes=[[0,0,n,i]]}}class i0{constructor(t,n,i){const s=[];let o=0;for(let r=0;r<t.length;r++){const a=t.charCodeAt(r),c=n&&n[a];c?(s.push(c),o=o+c.advance):a!==Je.bomCharCode&&Rl(t[r],a)}this.glyphs=s,this.width=o+Je.baseSize*i*(t.length-1)}}function Lo(e,t,n){const i={lines:[],maxWidth:0},s=e.split(`
`);for(let o=0;o<s.length;o++){const r=new i0(s[o],n,t);i.lines.push(r),r.width>i.maxWidth&&(i.maxWidth=r.width)}return i}function Do(e,t,n){for(const i of t)if(!n.has(e,i))return!1;return!0}function Fo(e,t,n){if(e===void 0)return;const i=We(e,t);if(i!=="")return n.fontNameToIndex[i]===void 0?cn:i}const Qa=0;Pa.Loaded;function s0(e){let t=!1,n;return function(...i){return t||(t=!0,n=e.apply(this,i)),n}}let hs=e=>e,li=null,ec=!1;new Promise(e=>{li=()=>{ec=!0,e()}});const o0=s0(function(e){new Function(e)(),hs=self.mapglRtlPlugin.processRtl,li&&li()}),tc=ve(hi.axisAngleToleranceDeg),r0=hi.axisCheckDistancePx,a0=ve(hi.lineLabelsHidePitchDeg);function c0(e,t,n,i,s,o,r,a,c,l,f){const d=[],p=[],m=[],y=[],A={},h=l0(e,s),w=new t0;for(let M=0;M<e.length;M++){const v=e[M],T=s.get(v);if(T===void 0)continue;const E=t.styleState._activeFloorIds;for(let S=0;S<T.length;S++){const P=T[S];if(P.floorId&&(E.length===0||!E.includes(P.floorId)))continue;const O=i.getStyle(P.styleId);if(!O){console.error(`Not found style ${P.styleId} in labeling#collectLabelingElements`);continue}if(!(P.source===En.Tile&&l.has(P.id)&&!P.floorId)&&!(P.source!==En.PersonalPoi&&h.personalPoi.has(P.id)&&!qn(P))&&!(P.source===En.PersonalPoi&&h.commercialPoi.has(P.id)))switch(P.layer.type){case"point":{if(nc(P,r,a,t.styleState,t.styleZoom,O,f,t.elevation)&&No(P,t.styleZoom))if(P.geometryType===Gi.Line)w.add(P);else{const U=[P.mapPointVertices[0],P.mapPointVertices[1],P.mapPointVertices[2],0];ic(y,m,A,P,U,n,t,O,c)}break}case"labelLine":{nc(P,r,a,t.styleState,t.styleZoom,O,f,t.elevation)&&No(P,t.styleZoom)&&w.add(P);break}case"oneWayLine":No(P,t.styleZoom)&&w.add(P);break}}}const x=w.merge();for(let M=0;M<x.length;M++){const v=x[M],T=i.getStyle(v.styleId);if(!T){console.error(`Not found style ${v.styleId} in labeling#collectLabelingElements`);continue}v.layer.type==="point"?f0(y,m,A,v,T,n,t,c):d0(p,y,v,T,n,t)}return o.forEach(({id:M,width:v,height:T,position:E,offset:S,labelingGroup:P,parentPoiId:O})=>{let L;if(O&&(L=A[O],!L))return;const U=i.getStyle(Qa);if(!U){console.error(`Not found style ${Qa} in labeling#collectLabelingElements`);return}const u=new n0(M,v,T,E,S,t.buildingHeight,n,U,P,L,L==null?void 0:L.itemPriority,L==null?void 0:L.groupPriority);d.push(u)}),{boxElements:d,oneWayTileElements:p,noLabelingElements:m,otherTileElements:y}}function l0(e,t){const n={personalPoi:new Set,commercialPoi:new Set};for(const i of e){const s=t.get(i);if(s!==void 0)for(const o of s)o.source===En.PersonalPoi?n.personalPoi.add(o.id):qn(o)&&n.commercialPoi.add(o.id)}return n}function nc(e,t,n,i,s,o,r,a){const{layer:c}=e;if(c.type!=="point"&&c.type!=="labelLine")return!1;Number.isNaN(e.demElevation)?e.elevation=0:e.elevation=(e.demElevation-(a??0))*Be;const l=Ue(s,i,!1,e.tileData);if(ec&&!e.rtlProcessed&&(e.label=hs(e.label)??"",e.label2=hs(e.label2),e.iconLabel=hs(e.iconLabel),e.updateRanges(),r(cn,e.ranges),wn(c.style.textFont).forEach(A=>{A.length&&r(A,e.ranges)}),c.type==="point"&&c.style.textFont2&&wn(c.style.textFont2).forEach(A=>{A.length&&r(A,e.ranges)}),c.type==="point"&&c.style.iconTextFont&&wn(c.style.iconTextFont).forEach(A=>{A.length&&r(A,e.ranges)}),e.rtlProcessed=!0),!e.rtlProcessed)return!1;const{ranges:f}=e,d=Fo(c.style.textFont,l,o);let p;if(d&&e.label&&Do(d,f,n)&&(p=Lo(e.label,c.style.textLetterSpacing,t[d]),e.textMetrics=p),c.type==="labelLine")return!d||!!p;const m=Fo(c.style.iconTextFont,l,o);m&&e.iconLabel&&Do(m,f,n)&&(e.iconTextMetrics=Lo(e.iconLabel,c.style.iconTextLetterSpacing,t[m]));const y=Fo(c.style.textFont2,l,o);return d&&e.label&&y&&e.label2&&Do(y,f,n)&&(e.textMetrics2=Lo(e.label2,c.style.textLetterSpacing,t[y])),!d||!e.label?!m||!e.iconLabel||!!e.iconTextMetrics:!!p&&(!m||!e.iconLabel||!!e.iconTextMetrics)&&(!y||!e.label2||!!e.textMetrics2)}function ic(e,t,n,i,s,o,r,a,c){var l;jh(i,s,a,i.layer,r,o,c);for(let f=0;f<i.labelingElements.length;f++){const d=i.labelingElements[f];if(d.labelingGroup===Vn||((l=d.parent)==null?void 0:l.labelingGroup)===Vn){t.push(d);continue}e.push(d),d.type===Ie.Icon&&(n[d.label.id]=d)}}function f0(e,t,n,i,s,o,r,a){const{layer:c}=i;if(c.type!=="point")return;const{zoom:l,styleZoom:f}=r,d=Math.floor(f),p=l+(d-f),{startLength:m,midLength:y,finishLength:A}=i.axis,h=Ue(d,r.styleState,!1,i.tileData),w=Math.max(Qe(se(c.style.duplicationSpacing,h),p),1),x=Qe(c.style.endingOffsets,l),M=m+(y-m)%w,v=m+x,T=A-x;for(let E=M;E<T;E+=w)if(E>v){const S=i.axis,P=E,O=S.getSegmentIndex(P),L=S.interpolate(P,O);ic(e,t,n,i,L,o,r,s,a)}}function d0(e,t,n,i,s,o){const{layer:r}=n;if(r.type!=="labelLine"&&r.type!=="oneWayLine")return;const{zoom:a,styleZoom:c}=o,l=Math.floor(c),f=a+(l-c),{startLength:d,midLength:p,finishLength:m}=n.axis,y=Ue(c,o.styleState,!1,n.tileData),A=Ue(l,o.styleState,!1,n.tileData);let h,w,x,M;if(r.type==="labelLine"){const u=se(r.style.textFontSize,y)/Je.baseSize,g=se(r.style.textFontSize,A)/Je.baseSize;h=n.textMetrics.maxWidth*u,w=n.textMetrics.maxWidth*g,x=Qe(se(r.style.textDuplicationSpacing,A),f),M=Qe(Math.max(r.style.lineEndingOffsets,r.style.textLabelingSideMargin),a)}else h=se(r.style.lineLength,y),w=se(r.style.lineLength,A),x=Qe(se(r.style.duplicationSpacing,A),f),M=Qe(r.style.endingOffsets,a);const v=Qe(w,f),E=Qe(h,a)/2,S=x+v,P=d+(p-d)%S,O=d+E+M,L=m-E-M,U=r.type!=="labelLine"?e:t;for(let u=P;u<L;u+=S)u>O&&h0(U,n,u,E,h,s,o,i)}function h0(e,t,n,i,s,o,r,a){const c=t.axis,{zoom:l,styleZoom:f}=r,{startLength:d,finishLength:p}=c,m=c.getSegmentIndex(n),y=c.interpolate(n,m);if(Gc(o.position,y,r.center)>a0||!u0(t,n,i,l,f,r.styleState))return;const h=t.layer.type==="oneWayLine",w=h?Ie.OneWayLine:Ie.LineText,x=new $i(t,w,y,r.buildingHeight,o,a,r.globeMode);x.anchorPosition=n,x.anchorSegmentIndex=m,x.halfLabelWidth=i,h||(x.overflowStyleZoom=cr(fr(s,p-d),y),p0(x,t,n,i,r,o)),e.push(x)}function u0(e,t,n,i,s,o){if(e.layer.type==="oneWayLine")return!0;const r=e.axis,a=Ue(s,o,!1,e.tileData),c=se(e.layer.style.textFontSize,a)/Je.baseSize,l=r.getSegmentIndex(t-n),f=r.getSegmentIndex(t+n),d=Qe(r0*c,i);for(let p=l;p<f;p++){if(p>1&&sc(r.angles[p-1],r.angles[p])>tc)return!1;const m=r.getSegmentIndex(r.lengths[p]-d);if(m!==0){const y=r.angles[m],A=r.angles[r.getSegmentIndex(r.lengths[p]+d)];if(sc(y,A)>tc)return!1}}return!0}function sc(e,t){const n=Math.abs(e-t);return n>Math.PI?2*Math.PI-n:n}function p0(e,t,n,i,s,o){const{axis:r,layer:a}=t;if(a.type!=="labelLine")return;const{zoom:c,styleZoom:l}=s,f=Ue(l,s.styleState,!1,t.tileData),d=se(a.style.textFontSize,f),p=d/2,m=Qe(d,c),y=Qe(a.style.textLabelingSideMargin,c),A=Math.max(0,n-i+m/2-y),h=Math.min(r.lengths[r.lengths.length-1],n+i-m/2+y);let w=r.getSegmentIndex(A);for(let x=A;x<h;x+=m){for(;r.lengths[w]<x;)w++;oc(e,r,x,w,o,p)}for(;r.lengths[w]<h;)w++;oc(e,r,h,w,o,p)}function oc(e,t,n,i,s,o){const r=s.flat.project(t.interpolate(n,i));r[0]=r[0]-e.anchorScreen[0],r[1]=r[1]-e.anchorScreen[1],e.boxes.push([r[0]-o,r[1]-o,r[0]+o,r[1]+o])}function No(e,t){const{source:n,detailLevel:i,layer:{minzoom:s,maxzoom:o}}=e,r=n===En.PersonalPoi,a=r||s>i,c=r||o<i+1||i===ps.maxDetailLevel;return(!a||t>=s)&&(!c||t<o)}var Ro=(e=>(e[e.Main=0]="Main",e[e.Parser=1]="Parser",e[e.Labeling=2]="Labeling",e[e.Models=3]="Models",e[e.All=4]="All",e))(Ro||{}),fi=(e=>(e[e.FunctionUse=0]="FunctionUse",e[e.FunctionResult=1]="FunctionResult",e))(fi||{});class m0{constructor(){this.events={}}on(t,n){let i=this.events[t];return i||(i=this.events[t]=[]),i.push(n),this}once(t,n){const i=s=>{this.off(t,i),n.call(this,s)};return this.on(t,i),this}off(t,n){const i=this.events[t];if(!i)return this;const s=i.indexOf(n);return s!==-1&&i.splice(s,1),this}emit(t,n){const i=this.events[t];if(!i)return this;const s=i.slice();for(let o=0;o<s.length;o++)s[o].call(this,n);return this}}class g0 extends m0{constructor(t){super(),this.worker=t,t.addEventListener("message",n=>{const i=n.data;this.emit("message",i)})}send(t,n,i){const s={to:t,msg:n,transferable:i};this.worker.postMessage(s,i)}broadcast(t){const n={to:Ro.All,msg:t};this.worker.postMessage(n)}}class w0{constructor(t){this.onMessage=n=>{const{from:i,msg:s}=n;switch(s.type){case fi.FunctionUse:this.onFunctionUse(s,i);break;case fi.FunctionResult:this.onFunctionResult(s);break}},this.connector=t,this.functions=new Map,this.functionIdCounter=0,this.pendingFunctions=new Map,t.on("message",this.onMessage)}set(t,n){this.functions.set(t,n)}get(t,n){return(...i)=>{const s=this.functionIdCounter++,o=new Promise(a=>{this.pendingFunctions.set(s,a)}),r={type:fi.FunctionUse,data:{id:s,name:n,args:i}};return this.connector.send(t,r),o}}onFunctionUse(t,n){const{data:{name:i,args:s,id:o}}=t,r=this.functions.get(i);if(r){const a=r(...s);a&&a.then?Promise.resolve(a).then(c=>this.sendFunctionResult(n,o,c)):this.sendFunctionResult(n,o,a)}else console.error(`FnRegistry#onFunctionUse: function ${i} not found`)}sendFunctionResult(t,n,i){const s={type:fi.FunctionResult,data:{id:n,result:i}};i&&i.transferable?this.connector.send(t,s,i.transferable):this.connector.send(t,s)}onFunctionResult(t){const{data:{id:n,result:i}}=t,s=this.pendingFunctions.get(n);s?(s(i),this.pendingFunctions.delete(n)):console.error(`FnRegistry#onFunctionResult: pending function ${n} not found`)}}class rc{constructor(t){this.map=(t==null?void 0:t.map)||{}}set(t,n,i){this.map[t]===void 0&&(this.map[t]={}),this.map[t][n]=i}get(t,n){const i=this.map[t];if(i!==void 0)return i[n]}has(t,n){const i=this.map[t];return i===void 0?!1:i[n]!==void 0}reduce(t,n){return Object.values(this.map).reduce((i,s)=>Object.values(s).reduce((o,r,a,c)=>t(o,r,a,c),i),n)}}function di(e){return typeof e!="boolean"&&e.type==="attrs"}function ac(e){return typeof e!="boolean"&&e.type==="unextractable"}function us(e){if(!At(e))return[!!e];let t=[];const n=[];switch(e.type){case"all":const s=e.array.map(us);for(const a of s){const c=[];for(const l of a){if(l===!1)return[!1];di(l)?c.push(l):ac(l)&&n.push(l)}c.length>0&&(t.length===0?t=c:t=cc(t,c))}break;case"match":if(!Rs(e.input))return[{type:"unextractable",exp:e}];if(e.input.type==="precompute")return[{type:"unextractable",exp:e}];const o=e.input.property,r=e.defaultOutput;for(const a of e.cases){const c=us(a.output),l=[];a.values.forEach(f=>{l.push({type:"attrs",attrs:{[o]:f}})});for(const f of c)if(di(f))for(const d of cc([f],l))t.push(d);else if(ac(f)){n.push(f);for(const d of l)t.push(d)}else if(f===!0&&!r)for(const d of l)t.push(d)}break;case"==":{let a,c;if(Rs(e.leftValue)&&Or(e.rightValue))a=e.leftValue.property,c=e.rightValue;else if(Rs(e.rightValue)&&Or(e.leftValue))a=e.rightValue.property,c=e.leftValue;else return[{type:"unextractable",exp:e}];t.push({type:"attrs",attrs:{[a]:c}});break}default:return[{type:"unextractable",exp:e}]}return t.concat(n)}function cc(e,t){const n=[];for(const i of e)for(const s of t)n.push({type:"attrs",attrs:{...i.attrs,...s.attrs}});return n}class y0{constructor(){this.layers=[],this.keyStat={},this.orderedKeys=[],this.tree=null,this.treeNodesCount=0,this.traverseCount=0,this.traverseIterations=0}addLayers(t){for(const n of t)n.type==="custom"||!n.filter||(this.layers.push(n),this.statLayerKeys(n));this.buildTree()}getLayers(t,n){const i=[],s=(o,r)=>{if(this.traverseIterations+=1,!o)return;for(const f of o.leafs)i.push(f);const a=this.orderedKeys[r];if(!a)return;const c=n[t[a]],l=Lh(c)?$a(c):c;l!==void 0&&s(o.children[l],r+1),s(o.novalue,r+1)};return this.traverseCount+=1,s(this.tree,0),i}stat(){const t=this.traverseIterations/this.traverseCount||0;return{tree:this.tree,treeNodes:this.treeNodesCount,layers:this.layers.length,keyStat:this.keyStat,itersPerTraverse:t}}statLayerKeys(t){const i=us(t.filter).filter(s=>di(s))[0];if(!(!i||!di(i)))for(const s in i.attrs)this.keyStat[s]===void 0&&(this.keyStat[s]=0),this.keyStat[s]+=1}getOrderedKeys(){return Object.entries(this.keyStat).sort(([n,i],[s,o])=>o-i).map(([n,i])=>n)}buildTree(){this.orderedKeys=this.getOrderedKeys();const t=[];for(const n of this.layers){const s=us(n.filter).filter(di);s.length===0&&t.push(n);for(const o of s){const r=new Set(Object.keys(o.attrs));let a=0;const c=o.attrs;let l=this.tree;for(let f=0;f<=this.orderedKeys.length;f++){if(a===r.size){l==null||l.leafs.push(n);break}const d=this.orderedKeys[f],p=this.orderedKeys[f+1]||"";if(l||(l=this.makeTreeNode(d),this.tree===null&&(this.tree=l)),r.has(d)){const m=c[d];l.children[m]||(l.children[m]=this.makeTreeNode(p)),l=l.children[m],a+=1}else l.novalue||(l.novalue=this.makeTreeNode(p)),l=l.novalue}}}t.length>0&&(this.tree||(this.tree=this.makeTreeNode("")),this.tree.leafs=t)}makeTreeNode(t){return this.treeNodesCount+=1,{key:t,children:{},novalue:null,leafs:[]}}}class v0{constructor(){this.metaStyles=new Map,this.layerTrees=new Map}proxySyncStyle(t){const n=new y0;n.addLayers(t.layers),this.layerTrees.set(t.id,n),this.metaStyles.set(t.id,t)}getStyle(t){return this.metaStyles.get(t)}getLayers(t,n,i){const s=this.layerTrees.get(t);return s?s.getLayers(n,i):[]}}function x0(e){if(e<0||e>4)throw new Error("[2gl] Invalid attribute location count. Must be 1, 2, 3 or 4")}const K=class K{constructor(t,n,i=!1,s=!1){this.elementsType=null,this.isDirty=!0,this._glBuffer=null,this._glContext=null,this._initData=t,this.byteLength=t.byteLength,this.type=i?K.ElementArrayBuffer:K.ArrayBuffer,this.options=Object.assign({},K.defaultOptions,n),this.drawType=(n==null?void 0:n.drawType)??K.StaticDraw;const o=[K.UnsignedByte,K.UnsignedShort,K.UnsignedInt];i&&!o.includes(this.options.dataType)&&(console.warn("Please provide dataType of one of the following values:Buffer.UnsignedByte, Buffer.UnsignedShort, Buffer.UnsignedInt. Defaulting to UnsignedInt"),this.options.dataType=K.UnsignedInt),this._preserveData=s}static _dataTypeSize(t){switch(t){case K.Byte:case K.UnsignedByte:return 1;case K.UnsignedShort:case K.Short:return 2;case K.Float:case K.Int:case K.UnsignedInt:return 4}throw new Error(`[2gl] Unsupported Buffer data type: ${String(t)}`)}memSizeJs(){var t;return((t=this._initData)==null?void 0:t.byteLength)??0}memSizeGPU(){return this.byteLength}bind(t,n,i,s,o){if(this._glBuffer||this.prepare(t),this.type===K.ArrayBuffer){t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer),n=n||0,i=i||this.options,o=o??1,x0(o);const r=this._toGlParam(t,i.dataType)||t.FLOAT;if(o===1)t.vertexAttribPointer(n,i.itemSize,r,i.normalized,i.stride,i.offset),this.bindVertexAttribDivisor(t,n,i,s);else{const a=K._dataTypeSize(i.dataType);for(let c=0;c<o;c++)t.vertexAttribPointer(n+c,o,r,i.normalized,i.stride,i.offset+c*o*a),this.bindVertexAttribDivisor(t,n+c,i,s)}}else this.type===K.ElementArrayBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer);return this}remove(){return this._unprepare(),this}subData(t,n,i){this._glBuffer||this.prepare(t);const s=this._toGlParam(t,this.type)||t.ARRAY_BUFFER;return t.bindBuffer(s,this._glBuffer),t.bufferSubData(s,n,i),this}replaceData(t){t&&(this._initData=t),this.isDirty=!0}commitData(t){const n=this._toGlParam(t,this.type)||t.ARRAY_BUFFER,i=this._toGlParam(t,this.drawType)||t.STATIC_DRAW;t.bindBuffer(n,this._glBuffer),t.bufferData(n,this._initData,i),this.isDirty=!1}prepare(t){return this._glContext=t,this._glBuffer=t.createBuffer(),this.commitData(t),this._preserveData||(this._initData=null),this}getGLType(t){return this._toGlParam(t,this.options.dataType)}getData(){return this._initData}_unprepare(){this._glBuffer&&this._glContext&&this._glContext.deleteBuffer(this._glBuffer),this._glBuffer=null,this._glContext=null,this._initData=null,this.isDirty=!1}_toGlParam(t,n){return n===K.ArrayBuffer?t.ARRAY_BUFFER:n===K.ElementArrayBuffer?t.ELEMENT_ARRAY_BUFFER:n===K.StaticDraw?t.STATIC_DRAW:n===K.DynamicDraw?t.DYNAMIC_DRAW:n===K.Byte?t.BYTE:n===K.Short?t.SHORT:n===K.Int?t.INT:n===K.Float?t.FLOAT:n===K.UnsignedByte?t.UNSIGNED_BYTE:n===K.UnsignedShort?t.UNSIGNED_SHORT:n===K.UnsignedInt?t.UNSIGNED_INT:null}_hasRealWebGLContext(){return typeof window<"u"&&("WebGLRenderingContext"in window||"WebGL2RenderingContext"in window)}bindVertexAttribDivisor(t,n,i,s){i.instanceDivisor&&this._hasRealWebGLContext()&&(t instanceof WebGLRenderingContext?s?s.vertexAttribDivisorANGLE(n,i.instanceDivisor):console.error("Can't set up instanced attribute divisor. Missing ANGLE_instanced_arrays extension"):t.vertexAttribDivisor(n,i.instanceDivisor))}};K.ArrayBuffer=1,K.ElementArrayBuffer=2,K.StaticDraw=10,K.DynamicDraw=11,K.Float=20,K.UnsignedByte=21,K.UnsignedShort=22,K.UnsignedInt=23,K.Byte=24,K.Short=25,K.Int=26,K.defaultOptions={itemSize:3,dataType:K.Float,stride:0,offset:0,normalized:!1,instanceDivisor:0,drawType:K.StaticDraw};let lc=K;function Co(e){if(typeof e=="number")return e;let t=0;if(Array.isArray(e))for(const n of e)t+=Co(n);else for(const n in e){const i=e[n];typeof i=="number"?t+=i:t+=Co(i)}return t}const I0=new Map;function M0(e){const t=new g0(e),n=new w0(t),i=new Qh("labeling"),s=new v0,o=n.get(Ro.Main,"loadFont"),r=new Map,a=new Map;let c=[],l=new Map;const f=new rc,d=new rc,p={},m=Xh(()=>i.reset(),mc),y=g=>{Ad(g)};n.set("setComPoiRandomSeed",y);const A=()=>{const g=i.getBucketsMemoryFootprint(),I=[];let b=0;Array.from(r.keys()).forEach(_=>{const D=r.get(_);D&&(b+=D.length,I.push({label:{[_]:D.map(()=>({label:1}))}}))});const B={collector:{buckets:g},labeling:I};return{js:{...B,"--labelsCount":b,"--sum":Co(B)}}};n.set("getMemoryFootprint",A);const h=(g,I,b,B,_)=>{const D=bd(b,I,s,B,_);r.set(g,D)};n.set("appendLabels",h);function w(g,I){for(const b of I)f.has(g,b)||(o(g,b),f.set(g,b,!0))}const x=(g,I)=>{a.set(g,I)};n.set("appendLabelBox",x);const M=g=>{a.delete(g)};n.set("removeEmptyBoxLabel",M);const v=g=>{r.delete(g),a.delete(g)};n.set("removeLabels",v);function T(g,I,b){if(g.has(b.label.sourceId))return Sn.none;const B=I.get(b.id);return B===void 0||B.placementIndex===void 0||B.type===Ie.Icon&&B.layer.innerId!==b.layer.innerId?Sn.fadeIn:B.placementIndex===b.placementIndex?Sn.none:Sn.fadeIn}const E=(g,I,b,B,_,D,ye)=>{const $=new Set(_),oe=[];let me=new Map;const z=[];return b.forEach(re=>{const te=new Wc(re),F=new Set,V=[...I];g.forEach(({sourceId:X,animate:Z,labelsKeys:Ce})=>{Z||F.add(X),V.push(...Ce)});const{boxElements:Q,oneWayTileElements:fe,otherTileElements:ne,noLabelingElements:ie}=c0(V,re,te,s,r,a,p,d,B,$,w),W=zd(ne,Q,re,ye?I0:l,D,te),Y=[...ie,...fe,...ne],N=new Map;for(let X=0;X<Y.length;X++){const Z=Y[X];Z.placementIndex!==-1&&N.set(Z.id,Z)}for(let X=0;X<Y.length;X++){const Z=Y[X],{label:{styleId:Ce,layer:Vt}}=Z;if(Z.placementIndex===-1)continue;const Bt=T(F,l,Z),Me=s.getStyle(Ce);if(!Me){console.error(`Not found style ${Ce} in labeling#processLabels`);continue}Ha(Me,Vt,i,Z,Bt,B,re,re.tileInfo)}for(let X=0;X<c.length;X++){const Z=c[X],{id:Ce,label:Vt,layer:Bt}=Z,{styleId:Me}=Vt,ae=s.getStyle(Me);if(!ae){console.error(`Not found style ${Me} in labeling#processLabels`);continue}if(F.has(Z.label.sourceId))continue;const Uo=Z.placementIndex,kt=N.get(Ce);Uo===-1||Z.placementIndex===(kt==null?void 0:kt.placementIndex)&&(Z.type!==Ie.Icon||Z.layer.innerId===(kt==null?void 0:kt.layer.innerId))||re.styleZoom<Z.overflowStyleZoom||re.styleZoom<Bt.minzoom||re.styleZoom>=Bt.maxzoom||Ha(ae,Bt,i,Z,Sn.fadeOut,B,re,re.tileInfo)}oe.push(...Y),me=new Map([...me,...N]);const j=i.getAccumulatedData(),ce=[];for(const X of Q)X.placementIndex!==-1&&ce.push(X.label.id);const H=new Map,J=hl(re.tilesBounds);for(const X of ne)if(X.placementIndex!==-1&&on(X)&&Vc(J,X.anchorWorld)){const Z={};Ld(X)?Z.adsPriority="city":Dd(X)&&(Z.adsPriority="premium"),H.set(X.label.id,Z)}const be={survivedLabelBoxIds:ce,survivedCommPois:Array.from(H).map(X=>{const Z={id:X[0]};return X[1].adsPriority!==void 0&&(Z.adsPriority=X[1].adsPriority),Z}),collectorOutput:j,transferable:j.transferable};if(W){const X=new Int32Array(W.length);X.set(W),be.labels=X.buffer}z.push(be)}),c=oe,l=me,m(),z};n.set("processLabels",E);const S=(g,I)=>{p[g]||(p[g]={});const b=p[g];for(const B in I)b[B]=I[B]};n.set("appendFont",S);const P=(g,I)=>{d.set(g,I,!0)};n.set("markFontAsLoaded",P);const O=(g,I)=>{const b=s.getStyle(g);if(!b){console.error(`Not found style ${g} in labeling#addNewRasterSets`);return}const{rasterSets:B}=b;I.forEach(_=>{B.byIndex[_.index]=_,B.byKey[_.key]=_})};n.set("addNewRasterSets",O);const L=(g,I)=>{const b=s.getStyle(g);if(!b){console.error(`Not found style ${g} in labeling#updatePackingInfo`);return}const{rasterSets:B}=b,_=7,D=I.length/_;for(let ye=0;ye<D;ye++){const $=I[ye*_],oe=I[ye*_+1],me=I[ye*_+6],z=I[ye*_+2],re=I[ye*_+3],te=I[ye*_+4],F=I[ye*_+5],V=B.byIndex[$];if(V===void 0){console.error(`Not found raster set with index ${$}`);continue}if(V.isSvg)V.rasters[oe]={rasterIndex:oe,rasterSetIndex:$,x:z,y:re,w:te,h:F,anchorX:V.anchorX,anchorY:V.anchorY,atlasIndex:me,isPacked:!0};else{const Q=V.rasters[oe];if(Q===void 0){console.error(`Not found raster with index ${oe} and raster set index ${$}`);continue}Q.x=z,Q.y=re,Q.atlasIndex=me,Q.isPacked=!0}}};n.set("updatePackingInfo",L);const U=()=>{c=[],l.clear()};n.set("clearPreviousLabels",U);const u=(...g)=>s.proxySyncStyle(...g);n.set("syncStyle",u),n.set("loadRtlPlugin",o0),n.set("markRtlPluginLoaded",()=>{li&&li()})}M0(self)})();
